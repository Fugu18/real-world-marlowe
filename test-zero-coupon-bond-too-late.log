
***** Test "Zero-Coupon Bond with Deposit Too Late" *****
[Comment] This test case closes the contract before the first deposit, which then fails.
[Comment] Create the wallet for the lender, fund it with 80 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "ocean expand winner tiger someone avocado picnic farm device noodle certain kangaroo bottom degree consider canyon key where illness fancy office replace eight episode".
[createWallet] First wallet address is addr_test1qrur5wsgnkyw59kv60zetaqxqalyzcqznd6z56w76frzzuhdpvv3q6ehw37q5v7turwwr0tg76xztgvzezztsh7dejfsu6cyv3.
[createWallet] First public key hash is f83a3a089d88ea16ccd3c595f406077e4160029b742a69ded2462172.
[CreateWallet] Created wallet identified as a9aa9aab85601295d8024fb0f65352d7956f0c11 for role "Lender".
[FundWallet] Funded wallet for role "Lender" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance "LenderApp" with identifier 47494912-8f2d-4bad-ac51-e9d974123107 for role "Lender".
[Comment] Create the wallet for the borrower and fund it with 10 ADA, and activate the Marlowe endpoints.
[runContract] Instance 47494912-8f2d-4bad-ac51-e9d974123107 received NewObservableState Null.
[runContract] Instance 47494912-8f2d-4bad-ac51-e9d974123107 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 47494912-8f2d-4bad-ac51-e9d974123107 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "enact enter spin detail almost nurse pottery learn awake patient loyal only eagle inject comfort boost increase talk crew secret buyer grow fruit please".
[createWallet] First wallet address is addr_test1qqm8s64cxy9kvtqfp3lc0jarcujflkm795ach6fljze4vak5x29ly4g2r573f4dzr8u4q60hdjpu4a08qfxj4c7kxv3s8anmgf.
[createWallet] First public key hash is 36786ab8310b662c090c7f87cba3c7249fdb7e2d3b8be93f90b35676.
[CreateWallet] Created wallet identified as 9e7e8076e4d3c582b54e22ccd615f38efdbb12ea for role "Borrower".
[FundWallet] Funded wallet for role "Borrower" with valueFromList [(AdaAssetId,10000000)].
[ActivateApp] Activated MarloweApp instance "BorrowerApp" with identifier f6a76a23-db92-4a87-b3b1-8864378b06fb for role "Borrower".
[Comment] Show the contents of the wallets.
[runContract] Instance f6a76a23-db92-4a87-b3b1-8864378b06fb received NewObservableState Null.
[runContract] Instance f6a76a23-db92-4a87-b3b1-8864378b06fb received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance f6a76a23-db92-4a87-b3b1-8864378b06fb received NewYieldedExportTxs [].
[PrintWallet] Wallet for role "Lender" contains valueFromList [(AdaAssetId,80000000)].
[PrintWallet] Wallet for role "Borrower" contains valueFromList [(AdaAssetId,10000000)].
[Comment] The lender creates the ZCB contract, which was downloaded from Marlowe Playground. The loan amount is 50 ADA and the interest amount is 3 ADA.
[CallCreate] Endpoint "create" called on instance "LenderApp" for owners [("Lender",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "f83a3a089d88ea16ccd3c595f406077e4160029b742a69ded2462172")) (StakeRefBase (KeyHashObj (KeyHash "ed0b19106b37747c0a33cbe0dce1bd68f68c25a182c884b85fcdcc93"))))),("Borrower",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "36786ab8310b662c090c7f87cba3c7249fdb7e2d3b8be93f90b35676")) (StakeRefBase (KeyHashObj (KeyHash "d4328bf2550a1d3d14d5a219f95069f76c83caf5e7024d2ae3d63323")))))].
[runContract] Instance 47494912-8f2d-4bad-ac51-e9d974123107 received NewActiveEndpoints [].
[runContract] Instance 47494912-8f2d-4bad-ac51-e9d974123107 received NewObservableState (Object (fromList [("contents",Array [String "c556be9a-2825-40a6-b13e-22a47002524f",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "42021d89a6ed749829b72130d7b5e462e53ebd95e99204382ab27296"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "a6d36426a8973688b562d8462adf96ca0b0b9fe850ab060b11d718e5")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 47494912-8f2d-4bad-ac51-e9d974123107 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wpp5kj24sxd404ajf3clzk7rw4yewjqupssckegfaxttu2qqgm49z and role address addr_test1wppqy8vf5mkhfxpfkusnp4a4u33w204ajh5eyppc92e899sk9rm32 with MarloweParams {rolePayoutValidatorHash = 42021d89a6ed749829b72130d7b5e462e53ebd95e99204382ab27296, rolesCurrency = a6d36426a8973688b562d8462adf96ca0b0b9fe850ab060b11d718e5}.
[Comment] The lender should have about 76 ADA now, since 2 ADA was sent to the script address when creating the contract, 2 ADA was sent the borrower along with the role token, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Lender" contains valueFromList [(AdaAssetId,75537874),(AssetId "a6d36426a8973688b562d8462adf96ca0b0b9fe850ab060b11d718e5" "Lender",1)].
[Comment] The borrower should now have their original 10 ADA plus the 2 ADA that arrived with the role token.
[CheckFunds] Wallet for role "Borrower" contains valueFromList [(AdaAssetId,12000000),(AssetId "a6d36426a8973688b562d8462adf96ca0b0b9fe850ab060b11d718e5" "Borrower",1)].
[Comment] The borrower needs to follow this contract in order to interact with it.
[Follow] Instance "BorrowerApp" now follows instance "LenderApp".
[Comment] The lender deposits the 50 ADA loan amount too late.
[runContract] Instance 47494912-8f2d-4bad-ac51-e9d974123107 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "LenderApp" for inputs [ClientInput (IDeposit "Lender" "Lender" (Token "" "") 50000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1646097340000}).
[runContract] Instance 47494912-8f2d-4bad-ac51-e9d974123107 received NewObservableState (Object (fromList [("contents",Array [String "542c1a55-59af-4940-921d-30a36f47244d",String "apply-inputs",Object (fromList [("contents",Object (fromList [("contents",Object (fromList [("contents",Array [Number 1.649385523999e12,Array [Number 1.645590825e12,Number 1.64609734e12]]),("tag",String "IntervalInPastError")])),("tag",String "TEIntervalError")])),("tag",String "MarloweEvaluationError")])]),("tag",String "EndpointException")])).
[runContract] Instance 47494912-8f2d-4bad-ac51-e9d974123107 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[ShouldFail] Operations failed as expected: CliError {unCliError = "[awaitApp] Received unexpected response MarloweEvaluationError (TEIntervalError (IntervalInPastError (POSIXTime {getPOSIXTime = 1649385523999}) (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1646097340000})))."} occurred for [CallApplyInputs {poInstance = "LenderApp", poInputs = [ClientInput (IDeposit "Lender" "Lender" (Token "" "") 50000000)], poTimes = Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1646097340000})},AwaitApplyInputs {poInstance = "LenderApp"}].
***** PASSED *****
