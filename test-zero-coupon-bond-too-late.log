
***** Test "Zero-Coupon Bond with Deposit Too Late" *****
[Comment] This test case closes the contract before the first deposit, which then fails.
[Comment] Create the wallet for the lender, fund it with 80 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "off version apology office myself birth trash cool month glimpse winner clutch gesture suit today south hill upper improve cover public high elite goat".
[createWallet] First wallet address is addr_test1qznx8ftve86lk4hv7v7mujs7tmef9uzef5h4w7eqsz44gkh4qd7k2kr8flhjlvkrftalsc3pjsjln24p6ar87s5z88usadd8mx.
[createWallet] First public key hash is a663a56cc9f5fb56ecf33dbe4a1e5ef292f0594d2f577b2080ab545a.
[CreateWallet] Created wallet identified as 8749ceaeed44b4945f8e4795752dccb3524ae880 for role "Lender".
[FundWallet] Funded wallet for role "Lender" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance "LenderApp" with identifier 3ea87914-b41b-46cf-acd7-5c3c310b3787 for role "Lender".
[Comment] Create the wallet for the borrower and fund it with 10 ADA, and activate the Marlowe endpoints.
[runContract] Instance 3ea87914-b41b-46cf-acd7-5c3c310b3787 received NewObservableState Null.
[runContract] Instance 3ea87914-b41b-46cf-acd7-5c3c310b3787 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 3ea87914-b41b-46cf-acd7-5c3c310b3787 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "happy hunt subject pizza sugar gold family cousin month apart top million two blast height dust skill gate pair chair faint this pigeon color".
[createWallet] First wallet address is addr_test1qzeqg5yp8ptaxv2r2ghk6lrs9slyrdr27lqz0syh2hsvhg88khnjrnelg6ccjnwh0vuul82lmyct54x92n22w4fjh6fqapusz0.
[createWallet] First public key hash is b20450813857d33143522f6d7c702c3e41b46af7c027c09755e0cba0.
[CreateWallet] Created wallet identified as dc11e5b26486978630b871c9044b665363e9477a for role "Borrower".
[FundWallet] Funded wallet for role "Borrower" with valueFromList [(AdaAssetId,10000000)].
[ActivateApp] Activated MarloweApp instance "BorrowerApp" with identifier 77ada7dd-7f96-428f-bb44-a56342c7d8e2 for role "Borrower".
[Comment] Show the contents of the wallets.
[runContract] Instance 77ada7dd-7f96-428f-bb44-a56342c7d8e2 received NewObservableState Null.
[runContract] Instance 77ada7dd-7f96-428f-bb44-a56342c7d8e2 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 77ada7dd-7f96-428f-bb44-a56342c7d8e2 received NewYieldedExportTxs [].
[PrintWallet] Wallet for role "Lender" contains valueFromList [(AdaAssetId,80000000)].
[PrintWallet] Wallet for role "Borrower" contains valueFromList [(AdaAssetId,10000000)].
[Comment] The lender creates the ZCB contract, which was downloaded from Marlowe Playground. The loan amount is 50 ADA and the interest amount is 3 ADA.
[CallCreate] Endpoint "create" called on instance "LenderApp" for owners [("Lender",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "a663a56cc9f5fb56ecf33dbe4a1e5ef292f0594d2f577b2080ab545a")) (StakeRefBase (KeyHashObj (KeyHash "f5037d6558674fef2fb2c34afbf862219425f9aaa1d7467f428239f9"))))),("Borrower",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "b20450813857d33143522f6d7c702c3e41b46af7c027c09755e0cba0")) (StakeRefBase (KeyHashObj (KeyHash "e7b5e721cf3f46b1894dd77b39cf9d5fd930ba54c554d4a75532be92")))))].
[runContract] Instance 3ea87914-b41b-46cf-acd7-5c3c310b3787 received NewActiveEndpoints [].
[runContract] Instance 3ea87914-b41b-46cf-acd7-5c3c310b3787 received NewObservableState (Object (fromList [("contents",Array [String "09bb2d9a-a6ba-43ab-960b-6ec9a4c23cb5",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "53284bd790cd82bdf8d7e6fc3da06f3b698ace06332e33cd8fcb520d"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "87a3ed81d8e5b41898e67225af1ad7f38fbe04c5b32bd5dc9dcd0e34")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 3ea87914-b41b-46cf-acd7-5c3c310b3787 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wrr9tyms3cw3uju23kkdnlj2mdct0qy9g8rncfyvxs5kw2gxtdvj7 and role address addr_test1wpfjsj7hjrxc900c6ln0c0dqduaknzkwqcejuv7d3l94yrghk5rrs with MarloweParams {rolePayoutValidatorHash = 53284bd790cd82bdf8d7e6fc3da06f3b698ace06332e33cd8fcb520d, rolesCurrency = 87a3ed81d8e5b41898e67225af1ad7f38fbe04c5b32bd5dc9dcd0e34}.
[Comment] The lender should have about 76 ADA now, since 2 ADA was sent to the script address when creating the contract, 2 ADA was sent the borrower along with the role token, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Lender" contains valueFromList [(AdaAssetId,75537874),(AssetId "87a3ed81d8e5b41898e67225af1ad7f38fbe04c5b32bd5dc9dcd0e34" "Lender",1)].
[Comment] The borrower should now have their original 10 ADA plus the 2 ADA that arrived with the role token.
[CheckFunds] Wallet for role "Borrower" contains valueFromList [(AdaAssetId,12000000),(AssetId "87a3ed81d8e5b41898e67225af1ad7f38fbe04c5b32bd5dc9dcd0e34" "Borrower",1)].
[Comment] The borrower needs to follow this contract in order to interact with it.
[Follow] Instance "BorrowerApp" now follows instance "LenderApp".
[Comment] The lender deposits the 50 ADA loan amount too late.
[runContract] Instance 3ea87914-b41b-46cf-acd7-5c3c310b3787 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "LenderApp" for inputs [ClientInput (IDeposit "Lender" "Lender" (Token "" "") 50000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1646097340000}).
[runContract] Instance 3ea87914-b41b-46cf-acd7-5c3c310b3787 received NewObservableState (Object (fromList [("contents",Array [String "7f0f4f1c-6a72-4653-8e68-a710cff78f82",String "apply-inputs",Object (fromList [("contents",Object (fromList [("contents",Object (fromList [("contents",Array [Number 1.649810322999e12,Array [Number 1.645590825e12,Number 1.64609734e12]]),("tag",String "IntervalInPastError")])),("tag",String "TEIntervalError")])),("tag",String "MarloweEvaluationError")])]),("tag",String "EndpointException")])).
[runContract] Instance 3ea87914-b41b-46cf-acd7-5c3c310b3787 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[ShouldFail] Operations failed as expected: CliError {unCliError = "[awaitApp] Received unexpected response MarloweEvaluationError (TEIntervalError (IntervalInPastError (POSIXTime {getPOSIXTime = 1649810322999}) (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1646097340000})))."} occurred for [CallApplyInputs {poInstance = "LenderApp", poInputs = [ClientInput (IDeposit "Lender" "Lender" (Token "" "") 50000000)], poTimes = Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1646097340000})},AwaitApplyInputs {poInstance = "LenderApp"}].
***** PASSED *****
