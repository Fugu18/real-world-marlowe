
***** Test "Zero-Coupon Bond with Deposit Too Late" *****
[Comment] This test case closes the contract before the first deposit, which then fails.
[Comment] Create the wallet for the lender, fund it with 80 ADA, and activate the Marlowe endpoints.
[CreateWallet] Created wallet 4723d2481d3928daf1f9d5de6a4c4aeaafb760b7 for role "Lender".
[FundWallet] Funded wallet 4723d2481d3928daf1f9d5de6a4c4aeaafb760b7 for role "Lender" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance 8979ed2a-1a75-4e23-89ee-4e78b40f499f for role "Lender".
[Comment] Create the wallet for the borrower and fund it with 10 ADA, and activate the Marlowe endpoints.
[runContract] Instance 8979ed2a-1a75-4e23-89ee-4e78b40f499f received NewObservableState Null.
[runContract] Instance 8979ed2a-1a75-4e23-89ee-4e78b40f499f received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 8979ed2a-1a75-4e23-89ee-4e78b40f499f received NewYieldedExportTxs [].
[CreateWallet] Created wallet e705f62c1c40d90f097d51280785211e52e2bc29 for role "Borrower".
[FundWallet] Funded wallet e705f62c1c40d90f097d51280785211e52e2bc29 for role "Borrower" with valueFromList [(AdaAssetId,10000000)].
[ActivateApp] Activated MarloweApp instance 939281b5-36c0-4bb8-8fb5-99283ab9e780 for role "Borrower".
[Comment] Show the contents of the wallets.
[runContract] Instance 939281b5-36c0-4bb8-8fb5-99283ab9e780 received NewObservableState Null.
[runContract] Instance 939281b5-36c0-4bb8-8fb5-99283ab9e780 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 939281b5-36c0-4bb8-8fb5-99283ab9e780 received NewYieldedExportTxs [].
[PrintWallet] Wallet for role "Lender" contains valueFromList [(AdaAssetId,80000000)].
[PrintWallet] Wallet for role "Borrower" contains valueFromList [(AdaAssetId,10000000)].
[Comment] The lender creates the ZCB contract, which was downloaded from Marlowe Playground. The loan amount is 50 ADA and the interest amount is 3 ADA.
[CallCreate] Endpoint "create" called on instance 8979ed2a-1a75-4e23-89ee-4e78b40f499f for owners [("Lender",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "0ff7bf2c1bc67a71a1b0fb9dbccd99e40989a670e160f29a06f93f03")) (StakeRefBase (KeyHashObj (KeyHash "a5d86679d1a8a1e2cec6595064e374389e9ceb16a9486873549f50c7"))))),("Borrower",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "b056ccf5b8a617a0a8b7e25850b74642eb95fbcce989d116101f3dfe")) (StakeRefBase (KeyHashObj (KeyHash "1e45d61ebe36facfd38d78bed0cf18ec373cddc439c976413927ef1c")))))].
[runContract] Instance 8979ed2a-1a75-4e23-89ee-4e78b40f499f received NewActiveEndpoints [].
[runContract] Instance 8979ed2a-1a75-4e23-89ee-4e78b40f499f received NewObservableState (Object (fromList [("contents",Array [String "5b0b9621-4a7f-41dd-9192-ed9cdd688168",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "19e66b501e5075bbdaa2f24b53f845d8056d9a243b892e6710d6333e"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "7b69d752f7a92e1af666a978aa19b216c99ab271f60eb5e51c4977f4")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 8979ed2a-1a75-4e23-89ee-4e78b40f499f received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed with MarloweParams {rolePayoutValidatorHash = 19e66b501e5075bbdaa2f24b53f845d8056d9a243b892e6710d6333e, rolesCurrency = 7b69d752f7a92e1af666a978aa19b216c99ab271f60eb5e51c4977f4}.
[Comment] The lender should have about 76 ADA now, since 2 ADA was sent to the script address when creating the contract, 2 ADA was sent the borrower along with the role token, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Lender" contains valueFromList [(AdaAssetId,75537874),(AssetId "7b69d752f7a92e1af666a978aa19b216c99ab271f60eb5e51c4977f4" "Lender",1)].
[Comment] The borrower should now have their original 10 ADA plus the 2 ADA that arrived with the role token.
[CheckFunds] Wallet for role "Borrower" contains valueFromList [(AdaAssetId,12000000),(AssetId "7b69d752f7a92e1af666a978aa19b216c99ab271f60eb5e51c4977f4" "Borrower",1)].
[Comment] The borrower needs to follow this contract in order to interact with it.
[Follow] Instance 939281b5-36c0-4bb8-8fb5-99283ab9e780 now follows instance 8979ed2a-1a75-4e23-89ee-4e78b40f499f.
[Comment] The lender deposits the 50 ADA loan amount too late.
[CallApplyInputs] Endpoint "apply-inputs" called on 8979ed2a-1a75-4e23-89ee-4e78b40f499f for inputs [ClientInput (IDeposit "Lender" "Lender" (Token "" "") 50000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1646097340000}).
[runContract] Instance 8979ed2a-1a75-4e23-89ee-4e78b40f499f received NewActiveEndpoints [].
[runContract] Instance 8979ed2a-1a75-4e23-89ee-4e78b40f499f received NewObservableState (Object (fromList [("contents",Array [String "2c5bcae8-6b0c-4ef7-8097-3aa08b7d79fc",String "apply-inputs",Object (fromList [("contents",Object (fromList [("contents",Object (fromList [("contents",Array [Number 1.647309732999e12,Array [Number 1.645590825e12,Number 1.64609734e12]]),("tag",String "IntervalInPastError")])),("tag",String "TEIntervalError")])),("tag",String "MarloweEvaluationError")])]),("tag",String "EndpointException")])).
[runContract] Instance 8979ed2a-1a75-4e23-89ee-4e78b40f499f received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[ShouldFail] Operations failed as expected: CliError {unCliError = "[awaitApp] Received unexpected response MarloweEvaluationError (TEIntervalError (IntervalInPastError (POSIXTime {getPOSIXTime = 1647309732999}) (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1646097340000})))."} occurred for [CallApplyInputs {poInstance = "LenderApp", poInputs = [ClientInput (IDeposit "Lender" "Lender" (Token "" "") 50000000)], poTimes = Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1646097340000})},AwaitApplyInputs {poInstance = "LenderApp"}].
***** SUCCEEDED *****
