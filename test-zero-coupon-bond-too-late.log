
***** Test "Zero-Coupon Bond with Deposit Too Late" *****
[Comment] This test case closes the contract before the first deposit, which then fails.
[Comment] Create the wallet for the lender, fund it with 80 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "sleep appear neutral auction idle hospital soft labor obey cave ticket live trap around pulse forward supply there flower desk valley olive giggle frown".
[createWallet] First wallet address is addr_test1qpgczyn3ygn35ujyss2l2m3hsrc9wr72yjllgc04gx0emyyfphmfucxgapy6eprdc0vtkqgpt6qslf3qkqlzt6caxgzq323u58.
[createWallet] First public key hash is 5181127122271a72448415f56e3780f0570fca24bff461f5419f9d90.
[CreateWallet] Created wallet identified as 0036b2fb14009c78400fbcdb11ff47e9f3654825 for role "Lender".
[FundWallet] Funded wallet for role "Lender" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance "LenderApp" with identifier 96494013-4152-475e-a0f3-65663f1aecc2 for role "Lender".
[Comment] Create the wallet for the borrower and fund it with 10 ADA, and activate the Marlowe endpoints.
[runContract] Instance 96494013-4152-475e-a0f3-65663f1aecc2 received NewObservableState Null.
[runContract] Instance 96494013-4152-475e-a0f3-65663f1aecc2 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 96494013-4152-475e-a0f3-65663f1aecc2 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "over whale pet race foot panel clip marble remember eternal any endorse tiny young kiss you similar shield turtle protect fantasy crunch stadium blanket".
[createWallet] First wallet address is addr_test1qral4w9umlvfsvxeedeu2c4nf955u2u8e80smjdwc8dj6lzf56rz76f8w3zy2p5g5z8v5wnxuwakrmzddqh9wyukytaqvhwg72.
[createWallet] First public key hash is fbfab8bcdfd89830d9cb73c562b349694e2b87c9df0dc9aec1db2d7c.
[CreateWallet] Created wallet identified as c44958cb4903b15fe1364d840800046e6a7efc87 for role "Borrower".
[FundWallet] Funded wallet for role "Borrower" with valueFromList [(AdaAssetId,10000000)].
[ActivateApp] Activated MarloweApp instance "BorrowerApp" with identifier f94a7473-554f-4f6a-ba79-6a6d39eecea3 for role "Borrower".
[Comment] Show the contents of the wallets.
[runContract] Instance f94a7473-554f-4f6a-ba79-6a6d39eecea3 received NewObservableState Null.
[runContract] Instance f94a7473-554f-4f6a-ba79-6a6d39eecea3 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance f94a7473-554f-4f6a-ba79-6a6d39eecea3 received NewYieldedExportTxs [].
[PrintWallet] Wallet for role "Lender" contains valueFromList [(AdaAssetId,80000000)].
[PrintWallet] Wallet for role "Borrower" contains valueFromList [(AdaAssetId,10000000)].
[Comment] The lender creates the ZCB contract, which was downloaded from Marlowe Playground. The loan amount is 50 ADA and the interest amount is 3 ADA.
[CallCreate] Endpoint "create" called on instance "LenderApp" for owners [("Lender",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "5181127122271a72448415f56e3780f0570fca24bff461f5419f9d90")) (StakeRefBase (KeyHashObj (KeyHash "890df69e60c8e849ac846dc3d8bb01015e810fa620b03e25eb1d3204"))))),("Borrower",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "fbfab8bcdfd89830d9cb73c562b349694e2b87c9df0dc9aec1db2d7c")) (StakeRefBase (KeyHashObj (KeyHash "49a6862f69277444450688a08eca3a66e3bb61ec4d682e57139622fa")))))].
[runContract] Instance 96494013-4152-475e-a0f3-65663f1aecc2 received NewActiveEndpoints [].
[runContract] Instance 96494013-4152-475e-a0f3-65663f1aecc2 received NewObservableState (Object (fromList [("contents",Array [String "6450fffa-7f88-499b-a21c-98a083020477",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "96429ded60010e93a27e9b336577384929ab0b8f758a9e7146913d00"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "e4895039b61219046d29fd528d2c5718b5e177f5637ac95280fd35ea")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 96494013-4152-475e-a0f3-65663f1aecc2 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wqjexvkwk7avclkm39dk942w3nxj7jnrw853cdzl84kjk3stex607 and role address addr_test1wzty980dvqqsayaz06dnxeth8pyjn2ct3a6c48n3g6gn6qqw8r9gw with MarloweParams {rolePayoutValidatorHash = 96429ded60010e93a27e9b336577384929ab0b8f758a9e7146913d00, rolesCurrency = e4895039b61219046d29fd528d2c5718b5e177f5637ac95280fd35ea}.
[Comment] The lender should have about 76 ADA now, since 2 ADA was sent to the script address when creating the contract, 2 ADA was sent the borrower along with the role token, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Lender" contains valueFromList [(AdaAssetId,75537874),(AssetId "e4895039b61219046d29fd528d2c5718b5e177f5637ac95280fd35ea" "Lender",1)].
[Comment] The borrower should now have their original 10 ADA plus the 2 ADA that arrived with the role token.
[CheckFunds] Wallet for role "Borrower" contains valueFromList [(AdaAssetId,12000000),(AssetId "e4895039b61219046d29fd528d2c5718b5e177f5637ac95280fd35ea" "Borrower",1)].
[Comment] The borrower needs to follow this contract in order to interact with it.
[Follow] Instance "BorrowerApp" now follows instance "LenderApp".
[Comment] The lender deposits the 50 ADA loan amount too late.
[runContract] Instance 96494013-4152-475e-a0f3-65663f1aecc2 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "LenderApp" for inputs [ClientInput (IDeposit "Lender" "Lender" (Token "" "") 50000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1646097340000}).
[runContract] Instance 96494013-4152-475e-a0f3-65663f1aecc2 received NewObservableState (Object (fromList [("contents",Array [String "9d5e7ac3-68ad-4817-b3cb-25ee232f338c",String "apply-inputs",Object (fromList [("contents",Object (fromList [("contents",Object (fromList [("contents",Array [Number 1.650052172999e12,Array [Number 1.645590825e12,Number 1.64609734e12]]),("tag",String "IntervalInPastError")])),("tag",String "TEIntervalError")])),("tag",String "MarloweEvaluationError")])]),("tag",String "EndpointException")])).
[runContract] Instance 96494013-4152-475e-a0f3-65663f1aecc2 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[ShouldFail] Operations failed as expected: CliError {unCliError = "[awaitApp] Received unexpected response MarloweEvaluationError (TEIntervalError (IntervalInPastError (POSIXTime {getPOSIXTime = 1650052172999}) (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1646097340000})))."} occurred for [CallApplyInputs {poInstance = "LenderApp", poInputs = [ClientInput (IDeposit "Lender" "Lender" (Token "" "") 50000000)], poTimes = Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1646097340000})},AwaitApplyInputs {poInstance = "LenderApp"}].
***** PASSED *****
