
***** Test "Zero-Coupon Bond with Deposit Too Late" *****
[Comment] This test case closes the contract before the first deposit, which then fails.
[Comment] Create the wallet for the lender, fund it with 80 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "hold goddess shadow point venue cup beef master swear version chair half poet cotton copy food often suit choice auto pattern degree absurd episode".
[createWallet] First wallet address is addr_test1qzay4t5wnwjn3lugdavjlkq26jygu790ky04zd033gavsfa5ny9zjlv733gsm4nkjqz9825tkm02xs9tyse0pszk4v6sulgx93.
[createWallet] First public key hash is ba4aae8e9ba538ff886f592fd80ad4888e78afb11f5135f18a3ac827.
[CreateWallet] Created wallet identified as 69e36a291a6ba3b0b25a544a3043afa35c702762 for role "Lender".
[FundWallet] Funded wallet for role "Lender" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance "LenderApp" with identifier 2c2fd80d-6232-4a82-9317-368c715f3114 for role "Lender".
[Comment] Create the wallet for the borrower and fund it with 10 ADA, and activate the Marlowe endpoints.
[runContract] Instance 2c2fd80d-6232-4a82-9317-368c715f3114 received NewObservableState Null.
[runContract] Instance 2c2fd80d-6232-4a82-9317-368c715f3114 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 2c2fd80d-6232-4a82-9317-368c715f3114 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "wheat erode slight guide eye settle fluid actress ozone rescue frozen tonight ancient skull adjust luxury remember dish name cannon chalk tomorrow lady slim".
[createWallet] First wallet address is addr_test1qpg88rzknkthcu2sx7ffe54gt3kdkn5l687q2m2dplkhw82emrp8efruv35llu9uvrsa9ghqnpujrukgs8su2qfcgwns2h30jh.
[createWallet] First public key hash is 50738c569d977c715037929cd2a85c6cdb4e9fd1fc056d4d0fed771d.
[CreateWallet] Created wallet identified as a2c66ffbe0a0223f5929896cecf9fce4729ac2c2 for role "Borrower".
[FundWallet] Funded wallet for role "Borrower" with valueFromList [(AdaAssetId,10000000)].
[ActivateApp] Activated MarloweApp instance "BorrowerApp" with identifier 0958db79-ec35-429d-aac5-3a761ddfd2f0 for role "Borrower".
[Comment] Show the contents of the wallets.
[runContract] Instance 0958db79-ec35-429d-aac5-3a761ddfd2f0 received NewObservableState Null.
[runContract] Instance 0958db79-ec35-429d-aac5-3a761ddfd2f0 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 0958db79-ec35-429d-aac5-3a761ddfd2f0 received NewYieldedExportTxs [].
[PrintWallet] Wallet for role "Lender" contains valueFromList [(AdaAssetId,80000000)].
[PrintWallet] Wallet for role "Borrower" contains valueFromList [(AdaAssetId,10000000)].
[Comment] The lender creates the ZCB contract, which was downloaded from Marlowe Playground. The loan amount is 50 ADA and the interest amount is 3 ADA.
[CallCreate] Endpoint "create" called on instance "LenderApp" for owners [("Lender",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "ba4aae8e9ba538ff886f592fd80ad4888e78afb11f5135f18a3ac827")) (StakeRefBase (KeyHashObj (KeyHash "b4990a297d9e8c510dd676900453aa8bb6dea340ab2432f0c056ab35"))))),("Borrower",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "50738c569d977c715037929cd2a85c6cdb4e9fd1fc056d4d0fed771d")) (StakeRefBase (KeyHashObj (KeyHash "59d8c27ca47c6469fff0bc60e1d2a2e0987921f2c881e1c5013843a7")))))].
[runContract] Instance 2c2fd80d-6232-4a82-9317-368c715f3114 received NewActiveEndpoints [].
[runContract] Instance 2c2fd80d-6232-4a82-9317-368c715f3114 received NewObservableState (Object (fromList [("contents",Array [String "9812cbef-30bc-4b96-953c-8c7d0cb0ad16",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "c9b3170aee78308a19fb86615cdba16a8c11a9fe8764f74dde715a52"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "33918ff563f195d8ec1fedbee4fb751ec0abe86fb007d800dcbf0e0a")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 2c2fd80d-6232-4a82-9317-368c715f3114 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wzv2eqp0npvpw8fm8ay0jjtykdgprdpy5xl6x74xuhsgduqak7wx3 and role address addr_test1wrymx9c2aeurpzselwrxzhxm594gcydfl6rkfa6dmec455s8ysq6x with MarloweParams {rolePayoutValidatorHash = c9b3170aee78308a19fb86615cdba16a8c11a9fe8764f74dde715a52, rolesCurrency = 33918ff563f195d8ec1fedbee4fb751ec0abe86fb007d800dcbf0e0a}.
[Comment] The lender should have about 76 ADA now, since 2 ADA was sent to the script address when creating the contract, 2 ADA was sent the borrower along with the role token, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Lender" contains valueFromList [(AdaAssetId,75537874),(AssetId "33918ff563f195d8ec1fedbee4fb751ec0abe86fb007d800dcbf0e0a" "Lender",1)].
[Comment] The borrower should now have their original 10 ADA plus the 2 ADA that arrived with the role token.
[CheckFunds] Wallet for role "Borrower" contains valueFromList [(AdaAssetId,12000000),(AssetId "33918ff563f195d8ec1fedbee4fb751ec0abe86fb007d800dcbf0e0a" "Borrower",1)].
[Comment] The borrower needs to follow this contract in order to interact with it.
[Follow] Instance "BorrowerApp" now follows instance "LenderApp".
[Comment] The lender deposits the 50 ADA loan amount too late.
[runContract] Instance 2c2fd80d-6232-4a82-9317-368c715f3114 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "LenderApp" for inputs [ClientInput (IDeposit "Lender" "Lender" (Token "" "") 50000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1646097340000}).
[runContract] Instance 2c2fd80d-6232-4a82-9317-368c715f3114 received NewObservableState (Object (fromList [("contents",Array [String "11d8d154-a206-4c88-baf3-80d299a3dce6",String "apply-inputs",Object (fromList [("contents",Object (fromList [("contents",Object (fromList [("contents",Array [Number 1.649977422999e12,Array [Number 1.645590825e12,Number 1.64609734e12]]),("tag",String "IntervalInPastError")])),("tag",String "TEIntervalError")])),("tag",String "MarloweEvaluationError")])]),("tag",String "EndpointException")])).
[runContract] Instance 2c2fd80d-6232-4a82-9317-368c715f3114 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[ShouldFail] Operations failed as expected: CliError {unCliError = "[awaitApp] Received unexpected response MarloweEvaluationError (TEIntervalError (IntervalInPastError (POSIXTime {getPOSIXTime = 1649977422999}) (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1646097340000})))."} occurred for [CallApplyInputs {poInstance = "LenderApp", poInputs = [ClientInput (IDeposit "Lender" "Lender" (Token "" "") 50000000)], poTimes = Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1646097340000})},AwaitApplyInputs {poInstance = "LenderApp"}].
***** PASSED *****
