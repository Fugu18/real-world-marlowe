
***** Test "Detection of Wallet Failures" *****
[Comment] Create and fund the wallet.
[createWallet] Mnemonic sentence is "garden verify stumble turn dignity convince sleep hollow mixed mechanic vivid flat dragon expect slot script diet front girl hour castle toe shift brand".
[createWallet] First wallet address is addr_test1qp92y8vel8hzxld2s20tzm9gxsa38fv7x725vklm8722894x0nxynk0phj742j0x5xs9dj7pz4v4vd2wgy95ycnu3gwqpmkek9.
[createWallet] First public key hash is 4aa21d99f9ee237daa829eb16ca8343b13a59e3795465bfb3f94a396.
[CreateWallet] Created wallet identified as f0fcba58282c67f45b8939d87ac44f5d23595cd8 for role "PAB".
[FundWallet] Funded wallet for role "PAB" with valueFromList [(AdaAssetId,1200000)].
[Comment] Activate the Marlowe application.
[ActivateApp] Activated MarloweApp instance "App" with identifier ab62c8eb-db2f-4cfe-8df3-0e7902c3c5b4 for role "PAB".
[Comment] Create the contract.
[CallCreate] Endpoint "create" called on instance "App" for owners [("PAB",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "4aa21d99f9ee237daa829eb16ca8343b13a59e3795465bfb3f94a396")) (StakeRefBase (KeyHashObj (KeyHash "a67ccc49d9e1bcbd5549e6a1a056cbc1155956354e410b42627c8a1c")))))].
[Comment] The failure of the wallet to balance should be promptly reported.
[runContract] Instance ab62c8eb-db2f-4cfe-8df3-0e7902c3c5b4 received NewObservableState Null.
[runContract] Instance ab62c8eb-db2f-4cfe-8df3-0e7902c3c5b4 received NewActiveEndpoints [].
[runContract] Instance ab62c8eb-db2f-4cfe-8df3-0e7902c3c5b4 received NewYieldedExportTxs [].
[runContract] Instance ab62c8eb-db2f-4cfe-8df3-0e7902c3c5b4 received NewObservableState (Object (fromList [("contents",Array [String "619a1663-3001-4569-a6d2-e26ca56348fa",String "create",Object (fromList [("contents",Object (fromList [("contents",Object (fromList [("contents",String "FailureResponse (Request {requestPath = (BaseUrl {baseUrlScheme = Http, baseUrlHost = \"localhost\", baseUrlPort = 8090, baseUrlPath = \"\"},\"/v2/wallets/f0fcba58282c67f45b8939d87ac44f5d23595cd8/transactions-balance\"), requestQueryString = fromList [], requestBody = Just ((),application/json;charset=utf-8), requestAccept = fromList [application/json;charset=utf-8,application/json], requestHeaders = fromList []), requestHttpVersion = HTTP/1.1, requestMethod = \"POST\"} (Response {responseStatusCode = Status {statusCode = 403, statusMessage = \"Forbidden\"}, responseHeaders = fromList [(\"Transfer-Encoding\",\"chunked\"),(\"Date\",\"Fri, 15 Apr 2022 19:34:28 GMT\"),(\"Server\",\"Warp/3.3.18\"),(\"Content-Type\",\"application/json;charset=utf-8\")], responseHttpVersion = HTTP/1.1, responseBody = \"{\\\"code\\\":\\\"not_enough_money\\\",\\\"message\\\":\\\"I can't process this payment as there are not enough funds available in the wallet. I am missing: coin: 0.800000 tokens: [] \\\"}\"})"),("tag",String "OtherError")])),("tag",String "WalletContractError")])),("tag",String "OtherContractError")])]),("tag",String "EndpointException")])).
[runContract] Instance ab62c8eb-db2f-4cfe-8df3-0e7902c3c5b4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[ShouldFail] Operations failed as expected: CliError {unCliError = "[awaitApp] Received unexpected response OtherContractError (WalletContractError (OtherError \"FailureResponse (Request {requestPath = (BaseUrl {baseUrlScheme = Http, baseUrlHost = \\\"localhost\\\", baseUrlPort = 8090, baseUrlPath = \\\"\\\"},\\\"/v2/wallets/f0fcba58282c67f45b8939d87ac44f5d23595cd8/transactions-balance\\\"), requestQueryString = fromList [], requestBody = Just ((),application/json;charset=utf-8), requestAccept = fromList [application/json;charset=utf-8,application/json], requestHeaders = fromList []), requestHttpVersion = HTTP/1.1, requestMethod = \\\"POST\\\"} (Response {responseStatusCode = Status {statusCode = 403, statusMessage = \\\"Forbidden\\\"}, responseHeaders = fromList [(\\\"Transfer-Encoding\\\",\\\"chunked\\\"),(\\\"Date\\\",\\\"Fri, 15 Apr 2022 19:34:28 GMT\\\"),(\\\"Server\\\",\\\"Warp/3.3.18\\\"),(\\\"Content-Type\\\",\\\"application/json;charset=utf-8\\\")], responseHttpVersion = HTTP/1.1, responseBody = \\\"{\\\\\\\"code\\\\\\\":\\\\\\\"not_enough_money\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"I can't process this payment as there are not enough funds available in the wallet. I am missing: coin: 0.800000 tokens: [] \\\\\\\"}\\\"})\"))."} occurred for [AwaitCreate {poInstance = "App"}].
[Comment] Stop the application.
[Stop] Instance "App" stopped.
***** PASSED *****
