
***** Test "Detection of Wallet Failures" *****
[Comment] Create and fund the wallet.
[CreateWallet] Created wallet 33d6313facd270c6153f5cc42c9aa66804d6b755 for role "PAB".
[FundWallet] Funded wallet 33d6313facd270c6153f5cc42c9aa66804d6b755 for role "PAB" with valueFromList [(AdaAssetId,1200000)].
[Comment] Activate the Marlowe application.
[ActivateApp] Activated MarloweApp instance 66380705-1086-413d-b15e-56b50f9e7549 for role "PAB".
[Comment] Create the contract.
[CallCreate] Endpoint "create" called on instance 66380705-1086-413d-b15e-56b50f9e7549 for owners [("PAB",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "826d66b11f5ab20baa5d33c102a3d55e05975a03e094141c7f925c72")) (StakeRefBase (KeyHashObj (KeyHash "097433819c8175ba159932b5acec69845286582cd010c13ea41e7f1b")))))].
[Comment] The failure of the wallet to balance should be promptly reported.
[runContract] Instance 66380705-1086-413d-b15e-56b50f9e7549 received NewObservableState Null.
[runContract] Instance 66380705-1086-413d-b15e-56b50f9e7549 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 66380705-1086-413d-b15e-56b50f9e7549 received NewYieldedExportTxs [].
[runContract] Instance 66380705-1086-413d-b15e-56b50f9e7549 received NewActiveEndpoints [].
[runContract] Instance 66380705-1086-413d-b15e-56b50f9e7549 received NewObservableState (Object (fromList [("contents",Array [String "9994b548-75b9-4b5e-9273-d64c729bcb39",String "create",Object (fromList [("contents",Object (fromList [("contents",Object (fromList [("contents",String "FailureResponse (Request {requestPath = (BaseUrl {baseUrlScheme = Http, baseUrlHost = \"localhost\", baseUrlPort = 8090, baseUrlPath = \"\"},\"/v2/wallets/33d6313facd270c6153f5cc42c9aa66804d6b755/transactions-balance\"), requestQueryString = fromList [], requestBody = Just ((),application/json;charset=utf-8), requestAccept = fromList [application/json;charset=utf-8,application/json], requestHeaders = fromList []), requestHttpVersion = HTTP/1.1, requestMethod = \"POST\"} (Response {responseStatusCode = Status {statusCode = 403, statusMessage = \"Forbidden\"}, responseHeaders = fromList [(\"Transfer-Encoding\",\"chunked\"),(\"Date\",\"Tue, 15 Mar 2022 01:46:42 GMT\"),(\"Server\",\"Warp/3.3.18\"),(\"Content-Type\",\"application/json;charset=utf-8\")], responseHttpVersion = HTTP/1.1, responseBody = \"{\\\"code\\\":\\\"not_enough_money\\\",\\\"message\\\":\\\"I can't process this payment as there are not enough funds available in the wallet. I am missing: coin: 0.800000 tokens: [] \\\"}\"})"),("tag",String "OtherError")])),("tag",String "WalletContractError")])),("tag",String "OtherContractError")])]),("tag",String "EndpointException")])).
[runContract] Instance 66380705-1086-413d-b15e-56b50f9e7549 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[ShouldFail] Operations failed as expected: CliError {unCliError = "[awaitApp] Received unexpected response OtherContractError (WalletContractError (OtherError \"FailureResponse (Request {requestPath = (BaseUrl {baseUrlScheme = Http, baseUrlHost = \\\"localhost\\\", baseUrlPort = 8090, baseUrlPath = \\\"\\\"},\\\"/v2/wallets/33d6313facd270c6153f5cc42c9aa66804d6b755/transactions-balance\\\"), requestQueryString = fromList [], requestBody = Just ((),application/json;charset=utf-8), requestAccept = fromList [application/json;charset=utf-8,application/json], requestHeaders = fromList []), requestHttpVersion = HTTP/1.1, requestMethod = \\\"POST\\\"} (Response {responseStatusCode = Status {statusCode = 403, statusMessage = \\\"Forbidden\\\"}, responseHeaders = fromList [(\\\"Transfer-Encoding\\\",\\\"chunked\\\"),(\\\"Date\\\",\\\"Tue, 15 Mar 2022 01:46:42 GMT\\\"),(\\\"Server\\\",\\\"Warp/3.3.18\\\"),(\\\"Content-Type\\\",\\\"application/json;charset=utf-8\\\")], responseHttpVersion = HTTP/1.1, responseBody = \\\"{\\\\\\\"code\\\\\\\":\\\\\\\"not_enough_money\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"I can't process this payment as there are not enough funds available in the wallet. I am missing: coin: 0.800000 tokens: [] \\\\\\\"}\\\"})\"))."} occurred for [AwaitCreate {poInstance = "App"}].
[Comment] Stop the application.
[Stop] Instance 66380705-1086-413d-b15e-56b50f9e7549 stopped.
***** SUCCEEDED *****
