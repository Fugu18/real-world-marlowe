
***** Test "Detection of Wallet Failures" *****
[Comment] Create and fund the wallet.
[createWallet] Mnemonic sentence is "fragile giggle memory castle champion net ticket artist cattle reopen shaft popular sorry easily spare seminar that initial task digital left antenna crucial coconut".
[createWallet] First wallet address is addr_test1qrsf60upewz98a8wh30hntlyu35phpkjauka2dl8fgyfngf5fa053d0txvm2efpthluk9z6y8mcf70xgdsdxzx6ggx4qjsu3h2.
[createWallet] First public key hash is e09d3f81cb8453f4eebc5f79afe4e4681b86d2ef2dd537e74a0899a1.
[CreateWallet] Created wallet identified as 29356f0d7801ea78e7fe41351c3c035018dc72a0 for role "PAB".
[FundWallet] Funded wallet for role "PAB" with valueFromList [(AdaAssetId,1200000)].
[Comment] Activate the Marlowe application.
[ActivateApp] Activated MarloweApp instance "App" with identifier 0c1e3e23-7f9f-49c9-9f7c-560bd9099a81 for role "PAB".
[Comment] Create the contract.
[CallCreate] Endpoint "create" called on instance "App" for owners [("PAB",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "e09d3f81cb8453f4eebc5f79afe4e4681b86d2ef2dd537e74a0899a1")) (StakeRefBase (KeyHashObj (KeyHash "344f5f48b5eb3336aca42bbff9628b443ef09f3cc86c1a611b4841aa")))))].
[runContract] Instance 0c1e3e23-7f9f-49c9-9f7c-560bd9099a81 received NewObservableState Null.
[Comment] The failure of the wallet to balance should be promptly reported.
[runContract] Instance 0c1e3e23-7f9f-49c9-9f7c-560bd9099a81 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 0c1e3e23-7f9f-49c9-9f7c-560bd9099a81 received NewYieldedExportTxs [].
[runContract] Instance 0c1e3e23-7f9f-49c9-9f7c-560bd9099a81 received NewActiveEndpoints [].
[runContract] Instance 0c1e3e23-7f9f-49c9-9f7c-560bd9099a81 received NewObservableState (Object (fromList [("contents",Array [String "236305a9-d7eb-4ac3-a907-4d408d30c005",String "create",Object (fromList [("contents",Object (fromList [("contents",Object (fromList [("contents",String "FailureResponse (Request {requestPath = (BaseUrl {baseUrlScheme = Http, baseUrlHost = \"localhost\", baseUrlPort = 8090, baseUrlPath = \"\"},\"/v2/wallets/29356f0d7801ea78e7fe41351c3c035018dc72a0/transactions-balance\"), requestQueryString = fromList [], requestBody = Just ((),application/json;charset=utf-8), requestAccept = fromList [application/json;charset=utf-8,application/json], requestHeaders = fromList []), requestHttpVersion = HTTP/1.1, requestMethod = \"POST\"} (Response {responseStatusCode = Status {statusCode = 403, statusMessage = \"Forbidden\"}, responseHeaders = fromList [(\"Transfer-Encoding\",\"chunked\"),(\"Date\",\"Wed, 13 Apr 2022 00:20:02 GMT\"),(\"Server\",\"Warp/3.3.18\"),(\"Content-Type\",\"application/json;charset=utf-8\")], responseHttpVersion = HTTP/1.1, responseBody = \"{\\\"code\\\":\\\"not_enough_money\\\",\\\"message\\\":\\\"I can't process this payment as there are not enough funds available in the wallet. I am missing: coin: 0.800000 tokens: [] \\\"}\"})"),("tag",String "OtherError")])),("tag",String "WalletContractError")])),("tag",String "OtherContractError")])]),("tag",String "EndpointException")])).
[runContract] Instance 0c1e3e23-7f9f-49c9-9f7c-560bd9099a81 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[ShouldFail] Operations failed as expected: CliError {unCliError = "[awaitApp] Received unexpected response OtherContractError (WalletContractError (OtherError \"FailureResponse (Request {requestPath = (BaseUrl {baseUrlScheme = Http, baseUrlHost = \\\"localhost\\\", baseUrlPort = 8090, baseUrlPath = \\\"\\\"},\\\"/v2/wallets/29356f0d7801ea78e7fe41351c3c035018dc72a0/transactions-balance\\\"), requestQueryString = fromList [], requestBody = Just ((),application/json;charset=utf-8), requestAccept = fromList [application/json;charset=utf-8,application/json], requestHeaders = fromList []), requestHttpVersion = HTTP/1.1, requestMethod = \\\"POST\\\"} (Response {responseStatusCode = Status {statusCode = 403, statusMessage = \\\"Forbidden\\\"}, responseHeaders = fromList [(\\\"Transfer-Encoding\\\",\\\"chunked\\\"),(\\\"Date\\\",\\\"Wed, 13 Apr 2022 00:20:02 GMT\\\"),(\\\"Server\\\",\\\"Warp/3.3.18\\\"),(\\\"Content-Type\\\",\\\"application/json;charset=utf-8\\\")], responseHttpVersion = HTTP/1.1, responseBody = \\\"{\\\\\\\"code\\\\\\\":\\\\\\\"not_enough_money\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"I can't process this payment as there are not enough funds available in the wallet. I am missing: coin: 0.800000 tokens: [] \\\\\\\"}\\\"})\"))."} occurred for [AwaitCreate {poInstance = "App"}].
[Comment] Stop the application.
[Stop] Instance "App" stopped.
***** PASSED *****
