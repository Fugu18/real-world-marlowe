
***** Test "Detection of Wallet Failures" *****
[Comment] Create and fund the wallet.
[createWallet] Mnemonic sentence is "horn split spatial type funny laptop outdoor wide town theme embark ill six inherit catalog clay solid myself boss pave soccer neglect crawl switch".
[createWallet] First wallet address is addr_test1qqf5ey8g5htaampd0xyh42285yrw2te5dxlcpwq3jj87st3u57ek7d8yqrat006mf5e08ytck0mj35zvg483zfxwxers2w30hp.
[createWallet] First public key hash is 134c90e8a5d7deec2d79897aa947a106e52f3469bf80b811948fe82e.
[CreateWallet] Created wallet identified as 1d22a25dea62bbe4a5ba5fc8f46ae4ccfc0dca65 for role "PAB".
[FundWallet] Funded wallet for role "PAB" with valueFromList [(AdaAssetId,1200000)].
[Comment] Activate the Marlowe application.
[ActivateApp] Activated MarloweApp instance "App" with identifier 11934aa4-51e8-4c88-a9bd-4810768df096 for role "PAB".
[Comment] Create the contract.
[CallCreate] Endpoint "create" called on instance "App" for owners [("PAB",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "134c90e8a5d7deec2d79897aa947a106e52f3469bf80b811948fe82e")) (StakeRefBase (KeyHashObj (KeyHash "3ca7b36f34e400fab7bf5b4d32f39178b3f728d04c454f1124ce3647")))))].
[Comment] The failure of the wallet to balance should be promptly reported.
[runContract] Instance 11934aa4-51e8-4c88-a9bd-4810768df096 received NewObservableState Null.
[runContract] Instance 11934aa4-51e8-4c88-a9bd-4810768df096 received NewActiveEndpoints [].
[runContract] Instance 11934aa4-51e8-4c88-a9bd-4810768df096 received NewYieldedExportTxs [].
[runContract] Instance 11934aa4-51e8-4c88-a9bd-4810768df096 received NewObservableState (Object (fromList [("contents",Array [String "82045382-7a3e-4ac6-adf9-bdc4ef3f5202",String "create",Object (fromList [("contents",Object (fromList [("contents",Object (fromList [("contents",String "FailureResponse (Request {requestPath = (BaseUrl {baseUrlScheme = Http, baseUrlHost = \"localhost\", baseUrlPort = 8090, baseUrlPath = \"\"},\"/v2/wallets/1d22a25dea62bbe4a5ba5fc8f46ae4ccfc0dca65/transactions-balance\"), requestQueryString = fromList [], requestBody = Just ((),application/json;charset=utf-8), requestAccept = fromList [application/json;charset=utf-8,application/json], requestHeaders = fromList []), requestHttpVersion = HTTP/1.1, requestMethod = \"POST\"} (Response {responseStatusCode = Status {statusCode = 403, statusMessage = \"Forbidden\"}, responseHeaders = fromList [(\"Transfer-Encoding\",\"chunked\"),(\"Date\",\"Thu, 14 Apr 2022 22:49:48 GMT\"),(\"Server\",\"Warp/3.3.18\"),(\"Content-Type\",\"application/json;charset=utf-8\")], responseHttpVersion = HTTP/1.1, responseBody = \"{\\\"code\\\":\\\"not_enough_money\\\",\\\"message\\\":\\\"I can't process this payment as there are not enough funds available in the wallet. I am missing: coin: 0.800000 tokens: [] \\\"}\"})"),("tag",String "OtherError")])),("tag",String "WalletContractError")])),("tag",String "OtherContractError")])]),("tag",String "EndpointException")])).
[runContract] Instance 11934aa4-51e8-4c88-a9bd-4810768df096 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[ShouldFail] Operations failed as expected: CliError {unCliError = "[awaitApp] Received unexpected response OtherContractError (WalletContractError (OtherError \"FailureResponse (Request {requestPath = (BaseUrl {baseUrlScheme = Http, baseUrlHost = \\\"localhost\\\", baseUrlPort = 8090, baseUrlPath = \\\"\\\"},\\\"/v2/wallets/1d22a25dea62bbe4a5ba5fc8f46ae4ccfc0dca65/transactions-balance\\\"), requestQueryString = fromList [], requestBody = Just ((),application/json;charset=utf-8), requestAccept = fromList [application/json;charset=utf-8,application/json], requestHeaders = fromList []), requestHttpVersion = HTTP/1.1, requestMethod = \\\"POST\\\"} (Response {responseStatusCode = Status {statusCode = 403, statusMessage = \\\"Forbidden\\\"}, responseHeaders = fromList [(\\\"Transfer-Encoding\\\",\\\"chunked\\\"),(\\\"Date\\\",\\\"Thu, 14 Apr 2022 22:49:48 GMT\\\"),(\\\"Server\\\",\\\"Warp/3.3.18\\\"),(\\\"Content-Type\\\",\\\"application/json;charset=utf-8\\\")], responseHttpVersion = HTTP/1.1, responseBody = \\\"{\\\\\\\"code\\\\\\\":\\\\\\\"not_enough_money\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"I can't process this payment as there are not enough funds available in the wallet. I am missing: coin: 0.800000 tokens: [] \\\\\\\"}\\\"})\"))."} occurred for [AwaitCreate {poInstance = "App"}].
[Comment] Stop the application.
[Stop] Instance "App" stopped.
***** PASSED *****
