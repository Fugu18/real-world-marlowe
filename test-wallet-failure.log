
***** Test "Detection of Wallet Failures" *****
[Comment] Create and fund the wallet.
[createWallet] Mnemonic sentence is "way business salute champion pizza early retreat raw combine glory absorb empower mix confirm ugly own romance original luxury humor avoid hold matrix assist".
[createWallet] First wallet address is addr_test1qq9p3dkw4ve8knfq50exly6hhtpps3k5jzs8ken5j7wcexcdkjj8ps93uvygaekmq8t6pycs24j8768wscd3qfyfqj4sg7844v.
[createWallet] First public key hash is 0a18b6ceab327b4d20a3f26f9357bac21846d490a07b6674979d8c9b.
[CreateWallet] Created wallet identified as a511241b6a1d0811d18c0be6ccd714f2e20b288f for role "PAB".
[FundWallet] Funded wallet for role "PAB" with valueFromList [(AdaAssetId,1200000)].
[Comment] Activate the Marlowe application.
[ActivateApp] Activated MarloweApp instance "App" with identifier 746e9dfd-18cf-49ee-b905-a45ec7bf51e2 for role "PAB".
[Comment] Create the contract.
[runContract] Instance 746e9dfd-18cf-49ee-b905-a45ec7bf51e2 received NewObservableState Null.
[runContract] Instance 746e9dfd-18cf-49ee-b905-a45ec7bf51e2 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 746e9dfd-18cf-49ee-b905-a45ec7bf51e2 received NewYieldedExportTxs [].
[CallCreate] Endpoint "create" called on instance "App" for owners [("PAB",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "0a18b6ceab327b4d20a3f26f9357bac21846d490a07b6674979d8c9b")) (StakeRefBase (KeyHashObj (KeyHash "0db4a470c0b1e3088ee6db01d7a0931055647f68ee861b10248904ab")))))].
[Comment] The failure of the wallet to balance should be promptly reported.
[runContract] Instance 746e9dfd-18cf-49ee-b905-a45ec7bf51e2 received NewActiveEndpoints [].
[runContract] Instance 746e9dfd-18cf-49ee-b905-a45ec7bf51e2 received NewObservableState (Object (fromList [("contents",Array [String "9960e019-f8a4-4fa6-b9d6-b786693b7641",String "create",Object (fromList [("contents",Object (fromList [("contents",Object (fromList [("contents",String "FailureResponse (Request {requestPath = (BaseUrl {baseUrlScheme = Http, baseUrlHost = \"localhost\", baseUrlPort = 8090, baseUrlPath = \"\"},\"/v2/wallets/a511241b6a1d0811d18c0be6ccd714f2e20b288f/transactions-balance\"), requestQueryString = fromList [], requestBody = Just ((),application/json;charset=utf-8), requestAccept = fromList [application/json;charset=utf-8,application/json], requestHeaders = fromList []), requestHttpVersion = HTTP/1.1, requestMethod = \"POST\"} (Response {responseStatusCode = Status {statusCode = 403, statusMessage = \"Forbidden\"}, responseHeaders = fromList [(\"Transfer-Encoding\",\"chunked\"),(\"Date\",\"Fri, 08 Apr 2022 02:25:21 GMT\"),(\"Server\",\"Warp/3.3.18\"),(\"Content-Type\",\"application/json;charset=utf-8\")], responseHttpVersion = HTTP/1.1, responseBody = \"{\\\"code\\\":\\\"not_enough_money\\\",\\\"message\\\":\\\"I can't process this payment as there are not enough funds available in the wallet. I am missing: coin: 0.800000 tokens: [] \\\"}\"})"),("tag",String "OtherError")])),("tag",String "WalletContractError")])),("tag",String "OtherContractError")])]),("tag",String "EndpointException")])).
[runContract] Instance 746e9dfd-18cf-49ee-b905-a45ec7bf51e2 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[ShouldFail] Operations failed as expected: CliError {unCliError = "[awaitApp] Received unexpected response OtherContractError (WalletContractError (OtherError \"FailureResponse (Request {requestPath = (BaseUrl {baseUrlScheme = Http, baseUrlHost = \\\"localhost\\\", baseUrlPort = 8090, baseUrlPath = \\\"\\\"},\\\"/v2/wallets/a511241b6a1d0811d18c0be6ccd714f2e20b288f/transactions-balance\\\"), requestQueryString = fromList [], requestBody = Just ((),application/json;charset=utf-8), requestAccept = fromList [application/json;charset=utf-8,application/json], requestHeaders = fromList []), requestHttpVersion = HTTP/1.1, requestMethod = \\\"POST\\\"} (Response {responseStatusCode = Status {statusCode = 403, statusMessage = \\\"Forbidden\\\"}, responseHeaders = fromList [(\\\"Transfer-Encoding\\\",\\\"chunked\\\"),(\\\"Date\\\",\\\"Fri, 08 Apr 2022 02:25:21 GMT\\\"),(\\\"Server\\\",\\\"Warp/3.3.18\\\"),(\\\"Content-Type\\\",\\\"application/json;charset=utf-8\\\")], responseHttpVersion = HTTP/1.1, responseBody = \\\"{\\\\\\\"code\\\\\\\":\\\\\\\"not_enough_money\\\\\\\",\\\\\\\"message\\\\\\\":\\\\\\\"I can't process this payment as there are not enough funds available in the wallet. I am missing: coin: 0.800000 tokens: [] \\\\\\\"}\\\"})\"))."} occurred for [AwaitCreate {poInstance = "App"}].
[Comment] Stop the application.
[Stop] Instance "App" stopped.
***** PASSED *****
[runContract] Instance 746e9dfd-18cf-49ee-b905-a45ec7bf51e2 received ContractFinished Nothing.
