
***** Test "Contract for Differences" *****
[Comment] Create the wallet for the party, fund it with 80 ADA, and activate the Marlowe endpoints.
[CreateWallet] Created wallet a7c6a264dbaa9ca79a9f6c1824c87c3f6b8b1a14 for role "Party".
[FundWallet] Funded wallet a7c6a264dbaa9ca79a9f6c1824c87c3f6b8b1a14 for role "Party" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance 03dc80e0-da03-4b8a-a67a-a911853bee37 for role "Party".
[Comment] Create the wallet for the counterparty, fund it with 60 ADA, and activate the Marlowe endpoints.
[runContract] Instance 03dc80e0-da03-4b8a-a67a-a911853bee37 received NewObservableState Null.
[runContract] Instance 03dc80e0-da03-4b8a-a67a-a911853bee37 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 03dc80e0-da03-4b8a-a67a-a911853bee37 received NewYieldedExportTxs [].
[CreateWallet] Created wallet db972e2b45f72e547ade8878e65bffa9257b4f4c for role "Counterparty".
[FundWallet] Funded wallet db972e2b45f72e547ade8878e65bffa9257b4f4c for role "Counterparty" with valueFromList [(AdaAssetId,60000000)].
[ActivateApp] Activated MarloweApp instance 393f2051-7fe4-4860-908f-a4e60f556adb for role "Counterparty".
[Comment] Create the wallet for the oracle, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance 393f2051-7fe4-4860-908f-a4e60f556adb received NewObservableState Null.
[runContract] Instance 393f2051-7fe4-4860-908f-a4e60f556adb received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 393f2051-7fe4-4860-908f-a4e60f556adb received NewYieldedExportTxs [].
[CreateWallet] Created wallet 503688af2f084e20e0d157167adb9e989ba875e4 for role "Oracle".
[FundWallet] Funded wallet 503688af2f084e20e0d157167adb9e989ba875e4 for role "Oracle" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance a0f58715-90c0-4cab-b51d-1cf179fb7728 for role "Oracle".
[Comment] The oracle creates the contract with differences, which was downloaded from Marlowe Playground. The party deposits 20 ADA to cover the margin collateral and the counterparty deposits 30 ADA.
[CallCreate] Endpoint "create" called on instance a0f58715-90c0-4cab-b51d-1cf179fb7728 for owners [("Party",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "bb57d32f2aeb26865daa56f6264668833e5d3af21824996806af8ff9")) (StakeRefBase (KeyHashObj (KeyHash "5a83978c0880dcc676e4182aa289302c762ab8172ecb6ce0548db12d"))))),("Counterparty",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "3cab435b4d49cc05b98cdf000e7d181aad65b4a7b9f598b769ff80f0")) (StakeRefBase (KeyHashObj (KeyHash "94fda5ca711e27c78bd995e83e8a5379224221d44a74b68ec964c8cb"))))),("Oracle",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "03b77b158491993a1ab84f29f823f3170ccc6005332cb7ba9b487e7d")) (StakeRefBase (KeyHashObj (KeyHash "8d7b11070d0f2bdbb2c187c72dd90d6fd9afb69974b11535acab393b")))))].
[runContract] Instance a0f58715-90c0-4cab-b51d-1cf179fb7728 received NewObservableState Null.
[runContract] Instance a0f58715-90c0-4cab-b51d-1cf179fb7728 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance a0f58715-90c0-4cab-b51d-1cf179fb7728 received NewYieldedExportTxs [].
[runContract] Instance a0f58715-90c0-4cab-b51d-1cf179fb7728 received NewActiveEndpoints [].
[runContract] Instance a0f58715-90c0-4cab-b51d-1cf179fb7728 received NewObservableState (Object (fromList [("contents",Array [String "34d738cd-c7c9-481b-b372-686849156890",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "c364f2a1c34630b6e89a7a9159d04e85624144e0f997fabe9c4625fa"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "7f52bf9e76ba0cb3880c3a32456dc88d65ff967413ef85d2f22d07e0")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance a0f58715-90c0-4cab-b51d-1cf179fb7728 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed with MarloweParams {rolePayoutValidatorHash = c364f2a1c34630b6e89a7a9159d04e85624144e0f997fabe9c4625fa, rolesCurrency = 7f52bf9e76ba0cb3880c3a32456dc88d65ff967413ef85d2f22d07e0}.
[Comment] The oracle should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the party and counterparty along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,13416122),(AssetId "7f52bf9e76ba0cb3880c3a32456dc88d65ff967413ef85d2f22d07e0" "Oracle",1)].
[Comment] The party and counterpary should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,82000000),(AssetId "7f52bf9e76ba0cb3880c3a32456dc88d65ff967413ef85d2f22d07e0" "Party",1)].
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,62000000),(AssetId "7f52bf9e76ba0cb3880c3a32456dc88d65ff967413ef85d2f22d07e0" "Counterparty",1)].
[Comment] The party and counterparty each need to follow the contract created by the mediator.
[Follow] Instance 03dc80e0-da03-4b8a-a67a-a911853bee37 now follows instance a0f58715-90c0-4cab-b51d-1cf179fb7728.
[Follow] Instance 393f2051-7fe4-4860-908f-a4e60f556adb now follows instance a0f58715-90c0-4cab-b51d-1cf179fb7728.
[Comment] The party deposits their 20 ADA margin.
[CallApplyInputs] Endpoint "apply-inputs" called on 03dc80e0-da03-4b8a-a67a-a911853bee37 for inputs [ClientInput (IDeposit "Party" "Party" (Token "" "") 20000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 03dc80e0-da03-4b8a-a67a-a911853bee37 received NewActiveEndpoints [].
[runContract] Instance 03dc80e0-da03-4b8a-a67a-a911853bee37 received NewObservableState (Object (fromList [("contents",Array [String "bb50ce0e-36bd-4690-8444-8a12a548cfcf",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[AwaitApplyInputs] Input application confirmed.
[Comment] The party should have about 62 ADA now, since they paid 20 ADA for the margin, but there is up to an additional 2 ADA in fees.
[runContract] Instance 03dc80e0-da03-4b8a-a67a-a911853bee37 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,60549087),(AssetId "7f52bf9e76ba0cb3880c3a32456dc88d65ff967413ef85d2f22d07e0" "Party",1)].
[Comment] The counterparty deposits their 30 ADA margin.
[CallApplyInputs] Endpoint "apply-inputs" called on 393f2051-7fe4-4860-908f-a4e60f556adb for inputs [ClientInput (IDeposit "Counterparty" "Counterparty" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 393f2051-7fe4-4860-908f-a4e60f556adb received NewActiveEndpoints [].
[runContract] Instance 393f2051-7fe4-4860-908f-a4e60f556adb received NewObservableState (Object (fromList [("contents",Array [String "1543f41b-e742-46a5-bd20-5a197e1c71cb",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 393f2051-7fe4-4860-908f-a4e60f556adb received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The counterparty should have about 32 ADA now, since they paid 30 ADA for the margin purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,30532645),(AssetId "7f52bf9e76ba0cb3880c3a32456dc88d65ff967413ef85d2f22d07e0" "Counterparty",1)].
[Comment] The oracle reports that the price is 10 ADA in the first window.
[CallApplyInputs] Endpoint "apply-inputs" called on a0f58715-90c0-4cab-b51d-1cf179fb7728 for inputs [ClientInput (IChoice (ChoiceId "Price in first window" "Oracle") 10000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance a0f58715-90c0-4cab-b51d-1cf179fb7728 received NewActiveEndpoints [].
[runContract] Instance a0f58715-90c0-4cab-b51d-1cf179fb7728 received NewObservableState (Object (fromList [("contents",Array [String "b4e6ded8-c1c9-4036-8456-833688013484",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance a0f58715-90c0-4cab-b51d-1cf179fb7728 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should still have 14 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,11863233),(AssetId "7f52bf9e76ba0cb3880c3a32456dc88d65ff967413ef85d2f22d07e0" "Oracle",1)].
[Comment] The oracle reports that the price is 25 ADA in the second window.
[WaitFor] Waited for 12000 milliseconds.
[CallApplyInputs] Endpoint "apply-inputs" called on a0f58715-90c0-4cab-b51d-1cf179fb7728 for inputs [ClientInput (IChoice (ChoiceId "Price in second window" "Oracle") 25000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance a0f58715-90c0-4cab-b51d-1cf179fb7728 received NewActiveEndpoints [].
[runContract] Instance a0f58715-90c0-4cab-b51d-1cf179fb7728 received NewObservableState (Object (fromList [("contents",Array [String "e61de431-1734-4158-ba1d-4bb07583e1b9",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance a0f58715-90c0-4cab-b51d-1cf179fb7728 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should have 16 ADA now because they received their original min-ADA deposit back, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12104543),(AssetId "7f52bf9e76ba0cb3880c3a32456dc88d65ff967413ef85d2f22d07e0" "Oracle",1)].
[Comment] Now the party redeems from the payout script the 5 ADA remaining from their margin.
[CallRedeem] Endpoint "redeem" called on 03dc80e0-da03-4b8a-a67a-a911853bee37 for role "Party".
[runContract] Instance 03dc80e0-da03-4b8a-a67a-a911853bee37 received NewActiveEndpoints [].
[runContract] Instance 03dc80e0-da03-4b8a-a67a-a911853bee37 received NewObservableState (Object (fromList [("contents",Array [String "835fbbd1-1955-45c4-be53-582d60e4b7c8",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 03dc80e0-da03-4b8a-a67a-a911853bee37 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The party should now have 67 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,65103482),(AssetId "7f52bf9e76ba0cb3880c3a32456dc88d65ff967413ef85d2f22d07e0" "Party",1)].
[Comment] Now the counterparty redeems their 45 ADA from the payout script.
[CallRedeem] Endpoint "redeem" called on 393f2051-7fe4-4860-908f-a4e60f556adb for role "Counterparty".
[runContract] Instance 393f2051-7fe4-4860-908f-a4e60f556adb received NewActiveEndpoints [].
[runContract] Instance 393f2051-7fe4-4860-908f-a4e60f556adb received NewObservableState (Object (fromList [("contents",Array [String "05c02d96-e885-4366-8151-b6c830252047",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 393f2051-7fe4-4860-908f-a4e60f556adb received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The counterparty should now have 77 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,75059840),(AssetId "7f52bf9e76ba0cb3880c3a32456dc88d65ff967413ef85d2f22d07e0" "Counterparty",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 03dc80e0-da03-4b8a-a67a-a911853bee37 received ContractFinished Nothing.
[Stop] Instance 03dc80e0-da03-4b8a-a67a-a911853bee37 stopped.
[Stop] Instance 393f2051-7fe4-4860-908f-a4e60f556adb stopped.
[runContract] Instance 393f2051-7fe4-4860-908f-a4e60f556adb received ContractFinished Nothing.
[Stop] Instance a0f58715-90c0-4cab-b51d-1cf179fb7728 stopped.
***** SUCCEEDED *****
[runContract] Instance a0f58715-90c0-4cab-b51d-1cf179fb7728 received ContractFinished Nothing.
