
***** Test "Contract for Differences" *****
[Comment] Create the wallet for the party, fund it with 80 ADA, and activate the Marlowe endpoints.
[CreateWallet] Created wallet 488dd1a9ace3e1f6a6aaf9bed9cea4722eacf2b8 for role "Party".
[FundWallet] Funded wallet 488dd1a9ace3e1f6a6aaf9bed9cea4722eacf2b8 for role "Party" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance 9a6a0028-15a1-47fe-a51e-f3c7a2e468a7 for role "Party".
[Comment] Create the wallet for the counterparty, fund it with 60 ADA, and activate the Marlowe endpoints.
[runContract] Instance 9a6a0028-15a1-47fe-a51e-f3c7a2e468a7 received NewObservableState Null.
[runContract] Instance 9a6a0028-15a1-47fe-a51e-f3c7a2e468a7 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 9a6a0028-15a1-47fe-a51e-f3c7a2e468a7 received NewYieldedExportTxs [].
[CreateWallet] Created wallet 5843d9a10beb39b264d7d6141ffd7b83d9e40132 for role "Counterparty".
[FundWallet] Funded wallet 5843d9a10beb39b264d7d6141ffd7b83d9e40132 for role "Counterparty" with valueFromList [(AdaAssetId,60000000)].
[ActivateApp] Activated MarloweApp instance 3814d724-0130-4dd3-99fa-a77ee855d4b3 for role "Counterparty".
[Comment] Create the wallet for the oracle, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance 3814d724-0130-4dd3-99fa-a77ee855d4b3 received NewObservableState Null.
[runContract] Instance 3814d724-0130-4dd3-99fa-a77ee855d4b3 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 3814d724-0130-4dd3-99fa-a77ee855d4b3 received NewYieldedExportTxs [].
[CreateWallet] Created wallet a735fb583bfd223afb2759b4522a2378708493a6 for role "Oracle".
[FundWallet] Funded wallet a735fb583bfd223afb2759b4522a2378708493a6 for role "Oracle" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance 3aef4b5c-7a49-4808-a38c-09bee9844186 for role "Oracle".
[Comment] The oracle creates the contract with differences, which was downloaded from Marlowe Playground. The party deposits 20 ADA to cover the margin collateral and the counterparty deposits 30 ADA.
[CallCreate] Endpoint "create" called on instance 3aef4b5c-7a49-4808-a38c-09bee9844186 for owners [("Party",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "5a2f6b74e0036b9877c150d18fa06dfebdad7363f3f3720e0e6ef976")) (StakeRefBase (KeyHashObj (KeyHash "0d32f1c4da70debbc6b0e7cc900ca7e601d9c2fc8528bae836ad49f5"))))),("Counterparty",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "7e1b43e0dbec237d783cb25da4d5997454f50d6583c313589798fdcc")) (StakeRefBase (KeyHashObj (KeyHash "2146a46e6857eb0f6fccd4c5e1bccae65099f705c8b59c2b28d543ae"))))),("Oracle",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "b11f408ee4bb24c47b0e1c4a565f6040bcd8c55e71335824a55cd5a3")) (StakeRefBase (KeyHashObj (KeyHash "335f0038eb5b608df8460ede5f2ae77378bafa854efc0432bd384569")))))].
[runContract] Instance 3aef4b5c-7a49-4808-a38c-09bee9844186 received NewObservableState Null.
[runContract] Instance 3aef4b5c-7a49-4808-a38c-09bee9844186 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 3aef4b5c-7a49-4808-a38c-09bee9844186 received NewYieldedExportTxs [].
[runContract] Instance 3aef4b5c-7a49-4808-a38c-09bee9844186 received NewActiveEndpoints [].
[runContract] Instance 3aef4b5c-7a49-4808-a38c-09bee9844186 received NewObservableState (Object (fromList [("contents",Array [String "6ddb26ee-4f9e-4c6d-934a-b18c303dd4a6",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "76805b7cdd4a7bc911f54699a5756b30ed8ab9321143b6326c46cec4"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "f17a1e0bf7ec3dbff18f999a26ac6c0dbbd0937711e441d0fc732892")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 3aef4b5c-7a49-4808-a38c-09bee9844186 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed with MarloweParams {rolePayoutValidatorHash = 76805b7cdd4a7bc911f54699a5756b30ed8ab9321143b6326c46cec4, rolesCurrency = f17a1e0bf7ec3dbff18f999a26ac6c0dbbd0937711e441d0fc732892}.
[Comment] The oracle should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the party and counterparty along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,13416122),(AssetId "f17a1e0bf7ec3dbff18f999a26ac6c0dbbd0937711e441d0fc732892" "Oracle",1)].
[Comment] The party and counterpary should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,82000000),(AssetId "f17a1e0bf7ec3dbff18f999a26ac6c0dbbd0937711e441d0fc732892" "Party",1)].
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,62000000),(AssetId "f17a1e0bf7ec3dbff18f999a26ac6c0dbbd0937711e441d0fc732892" "Counterparty",1)].
[Comment] The party and counterparty each need to follow the contract created by the mediator.
[Follow] Instance 9a6a0028-15a1-47fe-a51e-f3c7a2e468a7 now follows instance 3aef4b5c-7a49-4808-a38c-09bee9844186.
[Follow] Instance 3814d724-0130-4dd3-99fa-a77ee855d4b3 now follows instance 3aef4b5c-7a49-4808-a38c-09bee9844186.
[Comment] The party deposits their 20 ADA margin.
[CallApplyInputs] Endpoint "apply-inputs" called on 9a6a0028-15a1-47fe-a51e-f3c7a2e468a7 for inputs [ClientInput (IDeposit "Party" "Party" (Token "" "") 20000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 9a6a0028-15a1-47fe-a51e-f3c7a2e468a7 received NewActiveEndpoints [].
[runContract] Instance 9a6a0028-15a1-47fe-a51e-f3c7a2e468a7 received NewObservableState (Object (fromList [("contents",Array [String "adc4e227-5537-49d2-a24e-ca1d99197847",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 9a6a0028-15a1-47fe-a51e-f3c7a2e468a7 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The party should have about 62 ADA now, since they paid 20 ADA for the margin, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,60543867),(AssetId "f17a1e0bf7ec3dbff18f999a26ac6c0dbbd0937711e441d0fc732892" "Party",1)].
[Comment] The counterparty deposits their 30 ADA margin.
[CallApplyInputs] Endpoint "apply-inputs" called on 3814d724-0130-4dd3-99fa-a77ee855d4b3 for inputs [ClientInput (IDeposit "Counterparty" "Counterparty" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 3814d724-0130-4dd3-99fa-a77ee855d4b3 received NewActiveEndpoints [].
[runContract] Instance 3814d724-0130-4dd3-99fa-a77ee855d4b3 received NewObservableState (Object (fromList [("contents",Array [String "6e616316-f059-4307-8a28-04c9b028556a",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 3814d724-0130-4dd3-99fa-a77ee855d4b3 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The counterparty should have about 32 ADA now, since they paid 30 ADA for the margin purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,30520425),(AssetId "f17a1e0bf7ec3dbff18f999a26ac6c0dbbd0937711e441d0fc732892" "Counterparty",1)].
[Comment] The oracle reports that the price is 10 ADA in the first window.
[CallApplyInputs] Endpoint "apply-inputs" called on 3aef4b5c-7a49-4808-a38c-09bee9844186 for inputs [ClientInput (IChoice (ChoiceId "Price in first window" "Oracle") 10000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 3aef4b5c-7a49-4808-a38c-09bee9844186 received NewActiveEndpoints [].
[runContract] Instance 3aef4b5c-7a49-4808-a38c-09bee9844186 received NewObservableState (Object (fromList [("contents",Array [String "b9e8665c-0454-4069-997a-a1c879a5fa08",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 3aef4b5c-7a49-4808-a38c-09bee9844186 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should still have 14 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,11856233),(AssetId "f17a1e0bf7ec3dbff18f999a26ac6c0dbbd0937711e441d0fc732892" "Oracle",1)].
[Comment] The oracle reports that the price is 25 ADA in the second window.
[WaitFor] Waited for 12000 milliseconds.
[CallApplyInputs] Endpoint "apply-inputs" called on 3aef4b5c-7a49-4808-a38c-09bee9844186 for inputs [ClientInput (IChoice (ChoiceId "Price in second window" "Oracle") 25000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 3aef4b5c-7a49-4808-a38c-09bee9844186 received NewActiveEndpoints [].
[runContract] Instance 3aef4b5c-7a49-4808-a38c-09bee9844186 received NewObservableState (Object (fromList [("contents",Array [String "7fab3818-515c-40af-b0a9-2ac450e5d97b",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 3aef4b5c-7a49-4808-a38c-09bee9844186 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should still have 16 ADA now because they received their original min-ADA deposit back, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12097543),(AssetId "f17a1e0bf7ec3dbff18f999a26ac6c0dbbd0937711e441d0fc732892" "Oracle",1)].
[Comment] Now the party redeems from the payout script the 5 ADA remaining from their margin.
[CallRedeem] Endpoint "redeem" called on 9a6a0028-15a1-47fe-a51e-f3c7a2e468a7 for role "Party".
[runContract] Instance 9a6a0028-15a1-47fe-a51e-f3c7a2e468a7 received NewActiveEndpoints [].
[runContract] Instance 9a6a0028-15a1-47fe-a51e-f3c7a2e468a7 received NewObservableState (Object (fromList [("contents",Array [String "c1f8b49c-483e-49de-bcb6-2843ba403229",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 9a6a0028-15a1-47fe-a51e-f3c7a2e468a7 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The party should now have 67 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,65102706),(AssetId "f17a1e0bf7ec3dbff18f999a26ac6c0dbbd0937711e441d0fc732892" "Party",1)].
[Comment] Now the counterparty redeems their 45 ADA from the payout script.
[CallRedeem] Endpoint "redeem" called on 3814d724-0130-4dd3-99fa-a77ee855d4b3 for role "Counterparty".
[runContract] Instance 3814d724-0130-4dd3-99fa-a77ee855d4b3 received NewActiveEndpoints [].
[runContract] Instance 3814d724-0130-4dd3-99fa-a77ee855d4b3 received NewObservableState (Object (fromList [("contents",Array [String "48f5787f-a957-44ee-a88b-0b18d3d04043",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 3814d724-0130-4dd3-99fa-a77ee855d4b3 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The counterparty should now have 77 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,75047620),(AssetId "f17a1e0bf7ec3dbff18f999a26ac6c0dbbd0937711e441d0fc732892" "Counterparty",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 9a6a0028-15a1-47fe-a51e-f3c7a2e468a7 received ContractFinished Nothing.
[Stop] Instance 9a6a0028-15a1-47fe-a51e-f3c7a2e468a7 stopped.
[Stop] Instance 3814d724-0130-4dd3-99fa-a77ee855d4b3 stopped.
[runContract] Instance 3814d724-0130-4dd3-99fa-a77ee855d4b3 received ContractFinished Nothing.
[Stop] Instance 3aef4b5c-7a49-4808-a38c-09bee9844186 stopped.
***** SUCCEEDED *****
