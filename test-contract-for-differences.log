
***** Test "Contract for Differences" *****
[Comment] Create the wallet for the party, fund it with 80 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "happy lounge lemon shiver there husband crawl flag pretty vague later galaxy loud stem caught such hope reduce since tide adult dragon join small".
[createWallet] First wallet address is addr_test1qpfdxcn2y32ph49r7znrtlv0s93sr4d4uqtagstwxsc59s33g477f9sp9fpfy7cq50gr7u258kyptysukv8a67yn55qsygwhqp.
[createWallet] First public key hash is 52d3626a24541bd4a3f0a635fd8f816301d5b5e017d4416e343142c2.
[CreateWallet] Created wallet identified as 7b97964e01c6066bbcce8c3374f83aa9da4fb855 for role "Party".
[FundWallet] Funded wallet for role "Party" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance "PartyApp" with identifier bfe13707-d3c7-461f-b6c6-1effabd7a775 for role "Party".
[Comment] Create the wallet for the counterparty, fund it with 60 ADA, and activate the Marlowe endpoints.
[runContract] Instance bfe13707-d3c7-461f-b6c6-1effabd7a775 received NewObservableState Null.
[runContract] Instance bfe13707-d3c7-461f-b6c6-1effabd7a775 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance bfe13707-d3c7-461f-b6c6-1effabd7a775 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "wreck rocket flag tuition clinic wonder discover airport glance entry small whisper scrub shrimp coil velvet sad year debris senior carpet print whip blood".
[createWallet] First wallet address is addr_test1qrtmlqe3842d47jmxasm0xvdv35m9lpwgfwhdjmfm3xx6eaz69h78jjvwjarda7weywle3xqvttyfewuuqturq4herds93an27.
[createWallet] First public key hash is d7bf83313d54dafa5b3761b7998d6469b2fc2e425d76cb69dc4c6d67.
[CreateWallet] Created wallet identified as c1873afcf1a64c4efd4c0a3546424469dceab412 for role "Counterparty".
[FundWallet] Funded wallet for role "Counterparty" with valueFromList [(AdaAssetId,60000000)].
[ActivateApp] Activated MarloweApp instance "CounterpartyApp" with identifier d7bc5c3e-f20a-4ac0-909a-1d2f1b926d2d for role "Counterparty".
[Comment] Create the wallet for the oracle, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance d7bc5c3e-f20a-4ac0-909a-1d2f1b926d2d received NewObservableState Null.
[runContract] Instance d7bc5c3e-f20a-4ac0-909a-1d2f1b926d2d received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance d7bc5c3e-f20a-4ac0-909a-1d2f1b926d2d received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "debris slide same labor human era plug amount plunge sail impact shallow pipe jaguar boy grunt invest mountain kid police hard square mountain cube".
[createWallet] First wallet address is addr_test1qrlm9d99fpnyxjfj48mdz5u248azylgpknucn45ypyxjqexn9wt4q5faj6kjtz55clwxvzqtu7x57w708mnrgzakt4hsdzr3pp.
[createWallet] First public key hash is ffb2b4a54866434932a9f6d1538aa9fa227d01b4f989d684090d2064.
[CreateWallet] Created wallet identified as dc035b081c626e4cfb6c559b4007ce20322badea for role "Oracle".
[FundWallet] Funded wallet for role "Oracle" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance "OracleApp" with identifier d61d690f-296d-4908-8d2b-4f70a758aa3a for role "Oracle".
[Comment] The oracle creates the contract with differences, which was downloaded from Marlowe Playground. The party deposits 20 ADA to cover the margin collateral and the counterparty deposits 30 ADA.
[CallCreate] Endpoint "create" called on instance "OracleApp" for owners [("Party",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "52d3626a24541bd4a3f0a635fd8f816301d5b5e017d4416e343142c2")) (StakeRefBase (KeyHashObj (KeyHash "31457de496012a42927b00a3d03f71543d8815921cb30fdd7893a501"))))),("Counterparty",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "d7bf83313d54dafa5b3761b7998d6469b2fc2e425d76cb69dc4c6d67")) (StakeRefBase (KeyHashObj (KeyHash "a2d16fe3ca4c74ba36f7cec91dfcc4c062d644e5dce017c182b7c8db"))))),("Oracle",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "ffb2b4a54866434932a9f6d1538aa9fa227d01b4f989d684090d2064")) (StakeRefBase (KeyHashObj (KeyHash "d32b9750513d96ad258a94c7dc66080be78d4f3bcf3ee6340bb65d6f")))))].
[runContract] Instance d61d690f-296d-4908-8d2b-4f70a758aa3a received NewObservableState Null.
[runContract] Instance d61d690f-296d-4908-8d2b-4f70a758aa3a received NewActiveEndpoints [].
[runContract] Instance d61d690f-296d-4908-8d2b-4f70a758aa3a received NewYieldedExportTxs [].
[runContract] Instance d61d690f-296d-4908-8d2b-4f70a758aa3a received NewObservableState (Object (fromList [("contents",Array [String "db685ea6-ceb4-4f92-b3b6-dce0cef2df50",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "1e142321df77a7546f7ff2bf8d5aba9a28362258e517835cd73c1eba"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "62c91e39b4abeceda9e61b7dd65731ac506ffaa0f223f75217818f91")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance d61d690f-296d-4908-8d2b-4f70a758aa3a received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wp3vhdd8yqgfuqk6k0fk6q3csglsr5354xngpkarw7x3n4qxpl6zp and role address addr_test1wq0pggepmam6w4r00letlr26h2dzsd3ztrj30q6u6u7paws22e5vk with MarloweParams {rolePayoutValidatorHash = 1e142321df77a7546f7ff2bf8d5aba9a28362258e517835cd73c1eba, rolesCurrency = 62c91e39b4abeceda9e61b7dd65731ac506ffaa0f223f75217818f91}.
[Comment] The oracle should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the party and counterparty along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,13450409),(AssetId "62c91e39b4abeceda9e61b7dd65731ac506ffaa0f223f75217818f91" "Oracle",1)].
[Comment] The party and counterpary should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,82000000),(AssetId "62c91e39b4abeceda9e61b7dd65731ac506ffaa0f223f75217818f91" "Party",1)].
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,62000000),(AssetId "62c91e39b4abeceda9e61b7dd65731ac506ffaa0f223f75217818f91" "Counterparty",1)].
[Comment] The party and counterparty each need to follow the contract created by the mediator.
[Follow] Instance "PartyApp" now follows instance "OracleApp".
[Follow] Instance "CounterpartyApp" now follows instance "OracleApp".
[Comment] The party deposits their 20 ADA margin.
[runContract] Instance bfe13707-d3c7-461f-b6c6-1effabd7a775 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "PartyApp" for inputs [ClientInput (IDeposit "Party" "Party" (Token "" "") 20000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance bfe13707-d3c7-461f-b6c6-1effabd7a775 received NewObservableState (Object (fromList [("contents",Array [String "734ac97c-4ff5-4cd0-a589-8ba5e4bcd388",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance bfe13707-d3c7-461f-b6c6-1effabd7a775 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The party should have about 62 ADA now, since they paid 20 ADA for the margin, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,60594106),(AssetId "62c91e39b4abeceda9e61b7dd65731ac506ffaa0f223f75217818f91" "Party",1)].
[Comment] The counterparty deposits their 30 ADA margin.
[runContract] Instance d7bc5c3e-f20a-4ac0-909a-1d2f1b926d2d received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "CounterpartyApp" for inputs [ClientInput (IDeposit "Counterparty" "Counterparty" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance d7bc5c3e-f20a-4ac0-909a-1d2f1b926d2d received NewObservableState (Object (fromList [("contents",Array [String "6a22ab43-534f-4dcf-ae86-16ce8a3c39e9",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance d7bc5c3e-f20a-4ac0-909a-1d2f1b926d2d received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The counterparty should have about 32 ADA now, since they paid 30 ADA for the margin purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,30590244),(AssetId "62c91e39b4abeceda9e61b7dd65731ac506ffaa0f223f75217818f91" "Counterparty",1)].
[Comment] The oracle reports that the price is 10 ADA in the first window.
[runContract] Instance d61d690f-296d-4908-8d2b-4f70a758aa3a received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OracleApp" for inputs [ClientInput (IChoice (ChoiceId "Price in first window" "Oracle") 10000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance d61d690f-296d-4908-8d2b-4f70a758aa3a received NewObservableState (Object (fromList [("contents",Array [String "364be4f1-5edc-4af6-993c-346c2d42e6ed",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance d61d690f-296d-4908-8d2b-4f70a758aa3a received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should still have 14 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,11881679),(AssetId "62c91e39b4abeceda9e61b7dd65731ac506ffaa0f223f75217818f91" "Oracle",1)].
[Comment] The oracle reports that the price is 25 ADA in the second window.
[WaitFor] Waited for 12000 milliseconds.
[runContract] Instance d61d690f-296d-4908-8d2b-4f70a758aa3a received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OracleApp" for inputs [ClientInput (IChoice (ChoiceId "Price in second window" "Oracle") 25000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance d61d690f-296d-4908-8d2b-4f70a758aa3a received NewObservableState (Object (fromList [("contents",Array [String "fde8a5a2-8ac0-4af8-b15a-54345656bc2a",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance d61d690f-296d-4908-8d2b-4f70a758aa3a received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should have 16 ADA now because they received their original min-ADA deposit back, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12280294),(AssetId "62c91e39b4abeceda9e61b7dd65731ac506ffaa0f223f75217818f91" "Oracle",1)].
[Comment] Now the party redeems from the payout script the 5 ADA remaining from their margin.
[runContract] Instance bfe13707-d3c7-461f-b6c6-1effabd7a775 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "PartyApp" for role "Party".
[runContract] Instance bfe13707-d3c7-461f-b6c6-1effabd7a775 received NewObservableState (Object (fromList [("contents",Array [String "5cb46915-3c0a-474c-b434-2ffbdea19825",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[AwaitRedeem] Redemption confirmed.
[Comment] The party should now have 67 ADA, but they may have paid up to 1 ADA more in fees.
[runContract] Instance bfe13707-d3c7-461f-b6c6-1effabd7a775 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,65169952),(AssetId "62c91e39b4abeceda9e61b7dd65731ac506ffaa0f223f75217818f91" "Party",1)].
[Comment] Now the counterparty redeems their 45 ADA from the payout script.
[runContract] Instance d7bc5c3e-f20a-4ac0-909a-1d2f1b926d2d received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "CounterpartyApp" for role "Counterparty".
[runContract] Instance d7bc5c3e-f20a-4ac0-909a-1d2f1b926d2d received NewObservableState (Object (fromList [("contents",Array [String "2254269e-2704-442c-9510-e9cee361e1c2",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance d7bc5c3e-f20a-4ac0-909a-1d2f1b926d2d received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The counterparty should now have 77 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,75137098),(AssetId "62c91e39b4abeceda9e61b7dd65731ac506ffaa0f223f75217818f91" "Counterparty",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance bfe13707-d3c7-461f-b6c6-1effabd7a775 received ContractFinished Nothing.
[Stop] Instance "PartyApp" stopped.
[Stop] Instance "CounterpartyApp" stopped.
[runContract] Instance d7bc5c3e-f20a-4ac0-909a-1d2f1b926d2d received ContractFinished Nothing.
[Stop] Instance "OracleApp" stopped.
[runContract] Instance d61d690f-296d-4908-8d2b-4f70a758aa3a received ContractFinished Nothing.
***** PASSED *****
