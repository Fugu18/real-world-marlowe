
***** Test "Contract for Differences" *****
[Comment] Create the wallet for the party, fund it with 80 ADA, and activate the Marlowe endpoints.
[CreateWallet] Created wallet a8425b1d93f6811c11d698ff42da304ac746c872 for role "Party".
[FundWallet] Funded wallet a8425b1d93f6811c11d698ff42da304ac746c872 for role "Party" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance d7dc9a90-15a8-4e2b-bb2c-51f76a6bc62a for role "Party".
[Comment] Create the wallet for the counterparty, fund it with 60 ADA, and activate the Marlowe endpoints.
[runContract] Instance d7dc9a90-15a8-4e2b-bb2c-51f76a6bc62a received NewObservableState Null.
[runContract] Instance d7dc9a90-15a8-4e2b-bb2c-51f76a6bc62a received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance d7dc9a90-15a8-4e2b-bb2c-51f76a6bc62a received NewYieldedExportTxs [].
[CreateWallet] Created wallet 91b82de33ed0e24ba7105b325d99ef2d69770ce7 for role "Counterparty".
[FundWallet] Funded wallet 91b82de33ed0e24ba7105b325d99ef2d69770ce7 for role "Counterparty" with valueFromList [(AdaAssetId,60000000)].
[ActivateApp] Activated MarloweApp instance e861f843-1ccf-4721-a653-671fb640e256 for role "Counterparty".
[Comment] Create the wallet for the oracle, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance e861f843-1ccf-4721-a653-671fb640e256 received NewObservableState Null.
[runContract] Instance e861f843-1ccf-4721-a653-671fb640e256 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance e861f843-1ccf-4721-a653-671fb640e256 received NewYieldedExportTxs [].
[CreateWallet] Created wallet 733544493fdfb2ebb1e547dff88864109a7d2a1a for role "Oracle".
[FundWallet] Funded wallet 733544493fdfb2ebb1e547dff88864109a7d2a1a for role "Oracle" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance 48bd3f54-5bc6-4f44-a2f0-842f431db576 for role "Oracle".
[Comment] The oracle creates the contract with differences, which was downloaded from Marlowe Playground. The party deposits 20 ADA to cover the margin collateral and the counterparty deposits 30 ADA.
[CallCreate] Endpoint "create" called on instance 48bd3f54-5bc6-4f44-a2f0-842f431db576 for owners [("Party",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "6624822082a63709fa907b8e84357aef39db84835f8a0e85421bf12f")) (StakeRefBase (KeyHashObj (KeyHash "355b0c94d0b7700065587caa063bec07e1ae794376b4c6db6754bc3f"))))),("Counterparty",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "b9e5ab80c698af7c10b5ed5f0918424ddf83ad46b7bef3fe489c45aa")) (StakeRefBase (KeyHashObj (KeyHash "d7fb0a0b404ec868c952c4e99ad8965a5e7f63dd690df0a5d9f315f4"))))),("Oracle",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "c8dc2b97066f1df7be327c9b9394cc7d4b0cc309dea6eb669afa5ab2")) (StakeRefBase (KeyHashObj (KeyHash "369eb254a26de45b14f242b36bc461361f6daaa0931f4f0741244ea8")))))].
[runContract] Instance 48bd3f54-5bc6-4f44-a2f0-842f431db576 received NewObservableState Null.
[runContract] Instance 48bd3f54-5bc6-4f44-a2f0-842f431db576 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 48bd3f54-5bc6-4f44-a2f0-842f431db576 received NewYieldedExportTxs [].
[runContract] Instance 48bd3f54-5bc6-4f44-a2f0-842f431db576 received NewActiveEndpoints [].
[runContract] Instance 48bd3f54-5bc6-4f44-a2f0-842f431db576 received NewObservableState (Object (fromList [("contents",Array [String "4ab09680-5015-407a-aeda-914756c3de01",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "639f25c67792ed2798574db4a9f27ee556db94ba906d1d77a641dbc7"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "5c7de96bb7ebe13c8c75f970910dd1ee607280f6fbd67a1f00d1f96d")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 48bd3f54-5bc6-4f44-a2f0-842f431db576 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed with MarloweParams {rolePayoutValidatorHash = 639f25c67792ed2798574db4a9f27ee556db94ba906d1d77a641dbc7, rolesCurrency = 5c7de96bb7ebe13c8c75f970910dd1ee607280f6fbd67a1f00d1f96d}.
[Comment] The oracle should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the party and counterparty along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,13450409),(AssetId "5c7de96bb7ebe13c8c75f970910dd1ee607280f6fbd67a1f00d1f96d" "Oracle",1)].
[Comment] The party and counterpary should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,82000000),(AssetId "5c7de96bb7ebe13c8c75f970910dd1ee607280f6fbd67a1f00d1f96d" "Party",1)].
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,62000000),(AssetId "5c7de96bb7ebe13c8c75f970910dd1ee607280f6fbd67a1f00d1f96d" "Counterparty",1)].
[Comment] The party and counterparty each need to follow the contract created by the mediator.
[Follow] Instance d7dc9a90-15a8-4e2b-bb2c-51f76a6bc62a now follows instance 48bd3f54-5bc6-4f44-a2f0-842f431db576.
[Follow] Instance e861f843-1ccf-4721-a653-671fb640e256 now follows instance 48bd3f54-5bc6-4f44-a2f0-842f431db576.
[Comment] The party deposits their 20 ADA margin.
[CallApplyInputs] Endpoint "apply-inputs" called on d7dc9a90-15a8-4e2b-bb2c-51f76a6bc62a for inputs [ClientInput (IDeposit "Party" "Party" (Token "" "") 20000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance d7dc9a90-15a8-4e2b-bb2c-51f76a6bc62a received NewActiveEndpoints [].
[runContract] Instance d7dc9a90-15a8-4e2b-bb2c-51f76a6bc62a received NewObservableState (Object (fromList [("contents",Array [String "9e72af41-2853-4634-842c-a27374463925",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance d7dc9a90-15a8-4e2b-bb2c-51f76a6bc62a received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The party should have about 62 ADA now, since they paid 20 ADA for the margin, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,60682547),(AssetId "5c7de96bb7ebe13c8c75f970910dd1ee607280f6fbd67a1f00d1f96d" "Party",1)].
[Comment] The counterparty deposits their 30 ADA margin.
[CallApplyInputs] Endpoint "apply-inputs" called on e861f843-1ccf-4721-a653-671fb640e256 for inputs [ClientInput (IDeposit "Counterparty" "Counterparty" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance e861f843-1ccf-4721-a653-671fb640e256 received NewActiveEndpoints [].
[runContract] Instance e861f843-1ccf-4721-a653-671fb640e256 received NewObservableState (Object (fromList [("contents",Array [String "b9a3dfeb-587d-49e3-bc2a-1809f9630291",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance e861f843-1ccf-4721-a653-671fb640e256 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The counterparty should have about 32 ADA now, since they paid 30 ADA for the margin purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,30665763),(AssetId "5c7de96bb7ebe13c8c75f970910dd1ee607280f6fbd67a1f00d1f96d" "Counterparty",1)].
[Comment] The oracle reports that the price is 10 ADA in the first window.
[CallApplyInputs] Endpoint "apply-inputs" called on 48bd3f54-5bc6-4f44-a2f0-842f431db576 for inputs [ClientInput (IChoice (ChoiceId "Price in first window" "Oracle") 10000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 48bd3f54-5bc6-4f44-a2f0-842f431db576 received NewActiveEndpoints [].
[runContract] Instance 48bd3f54-5bc6-4f44-a2f0-842f431db576 received NewObservableState (Object (fromList [("contents",Array [String "1f266b50-6d60-4440-87c8-445223c4c9fc",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 48bd3f54-5bc6-4f44-a2f0-842f431db576 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should still have 14 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12050775),(AssetId "5c7de96bb7ebe13c8c75f970910dd1ee607280f6fbd67a1f00d1f96d" "Oracle",1)].
[Comment] The oracle reports that the price is 25 ADA in the second window.
[WaitFor] Waited for 12000 milliseconds.
[CallApplyInputs] Endpoint "apply-inputs" called on 48bd3f54-5bc6-4f44-a2f0-842f431db576 for inputs [ClientInput (IChoice (ChoiceId "Price in second window" "Oracle") 25000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 48bd3f54-5bc6-4f44-a2f0-842f431db576 received NewActiveEndpoints [].
[runContract] Instance 48bd3f54-5bc6-4f44-a2f0-842f431db576 received NewObservableState (Object (fromList [("contents",Array [String "71a219ed-5862-4316-9ad8-25ffc2503122",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 48bd3f54-5bc6-4f44-a2f0-842f431db576 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should have 16 ADA now because they received their original min-ADA deposit back, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12486491),(AssetId "5c7de96bb7ebe13c8c75f970910dd1ee607280f6fbd67a1f00d1f96d" "Oracle",1)].
[Comment] Now the party redeems from the payout script the 5 ADA remaining from their margin.
[CallRedeem] Endpoint "redeem" called on d7dc9a90-15a8-4e2b-bb2c-51f76a6bc62a for role "Party".
[runContract] Instance d7dc9a90-15a8-4e2b-bb2c-51f76a6bc62a received NewActiveEndpoints [].
[runContract] Instance d7dc9a90-15a8-4e2b-bb2c-51f76a6bc62a received NewObservableState (Object (fromList [("contents",Array [String "220779fe-dedc-40cf-8932-c786e21862a1",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance d7dc9a90-15a8-4e2b-bb2c-51f76a6bc62a received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The party should now have 67 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,65259754),(AssetId "5c7de96bb7ebe13c8c75f970910dd1ee607280f6fbd67a1f00d1f96d" "Party",1)].
[Comment] Now the counterparty redeems their 45 ADA from the payout script.
[CallRedeem] Endpoint "redeem" called on e861f843-1ccf-4721-a653-671fb640e256 for role "Counterparty".
[runContract] Instance e861f843-1ccf-4721-a653-671fb640e256 received NewActiveEndpoints [].
[runContract] Instance e861f843-1ccf-4721-a653-671fb640e256 received NewObservableState (Object (fromList [("contents",Array [String "7058587d-e723-4e65-b664-bf5ede5185c8",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance e861f843-1ccf-4721-a653-671fb640e256 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The counterparty should now have 77 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,75212617),(AssetId "5c7de96bb7ebe13c8c75f970910dd1ee607280f6fbd67a1f00d1f96d" "Counterparty",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance d7dc9a90-15a8-4e2b-bb2c-51f76a6bc62a received ContractFinished Nothing.
[Stop] Instance d7dc9a90-15a8-4e2b-bb2c-51f76a6bc62a stopped.
[Stop] Instance e861f843-1ccf-4721-a653-671fb640e256 stopped.
[runContract] Instance e861f843-1ccf-4721-a653-671fb640e256 received ContractFinished Nothing.
[Stop] Instance 48bd3f54-5bc6-4f44-a2f0-842f431db576 stopped.
***** SUCCEEDED *****
[runContract] Instance 48bd3f54-5bc6-4f44-a2f0-842f431db576 received ContractFinished Nothing.
