
***** Test "Contract for Differences" *****
[Comment] Create the wallet for the party, fund it with 80 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "choose solid vocal noise wage museum elevator arrest december copy consider oppose foster shield coach sweet ribbon essence amount account alone solution violin merit".
[createWallet] First wallet address is addr_test1qqszg6k50v25847r6uk9kdkq0yeccz9r5zps67pjhj082acrqavx32jqz7e0y059mvhntyh6kv7wemz8ht3r2t37qqmsn075pt.
[createWallet] First public key hash is 20246ad47b1543d7c3d72c5b36c079338c08a3a0830d7832bc9e7577.
[CreateWallet] Created wallet identified as 8fd70d21f6ee587f8fd21d4c95e418c2e689cefc for role "Party".
[FundWallet] Funded wallet for role "Party" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance "PartyApp" with identifier f6a99676-5557-4353-b8ca-8fbeccfa3bc1 for role "Party".
[Comment] Create the wallet for the counterparty, fund it with 60 ADA, and activate the Marlowe endpoints.
[runContract] Instance f6a99676-5557-4353-b8ca-8fbeccfa3bc1 received NewObservableState Null.
[runContract] Instance f6a99676-5557-4353-b8ca-8fbeccfa3bc1 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance f6a99676-5557-4353-b8ca-8fbeccfa3bc1 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "deputy wood armed canal blossom trade much blur settle unlock ring pride record erode autumn dune almost skate swallow corn fetch knock neither lunch".
[createWallet] First wallet address is addr_test1qq3n0scmvtjyvzverxs7mzpc2evdfaatdj4sa4zhz760nfnufeukg8thuqc744ysuqhyef8gv8mnuzcr5da9fev8dkpshnkgw8.
[createWallet] First public key hash is 2337c31b62e446099919a1ed88385658d4f7ab6cab0ed45717b4f9a6.
[CreateWallet] Created wallet identified as be069eb86faaa5159c35df80ba49680b3d83f21b for role "Counterparty".
[FundWallet] Funded wallet for role "Counterparty" with valueFromList [(AdaAssetId,60000000)].
[ActivateApp] Activated MarloweApp instance "CounterpartyApp" with identifier 35b70650-8294-4ee3-a55a-a480013b49d4 for role "Counterparty".
[Comment] Create the wallet for the oracle, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance 35b70650-8294-4ee3-a55a-a480013b49d4 received NewObservableState Null.
[runContract] Instance 35b70650-8294-4ee3-a55a-a480013b49d4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 35b70650-8294-4ee3-a55a-a480013b49d4 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "beyond powder inspire egg place canal hawk door rather duty discover sorry deny grass burger pass shiver stock title master shed torch expose upset".
[createWallet] First wallet address is addr_test1qrlvjyez7na7u6uywlf7r02dzvyf5anpkefvnfjjfvjtwuccyu38gmddq0k96skqp4kf2539hjw0xnw8pth8y4tsyljqqwzul4.
[createWallet] First public key hash is fec91322f4fbee6b8477d3e1bd4d13089a7661b652c9a6524b24b773.
[CreateWallet] Created wallet identified as 9a28b7f3d076d2ab65ac861a95650b42bafa3e61 for role "Oracle".
[FundWallet] Funded wallet for role "Oracle" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance "OracleApp" with identifier c94f2aff-0731-4cf4-a2af-3e9d25bed3c3 for role "Oracle".
[Comment] The oracle creates the contract with differences, which was downloaded from Marlowe Playground. The party deposits 20 ADA to cover the margin collateral and the counterparty deposits 30 ADA.
[CallCreate] Endpoint "create" called on instance "OracleApp" for owners [("Party",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "20246ad47b1543d7c3d72c5b36c079338c08a3a0830d7832bc9e7577")) (StakeRefBase (KeyHashObj (KeyHash "03075868aa4017b2f23e85db2f3592fab33cecec47bae2352e3e0037"))))),("Counterparty",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "2337c31b62e446099919a1ed88385658d4f7ab6cab0ed45717b4f9a6")) (StakeRefBase (KeyHashObj (KeyHash "7c4e79641d77e031ead490e02e4ca4e861f73e0b03a37a54e5876d83"))))),("Oracle",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "fec91322f4fbee6b8477d3e1bd4d13089a7661b652c9a6524b24b773")) (StakeRefBase (KeyHashObj (KeyHash "182722746dad03ec5d42c00d6c955225bc9cf34dc70aee72557027e4")))))].
[runContract] Instance c94f2aff-0731-4cf4-a2af-3e9d25bed3c3 received NewObservableState Null.
[runContract] Instance c94f2aff-0731-4cf4-a2af-3e9d25bed3c3 received NewActiveEndpoints [].
[runContract] Instance c94f2aff-0731-4cf4-a2af-3e9d25bed3c3 received NewYieldedExportTxs [].
[runContract] Instance c94f2aff-0731-4cf4-a2af-3e9d25bed3c3 received NewObservableState (Object (fromList [("contents",Array [String "c32d529f-6310-4ed5-b416-2823eee5bafe",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "910a2631ca15102bcc53f85e730fc64edad7f2b40899220867915922"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "4e7cff382be2862156301aba9c4efcbf68fb4f43d0119a9f654be27f")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance c94f2aff-0731-4cf4-a2af-3e9d25bed3c3 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wrtq2t4x492qzsfcykccy364qc5at6nnzr87c7g3dmztfqcuxr0ed and role address addr_test1wzgs5f33eg23q27v20u9uuc0ce8d44ljksyfjgsgv7g4jgsw5pfn0 with MarloweParams {rolePayoutValidatorHash = 910a2631ca15102bcc53f85e730fc64edad7f2b40899220867915922, rolesCurrency = 4e7cff382be2862156301aba9c4efcbf68fb4f43d0119a9f654be27f}.
[Comment] The oracle should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the party and counterparty along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,13450409),(AssetId "4e7cff382be2862156301aba9c4efcbf68fb4f43d0119a9f654be27f" "Oracle",1)].
[Comment] The party and counterpary should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,82000000),(AssetId "4e7cff382be2862156301aba9c4efcbf68fb4f43d0119a9f654be27f" "Party",1)].
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,62000000),(AssetId "4e7cff382be2862156301aba9c4efcbf68fb4f43d0119a9f654be27f" "Counterparty",1)].
[Comment] The party and counterparty each need to follow the contract created by the mediator.
[Follow] Instance "PartyApp" now follows instance "OracleApp".
[Follow] Instance "CounterpartyApp" now follows instance "OracleApp".
[Comment] The party deposits their 20 ADA margin.
[runContract] Instance f6a99676-5557-4353-b8ca-8fbeccfa3bc1 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "PartyApp" for inputs [ClientInput (IDeposit "Party" "Party" (Token "" "") 20000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance f6a99676-5557-4353-b8ca-8fbeccfa3bc1 received NewObservableState (Object (fromList [("contents",Array [String "1f3d46a2-2d7e-438d-b835-5d92d221ff6c",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance f6a99676-5557-4353-b8ca-8fbeccfa3bc1 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The party should have about 62 ADA now, since they paid 20 ADA for the margin, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,60594106),(AssetId "4e7cff382be2862156301aba9c4efcbf68fb4f43d0119a9f654be27f" "Party",1)].
[Comment] The counterparty deposits their 30 ADA margin.
[runContract] Instance 35b70650-8294-4ee3-a55a-a480013b49d4 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "CounterpartyApp" for inputs [ClientInput (IDeposit "Counterparty" "Counterparty" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 35b70650-8294-4ee3-a55a-a480013b49d4 received NewObservableState (Object (fromList [("contents",Array [String "ff7d7b7b-2afd-4198-8218-c0c0c0cfc54f",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 35b70650-8294-4ee3-a55a-a480013b49d4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The counterparty should have about 32 ADA now, since they paid 30 ADA for the margin purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,30584408),(AssetId "4e7cff382be2862156301aba9c4efcbf68fb4f43d0119a9f654be27f" "Counterparty",1)].
[Comment] The oracle reports that the price is 10 ADA in the first window.
[runContract] Instance c94f2aff-0731-4cf4-a2af-3e9d25bed3c3 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OracleApp" for inputs [ClientInput (IChoice (ChoiceId "Price in first window" "Oracle") 10000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance c94f2aff-0731-4cf4-a2af-3e9d25bed3c3 received NewObservableState (Object (fromList [("contents",Array [String "fc8fc162-1069-4269-b4cc-4955ea1a62f7",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance c94f2aff-0731-4cf4-a2af-3e9d25bed3c3 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should still have 14 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,11881679),(AssetId "4e7cff382be2862156301aba9c4efcbf68fb4f43d0119a9f654be27f" "Oracle",1)].
[Comment] The oracle reports that the price is 25 ADA in the second window.
[WaitFor] Waited for 12000 milliseconds.
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OracleApp" for inputs [ClientInput (IChoice (ChoiceId "Price in second window" "Oracle") 25000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance c94f2aff-0731-4cf4-a2af-3e9d25bed3c3 received NewActiveEndpoints [].
[runContract] Instance c94f2aff-0731-4cf4-a2af-3e9d25bed3c3 received NewObservableState (Object (fromList [("contents",Array [String "9cf3b440-0c44-4cdf-9912-2f1163a5b872",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance c94f2aff-0731-4cf4-a2af-3e9d25bed3c3 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should have 16 ADA now because they received their original min-ADA deposit back, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12280294),(AssetId "4e7cff382be2862156301aba9c4efcbf68fb4f43d0119a9f654be27f" "Oracle",1)].
[Comment] Now the party redeems from the payout script the 5 ADA remaining from their margin.
[runContract] Instance f6a99676-5557-4353-b8ca-8fbeccfa3bc1 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "PartyApp" for role "Party".
[runContract] Instance f6a99676-5557-4353-b8ca-8fbeccfa3bc1 received NewObservableState (Object (fromList [("contents",Array [String "469fdcdb-666e-4b38-a425-75ef51e88147",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance f6a99676-5557-4353-b8ca-8fbeccfa3bc1 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The party should now have 67 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,65169952),(AssetId "4e7cff382be2862156301aba9c4efcbf68fb4f43d0119a9f654be27f" "Party",1)].
[Comment] Now the counterparty redeems their 45 ADA from the payout script.
[CallRedeem] Endpoint "redeem" called on instance "CounterpartyApp" for role "Counterparty".
[runContract] Instance 35b70650-8294-4ee3-a55a-a480013b49d4 received NewActiveEndpoints [].
[runContract] Instance 35b70650-8294-4ee3-a55a-a480013b49d4 received NewObservableState (Object (fromList [("contents",Array [String "22844a3a-f596-4dfc-b88a-3b249339050d",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 35b70650-8294-4ee3-a55a-a480013b49d4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The counterparty should now have 77 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,75131262),(AssetId "4e7cff382be2862156301aba9c4efcbf68fb4f43d0119a9f654be27f" "Counterparty",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance f6a99676-5557-4353-b8ca-8fbeccfa3bc1 received ContractFinished Nothing.
[Stop] Instance "PartyApp" stopped.
[Stop] Instance "CounterpartyApp" stopped.
[runContract] Instance 35b70650-8294-4ee3-a55a-a480013b49d4 received ContractFinished Nothing.
[Stop] Instance "OracleApp" stopped.
***** PASSED *****
