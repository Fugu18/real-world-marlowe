
***** Test "Contract for Differences" *****
[Comment] Create the wallet for the party, fund it with 80 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "chimney basic bleak ceiling curtain cactus stadium need affair buzz include doll drip alien write dynamic sibling inhale dumb cook fuel aunt below heart".
[createWallet] First wallet address is addr_test1qz9c2h3lu94gck05rmr4grxszzk02qux7q4tgk5lxqq7z9npkcxf42gzrpsdpwd0lm7vlcacw8takffpzkly2m4wueesk7jwy4.
[createWallet] First public key hash is 8b855e3fe16a8c59f41ec7540cd010acf50386f02ab45a9f3001e116.
[CreateWallet] Created wallet identified as d76a58eefd664f958949cf84ff8e2131b1ce838a for role "Party".
[FundWallet] Funded wallet for role "Party" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance "PartyApp" with identifier 9202e5ca-5a17-4c3c-bc32-62a8d2f68ba4 for role "Party".
[Comment] Create the wallet for the counterparty, fund it with 60 ADA, and activate the Marlowe endpoints.
[runContract] Instance 9202e5ca-5a17-4c3c-bc32-62a8d2f68ba4 received NewObservableState Null.
[runContract] Instance 9202e5ca-5a17-4c3c-bc32-62a8d2f68ba4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 9202e5ca-5a17-4c3c-bc32-62a8d2f68ba4 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "success eagle will install firm blouse bar practice unhappy brisk jump siege test bench fragile tilt obtain agent swarm cereal zero issue jeans salt".
[createWallet] First wallet address is addr_test1qqxtw86hgz6yk04an26ycnmp8uw5mmu5wgkka37t0l4xmxu5v280eqy8kn99m23en2r0hrhmmhaqt09wjdpcszh3mgus4qeqct.
[createWallet] First public key hash is 0cb71f5740b44b3ebd9ab44c4f613f1d4def94722d6ec7cb7fea6d9b.
[CreateWallet] Created wallet identified as fd60baf2cecefe051b9ef595f8f4c0c20a821548 for role "Counterparty".
[FundWallet] Funded wallet for role "Counterparty" with valueFromList [(AdaAssetId,60000000)].
[ActivateApp] Activated MarloweApp instance "CounterpartyApp" with identifier 9f4a19f8-0a99-422b-bc9d-ed7f1c900096 for role "Counterparty".
[Comment] Create the wallet for the oracle, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance 9f4a19f8-0a99-422b-bc9d-ed7f1c900096 received NewObservableState Null.
[runContract] Instance 9f4a19f8-0a99-422b-bc9d-ed7f1c900096 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 9f4a19f8-0a99-422b-bc9d-ed7f1c900096 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "remain hole fabric broom huge smile wink allow episode clap rescue bag differ already tooth immense valve nature cable planet dish shock wet toss".
[createWallet] First wallet address is addr_test1qzaxlmllsdr2rsq0pnazs809tq2sdadf7a4dr3mjj5xaflcm00mgn9ezn7hjkpm2wy4r9ymwatfqgycs7pwnmvlk6q6qeshjgj.
[createWallet] First public key hash is ba6fefff8346a1c00f0cfa281de5581506f5a9f76ad1c772950dd4ff.
[CreateWallet] Created wallet identified as c69d9e0833414dba664a248547ffb8be72b80307 for role "Oracle".
[FundWallet] Funded wallet for role "Oracle" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance "OracleApp" with identifier 579bd17e-fe5a-47cb-a8d4-69fad79dc22b for role "Oracle".
[Comment] The oracle creates the contract with differences, which was downloaded from Marlowe Playground. The party deposits 20 ADA to cover the margin collateral and the counterparty deposits 30 ADA.
[CallCreate] Endpoint "create" called on instance "OracleApp" for owners [("Party",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "8b855e3fe16a8c59f41ec7540cd010acf50386f02ab45a9f3001e116")) (StakeRefBase (KeyHashObj (KeyHash "61b60c9aa9021860d0b9affefccfe3b871d7db252115be456eaee673"))))),("Counterparty",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "0cb71f5740b44b3ebd9ab44c4f613f1d4def94722d6ec7cb7fea6d9b")) (StakeRefBase (KeyHashObj (KeyHash "94628efc8087b4ca5daa399a86fb8efbddfa05bcae9343880af1da39"))))),("Oracle",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "ba6fefff8346a1c00f0cfa281de5581506f5a9f76ad1c772950dd4ff")) (StakeRefBase (KeyHashObj (KeyHash "1b7bf68997229faf2b076a712a32936eead2041310f05d3db3f6d034")))))].
[runContract] Instance 579bd17e-fe5a-47cb-a8d4-69fad79dc22b received NewObservableState Null.
[runContract] Instance 579bd17e-fe5a-47cb-a8d4-69fad79dc22b received NewActiveEndpoints [].
[runContract] Instance 579bd17e-fe5a-47cb-a8d4-69fad79dc22b received NewYieldedExportTxs [].
[runContract] Instance 579bd17e-fe5a-47cb-a8d4-69fad79dc22b received NewObservableState (Object (fromList [("contents",Array [String "1da27a82-123e-4b12-830a-4e786309154b",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "a2a6408d6da07af1a8d5c76a4149b2c968b297d1fa4665194d257f53"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "8415cd76700d6192d5f9b822d7b01caa55c297042b528c47844b7843")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 579bd17e-fe5a-47cb-a8d4-69fad79dc22b received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wp0descp44xzlyc3ej25kc39pspuv5e8qap56ek4mna2d7qpq3lr0 and role address addr_test1wz32vsyddks84udg6hrk5s2fktyk3v5h68ayvegef5jh75c9423r4 with MarloweParams {rolePayoutValidatorHash = a2a6408d6da07af1a8d5c76a4149b2c968b297d1fa4665194d257f53, rolesCurrency = 8415cd76700d6192d5f9b822d7b01caa55c297042b528c47844b7843}.
[Comment] The oracle should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the party and counterparty along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,13450409),(AssetId "8415cd76700d6192d5f9b822d7b01caa55c297042b528c47844b7843" "Oracle",1)].
[Comment] The party and counterpary should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,82000000),(AssetId "8415cd76700d6192d5f9b822d7b01caa55c297042b528c47844b7843" "Party",1)].
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,62000000),(AssetId "8415cd76700d6192d5f9b822d7b01caa55c297042b528c47844b7843" "Counterparty",1)].
[Comment] The party and counterparty each need to follow the contract created by the mediator.
[Follow] Instance "PartyApp" now follows instance "OracleApp".
[Follow] Instance "CounterpartyApp" now follows instance "OracleApp".
[Comment] The party deposits their 20 ADA margin.
[runContract] Instance 9202e5ca-5a17-4c3c-bc32-62a8d2f68ba4 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "PartyApp" for inputs [ClientInput (IDeposit "Party" "Party" (Token "" "") 20000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 9202e5ca-5a17-4c3c-bc32-62a8d2f68ba4 received NewObservableState (Object (fromList [("contents",Array [String "2b22db90-7201-4649-a66f-207d2d2c999f",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 9202e5ca-5a17-4c3c-bc32-62a8d2f68ba4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The party should have about 62 ADA now, since they paid 20 ADA for the margin, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,60593930),(AssetId "8415cd76700d6192d5f9b822d7b01caa55c297042b528c47844b7843" "Party",1)].
[Comment] The counterparty deposits their 30 ADA margin.
[runContract] Instance 9f4a19f8-0a99-422b-bc9d-ed7f1c900096 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "CounterpartyApp" for inputs [ClientInput (IDeposit "Counterparty" "Counterparty" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 9f4a19f8-0a99-422b-bc9d-ed7f1c900096 received NewObservableState (Object (fromList [("contents",Array [String "51e88eda-2664-4d74-bb43-4a732df02d8b",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 9f4a19f8-0a99-422b-bc9d-ed7f1c900096 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The counterparty should have about 32 ADA now, since they paid 30 ADA for the margin purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,30579858),(AssetId "8415cd76700d6192d5f9b822d7b01caa55c297042b528c47844b7843" "Counterparty",1)].
[Comment] The oracle reports that the price is 10 ADA in the first window.
[runContract] Instance 579bd17e-fe5a-47cb-a8d4-69fad79dc22b received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OracleApp" for inputs [ClientInput (IChoice (ChoiceId "Price in first window" "Oracle") 10000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 579bd17e-fe5a-47cb-a8d4-69fad79dc22b received NewObservableState (Object (fromList [("contents",Array [String "fd26b4d0-eff5-4b89-8cf7-66d91c4bdd53",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 579bd17e-fe5a-47cb-a8d4-69fad79dc22b received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should still have 14 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,13450409),(AssetId "8415cd76700d6192d5f9b822d7b01caa55c297042b528c47844b7843" "Oracle",1)].
[Comment] The oracle reports that the price is 25 ADA in the second window.
[WaitFor] Waited for 12000 milliseconds.
[runContract] Instance 579bd17e-fe5a-47cb-a8d4-69fad79dc22b received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OracleApp" for inputs [ClientInput (IChoice (ChoiceId "Price in second window" "Oracle") 25000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 579bd17e-fe5a-47cb-a8d4-69fad79dc22b received NewObservableState (Object (fromList [("contents",Array [String "252260ab-7cae-44f1-8cd2-8e081bbd278d",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 579bd17e-fe5a-47cb-a8d4-69fad79dc22b received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should have 16 ADA now because they received their original min-ADA deposit back, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12279942),(AssetId "8415cd76700d6192d5f9b822d7b01caa55c297042b528c47844b7843" "Oracle",1)].
[Comment] Now the party redeems from the payout script the 5 ADA remaining from their margin.
[runContract] Instance 9202e5ca-5a17-4c3c-bc32-62a8d2f68ba4 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "PartyApp" for role "Party".
[runContract] Instance 9202e5ca-5a17-4c3c-bc32-62a8d2f68ba4 received NewObservableState (Object (fromList [("contents",Array [String "6cebd789-53ab-4c33-86db-d212a648a660",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 9202e5ca-5a17-4c3c-bc32-62a8d2f68ba4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The party should now have 67 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,65171137),(AssetId "8415cd76700d6192d5f9b822d7b01caa55c297042b528c47844b7843" "Party",1)].
[Comment] Now the counterparty redeems their 45 ADA from the payout script.
[runContract] Instance 9f4a19f8-0a99-422b-bc9d-ed7f1c900096 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "CounterpartyApp" for role "Counterparty".
[runContract] Instance 9f4a19f8-0a99-422b-bc9d-ed7f1c900096 received NewObservableState (Object (fromList [("contents",Array [String "cff2d8f4-35ac-4a6d-90b7-bfaf5aed69ae",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 9f4a19f8-0a99-422b-bc9d-ed7f1c900096 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The counterparty should now have 77 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,75132517),(AssetId "8415cd76700d6192d5f9b822d7b01caa55c297042b528c47844b7843" "Counterparty",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 9202e5ca-5a17-4c3c-bc32-62a8d2f68ba4 received ContractFinished Nothing.
[Stop] Instance "PartyApp" stopped.
[Stop] Instance "CounterpartyApp" stopped.
[runContract] Instance 9f4a19f8-0a99-422b-bc9d-ed7f1c900096 received ContractFinished Nothing.
[Stop] Instance "OracleApp" stopped.
***** PASSED *****
[runContract] Instance 579bd17e-fe5a-47cb-a8d4-69fad79dc22b received ContractFinished Nothing.
