
***** Test "Contract for Differences" *****
[Comment] Create the wallet for the party, fund it with 80 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "vanish enrich paddle uphold dream expire treat theme budget man ancient churn kidney sentence burden scatter universe nasty fence chair moral try behind wood".
[createWallet] First wallet address is addr_test1qre70enywg3jnh9uthmcjk0u0tqvnge4ty4hg0ep0qgefhqyhm00vqt69r9r7dv8p09vlp7pvrueqp7x9xclu9m6razqrmzfv8.
[createWallet] First public key hash is f3e7e664722329dcbc5df78959fc7ac0c9a335592b743f21781194dc.
[CreateWallet] Created wallet identified as 58b7a5c418e11837d0f32e1a8e3de0687cbad915 for role "Party".
[FundWallet] Funded wallet for role "Party" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance "PartyApp" with identifier f1952e10-f5ba-4f07-a773-23da31757db4 for role "Party".
[Comment] Create the wallet for the counterparty, fund it with 60 ADA, and activate the Marlowe endpoints.
[runContract] Instance f1952e10-f5ba-4f07-a773-23da31757db4 received NewObservableState Null.
[runContract] Instance f1952e10-f5ba-4f07-a773-23da31757db4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance f1952e10-f5ba-4f07-a773-23da31757db4 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "frost jacket chronic item alien mandate journey walnut know patrol omit rate antenna rely essay surge engine wool reason measure best squirrel memory jaguar".
[createWallet] First wallet address is addr_test1qr8x0lyj5z4keylefddtz0t4ap4vxtgexcqdylkcyyvjdt30undju2yz7r5zdezgq3pmr4h2y3qcu0wenhpu9tqyq3gqlh6q7s.
[createWallet] First public key hash is ce67fc92a0ab6c93f94b5ab13d75e86ac32d193600d27ed8211926ae.
[CreateWallet] Created wallet identified as 7c89f6e60d7d2106c4d994c52a611a47bf6a9998 for role "Counterparty".
[FundWallet] Funded wallet for role "Counterparty" with valueFromList [(AdaAssetId,60000000)].
[ActivateApp] Activated MarloweApp instance "CounterpartyApp" with identifier c5de94dd-40b1-4305-9bda-aeb3ae795a83 for role "Counterparty".
[Comment] Create the wallet for the oracle, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance c5de94dd-40b1-4305-9bda-aeb3ae795a83 received NewObservableState Null.
[runContract] Instance c5de94dd-40b1-4305-9bda-aeb3ae795a83 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance c5de94dd-40b1-4305-9bda-aeb3ae795a83 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "team clown enrich state flush gravity view weapon add coconut permit food taxi feel enter opinion limb crane palace purity paper awkward prepare peace".
[createWallet] First wallet address is addr_test1qqratw7s0xvpyjk46fzcrvq578je0xvkvqw4xwll5395yyfpdg20v8vzg9eujqhraefnr9r2zn98n220hcwfuf4w7emq83c86q.
[createWallet] First public key hash is 07d5bbd07998124ad5d24581b014f1e5979996601d533bffa44b4211.
[CreateWallet] Created wallet identified as 3affcd49802dcf196a5333c110114b169fc41729 for role "Oracle".
[FundWallet] Funded wallet for role "Oracle" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance "OracleApp" with identifier ef223392-df78-45fa-90cb-a97357736f89 for role "Oracle".
[Comment] The oracle creates the contract with differences, which was downloaded from Marlowe Playground. The party deposits 20 ADA to cover the margin collateral and the counterparty deposits 30 ADA.
[CallCreate] Endpoint "create" called on instance "OracleApp" for owners [("Party",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "f3e7e664722329dcbc5df78959fc7ac0c9a335592b743f21781194dc")) (StakeRefBase (KeyHashObj (KeyHash "04bedef6017a28ca3f35870bcacf87c160f99007c629b1fe177a1f44"))))),("Counterparty",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "ce67fc92a0ab6c93f94b5ab13d75e86ac32d193600d27ed8211926ae")) (StakeRefBase (KeyHashObj (KeyHash "2fe4db2e2882f0e826e4480443b1d6ea24418e3dd99dc3c2ac040450"))))),("Oracle",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "07d5bbd07998124ad5d24581b014f1e5979996601d533bffa44b4211")) (StakeRefBase (KeyHashObj (KeyHash "216a14f61d824173c902e3ee5331946a14ca79a94fbe1c9e26aef676")))))].
[runContract] Instance ef223392-df78-45fa-90cb-a97357736f89 received NewObservableState Null.
[runContract] Instance ef223392-df78-45fa-90cb-a97357736f89 received NewActiveEndpoints [].
[runContract] Instance ef223392-df78-45fa-90cb-a97357736f89 received NewYieldedExportTxs [].
[runContract] Instance ef223392-df78-45fa-90cb-a97357736f89 received NewObservableState (Object (fromList [("contents",Array [String "318571a2-f18f-43d7-b217-96aa97a36744",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "7c3d892fe3adb995c8d2cbfa3ed32e71a975af641a6d0a307e09933c"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "a095087d55783d2bee2d6d9146bce4c76b7087ff8553d95497f6efd2")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance ef223392-df78-45fa-90cb-a97357736f89 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wrh74m8rtp3xp5e5y79fz7rt4vss5e2wkhvv34nr5xsyhtcy0tmtr and role address addr_test1wp7rmzf0uwkmn9wg6t9l50kn9ec6jad0vsdx6z3s0cyex0qp92jrl with MarloweParams {rolePayoutValidatorHash = 7c3d892fe3adb995c8d2cbfa3ed32e71a975af641a6d0a307e09933c, rolesCurrency = a095087d55783d2bee2d6d9146bce4c76b7087ff8553d95497f6efd2}.
[Comment] The oracle should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the party and counterparty along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,13450409),(AssetId "a095087d55783d2bee2d6d9146bce4c76b7087ff8553d95497f6efd2" "Oracle",1)].
[Comment] The party and counterpary should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,82000000),(AssetId "a095087d55783d2bee2d6d9146bce4c76b7087ff8553d95497f6efd2" "Party",1)].
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,62000000),(AssetId "a095087d55783d2bee2d6d9146bce4c76b7087ff8553d95497f6efd2" "Counterparty",1)].
[Comment] The party and counterparty each need to follow the contract created by the mediator.
[Follow] Instance "PartyApp" now follows instance "OracleApp".
[Follow] Instance "CounterpartyApp" now follows instance "OracleApp".
[Comment] The party deposits their 20 ADA margin.
[runContract] Instance f1952e10-f5ba-4f07-a773-23da31757db4 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "PartyApp" for inputs [ClientInput (IDeposit "Party" "Party" (Token "" "") 20000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance f1952e10-f5ba-4f07-a773-23da31757db4 received NewObservableState (Object (fromList [("contents",Array [String "a0922c0c-b63b-4007-b4a1-03690988f8bf",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance f1952e10-f5ba-4f07-a773-23da31757db4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The party should have about 62 ADA now, since they paid 20 ADA for the margin, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,60682547),(AssetId "a095087d55783d2bee2d6d9146bce4c76b7087ff8553d95497f6efd2" "Party",1)].
[Comment] The counterparty deposits their 30 ADA margin.
[runContract] Instance c5de94dd-40b1-4305-9bda-aeb3ae795a83 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "CounterpartyApp" for inputs [ClientInput (IDeposit "Counterparty" "Counterparty" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance c5de94dd-40b1-4305-9bda-aeb3ae795a83 received NewObservableState (Object (fromList [("contents",Array [String "87105496-c5d6-4fb1-a928-44a58586e2e2",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance c5de94dd-40b1-4305-9bda-aeb3ae795a83 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The counterparty should have about 32 ADA now, since they paid 30 ADA for the margin purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,30675972),(AssetId "a095087d55783d2bee2d6d9146bce4c76b7087ff8553d95497f6efd2" "Counterparty",1)].
[Comment] The oracle reports that the price is 10 ADA in the first window.
[runContract] Instance ef223392-df78-45fa-90cb-a97357736f89 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OracleApp" for inputs [ClientInput (IChoice (ChoiceId "Price in first window" "Oracle") 10000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance ef223392-df78-45fa-90cb-a97357736f89 received NewObservableState (Object (fromList [("contents",Array [String "476d3728-0ab2-45ac-adbf-da7f46dceb75",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance ef223392-df78-45fa-90cb-a97357736f89 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should still have 14 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12050775),(AssetId "a095087d55783d2bee2d6d9146bce4c76b7087ff8553d95497f6efd2" "Oracle",1)].
[Comment] The oracle reports that the price is 25 ADA in the second window.
[WaitFor] Waited for 12000 milliseconds.
[runContract] Instance ef223392-df78-45fa-90cb-a97357736f89 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OracleApp" for inputs [ClientInput (IChoice (ChoiceId "Price in second window" "Oracle") 25000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance ef223392-df78-45fa-90cb-a97357736f89 received NewObservableState (Object (fromList [("contents",Array [String "a55508c8-979e-4594-8922-94f32e0619d0",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance ef223392-df78-45fa-90cb-a97357736f89 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should have 16 ADA now because they received their original min-ADA deposit back, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12486491),(AssetId "a095087d55783d2bee2d6d9146bce4c76b7087ff8553d95497f6efd2" "Oracle",1)].
[Comment] Now the party redeems from the payout script the 5 ADA remaining from their margin.
[runContract] Instance f1952e10-f5ba-4f07-a773-23da31757db4 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "PartyApp" for role "Party".
[runContract] Instance f1952e10-f5ba-4f07-a773-23da31757db4 received NewObservableState (Object (fromList [("contents",Array [String "5d22f46b-5910-4ce7-8b06-1e6e46d4cc8a",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance f1952e10-f5ba-4f07-a773-23da31757db4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The party should now have 67 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,65258393),(AssetId "a095087d55783d2bee2d6d9146bce4c76b7087ff8553d95497f6efd2" "Party",1)].
[Comment] Now the counterparty redeems their 45 ADA from the payout script.
[CallRedeem] Endpoint "redeem" called on instance "CounterpartyApp" for role "Counterparty".
[runContract] Instance c5de94dd-40b1-4305-9bda-aeb3ae795a83 received NewActiveEndpoints [].
[runContract] Instance c5de94dd-40b1-4305-9bda-aeb3ae795a83 received NewObservableState (Object (fromList [("contents",Array [String "3975e640-55de-4ee1-8de1-a07191c4f779",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance c5de94dd-40b1-4305-9bda-aeb3ae795a83 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The counterparty should now have 77 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,75222826),(AssetId "a095087d55783d2bee2d6d9146bce4c76b7087ff8553d95497f6efd2" "Counterparty",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance f1952e10-f5ba-4f07-a773-23da31757db4 received ContractFinished Nothing.
[Stop] Instance "PartyApp" stopped.
[Stop] Instance "CounterpartyApp" stopped.
[runContract] Instance c5de94dd-40b1-4305-9bda-aeb3ae795a83 received ContractFinished Nothing.
[Stop] Instance "OracleApp" stopped.
[runContract] Instance ef223392-df78-45fa-90cb-a97357736f89 received ContractFinished Nothing.
***** PASSED *****
