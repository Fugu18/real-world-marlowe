
***** Test "Contract for Differences" *****
[Comment] Create the wallet for the party, fund it with 80 ADA, and activate the Marlowe endpoints.
[CreateWallet] Created wallet 183b0c20d8b7380eda9abbe5a2585750288bc8e0 for role "Party".
[FundWallet] Funded wallet 183b0c20d8b7380eda9abbe5a2585750288bc8e0 for role "Party" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance 5c1b2c1f-a3d7-4a54-b6bc-607955e98a76 for role "Party".
[Comment] Create the wallet for the counterparty, fund it with 60 ADA, and activate the Marlowe endpoints.
[runContract] Instance 5c1b2c1f-a3d7-4a54-b6bc-607955e98a76 received NewObservableState Null.
[runContract] Instance 5c1b2c1f-a3d7-4a54-b6bc-607955e98a76 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 5c1b2c1f-a3d7-4a54-b6bc-607955e98a76 received NewYieldedExportTxs [].
[CreateWallet] Created wallet 206ff61c1006c54511a7a07c264866c07d4ad2d2 for role "Counterparty".
[FundWallet] Funded wallet 206ff61c1006c54511a7a07c264866c07d4ad2d2 for role "Counterparty" with valueFromList [(AdaAssetId,60000000)].
[ActivateApp] Activated MarloweApp instance 17e676a2-ec2e-4e06-9fe7-5667d15329b0 for role "Counterparty".
[Comment] Create the wallet for the oracle, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance 17e676a2-ec2e-4e06-9fe7-5667d15329b0 received NewObservableState Null.
[runContract] Instance 17e676a2-ec2e-4e06-9fe7-5667d15329b0 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 17e676a2-ec2e-4e06-9fe7-5667d15329b0 received NewYieldedExportTxs [].
[CreateWallet] Created wallet d765d84872e356f4698ab8c0638967f3acd5be37 for role "Oracle".
[FundWallet] Funded wallet d765d84872e356f4698ab8c0638967f3acd5be37 for role "Oracle" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance 003e2a0d-9803-4101-9076-fad2ce693983 for role "Oracle".
[Comment] The oracle creates the contract with differences, which was downloaded from Marlowe Playground. The party deposits 20 ADA to cover the margin collateral and the counterparty deposits 30 ADA.
[CallCreate] Endpoint "create" called on instance 003e2a0d-9803-4101-9076-fad2ce693983 for owners [("Party",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "9d822498f934055154307d4839fa78b6a8903b62b760888a1f733048")) (StakeRefBase (KeyHashObj (KeyHash "71481d92c6235110ed579153a3b431aa9d457393761848c67778a0a6"))))),("Counterparty",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "5447556d87539c2cd006eae0cbe876a263965f94cc0b5ebcaa1fe606")) (StakeRefBase (KeyHashObj (KeyHash "87e57f94ce6c57902868999ae3c6d1b279f45237cdc36e0eb20ad724"))))),("Oracle",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "c4b9e695e7661e771df2c3d2c00df259684ba8d73b0a58aaab672c6b")) (StakeRefBase (KeyHashObj (KeyHash "48d8261d78c7e9462c6fe757c9eabe5bd931c24d87d7c183c79e7f9d")))))].
[runContract] Instance 003e2a0d-9803-4101-9076-fad2ce693983 received NewObservableState Null.
[runContract] Instance 003e2a0d-9803-4101-9076-fad2ce693983 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 003e2a0d-9803-4101-9076-fad2ce693983 received NewYieldedExportTxs [].
[runContract] Instance 003e2a0d-9803-4101-9076-fad2ce693983 received NewActiveEndpoints [].
[runContract] Instance 003e2a0d-9803-4101-9076-fad2ce693983 received NewObservableState (Object (fromList [("contents",Array [String "28ba5417-2175-4b5f-a319-a911ebf740d4",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "d571b2184577b9dd7a09a6d1a639994739e099e64288bca184bd6271"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "c6935307d41a4185311f3f0d32370c5517f34d95306ca75f2e170ccc")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 003e2a0d-9803-4101-9076-fad2ce693983 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed with MarloweParams {rolePayoutValidatorHash = d571b2184577b9dd7a09a6d1a639994739e099e64288bca184bd6271, rolesCurrency = c6935307d41a4185311f3f0d32370c5517f34d95306ca75f2e170ccc}.
[Comment] The oracle should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the party and counterparty along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,13450409),(AssetId "c6935307d41a4185311f3f0d32370c5517f34d95306ca75f2e170ccc" "Oracle",1)].
[Comment] The party and counterpary should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,82000000),(AssetId "c6935307d41a4185311f3f0d32370c5517f34d95306ca75f2e170ccc" "Party",1)].
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,62000000),(AssetId "c6935307d41a4185311f3f0d32370c5517f34d95306ca75f2e170ccc" "Counterparty",1)].
[Comment] The party and counterparty each need to follow the contract created by the mediator.
[Follow] Instance 5c1b2c1f-a3d7-4a54-b6bc-607955e98a76 now follows instance 003e2a0d-9803-4101-9076-fad2ce693983.
[Follow] Instance 17e676a2-ec2e-4e06-9fe7-5667d15329b0 now follows instance 003e2a0d-9803-4101-9076-fad2ce693983.
[Comment] The party deposits their 20 ADA margin.
[CallApplyInputs] Endpoint "apply-inputs" called on 5c1b2c1f-a3d7-4a54-b6bc-607955e98a76 for inputs [ClientInput (IDeposit "Party" "Party" (Token "" "") 20000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 5c1b2c1f-a3d7-4a54-b6bc-607955e98a76 received NewActiveEndpoints [].
[runContract] Instance 5c1b2c1f-a3d7-4a54-b6bc-607955e98a76 received NewObservableState (Object (fromList [("contents",Array [String "32a97249-5bb8-4b8b-b081-f32f7f5136a3",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 5c1b2c1f-a3d7-4a54-b6bc-607955e98a76 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The party should have about 62 ADA now, since they paid 20 ADA for the margin, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,60686921),(AssetId "c6935307d41a4185311f3f0d32370c5517f34d95306ca75f2e170ccc" "Party",1)].
[Comment] The counterparty deposits their 30 ADA margin.
[CallApplyInputs] Endpoint "apply-inputs" called on 17e676a2-ec2e-4e06-9fe7-5667d15329b0 for inputs [ClientInput (IDeposit "Counterparty" "Counterparty" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 17e676a2-ec2e-4e06-9fe7-5667d15329b0 received NewActiveEndpoints [].
[runContract] Instance 17e676a2-ec2e-4e06-9fe7-5667d15329b0 received NewObservableState (Object (fromList [("contents",Array [String "f3a16d15-56cf-4924-8243-d946297285a3",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 17e676a2-ec2e-4e06-9fe7-5667d15329b0 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The counterparty should have about 32 ADA now, since they paid 30 ADA for the margin purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,30675972),(AssetId "c6935307d41a4185311f3f0d32370c5517f34d95306ca75f2e170ccc" "Counterparty",1)].
[Comment] The oracle reports that the price is 10 ADA in the first window.
[CallApplyInputs] Endpoint "apply-inputs" called on 003e2a0d-9803-4101-9076-fad2ce693983 for inputs [ClientInput (IChoice (ChoiceId "Price in first window" "Oracle") 10000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 003e2a0d-9803-4101-9076-fad2ce693983 received NewActiveEndpoints [].
[runContract] Instance 003e2a0d-9803-4101-9076-fad2ce693983 received NewObservableState (Object (fromList [("contents",Array [String "3ca6b489-dcb8-4922-8b3d-5d82b304fd37",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 003e2a0d-9803-4101-9076-fad2ce693983 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should still have 14 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12044939),(AssetId "c6935307d41a4185311f3f0d32370c5517f34d95306ca75f2e170ccc" "Oracle",1)].
[Comment] The oracle reports that the price is 25 ADA in the second window.
[WaitFor] Waited for 12000 milliseconds.
[CallApplyInputs] Endpoint "apply-inputs" called on 003e2a0d-9803-4101-9076-fad2ce693983 for inputs [ClientInput (IChoice (ChoiceId "Price in second window" "Oracle") 25000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 003e2a0d-9803-4101-9076-fad2ce693983 received NewActiveEndpoints [].
[runContract] Instance 003e2a0d-9803-4101-9076-fad2ce693983 received NewObservableState (Object (fromList [("contents",Array [String "4c56399d-1ebd-46a2-aaf9-2d017f8e3ece",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 003e2a0d-9803-4101-9076-fad2ce693983 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should have 16 ADA now because they received their original min-ADA deposit back, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12480655),(AssetId "c6935307d41a4185311f3f0d32370c5517f34d95306ca75f2e170ccc" "Oracle",1)].
[Comment] Now the party redeems from the payout script the 5 ADA remaining from their margin.
[CallRedeem] Endpoint "redeem" called on 5c1b2c1f-a3d7-4a54-b6bc-607955e98a76 for role "Party".
[runContract] Instance 5c1b2c1f-a3d7-4a54-b6bc-607955e98a76 received NewActiveEndpoints [].
[runContract] Instance 5c1b2c1f-a3d7-4a54-b6bc-607955e98a76 received NewObservableState (Object (fromList [("contents",Array [String "d0047ad2-283a-4434-837b-ff6e689fe0c1",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 5c1b2c1f-a3d7-4a54-b6bc-607955e98a76 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The party should now have 67 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,65262767),(AssetId "c6935307d41a4185311f3f0d32370c5517f34d95306ca75f2e170ccc" "Party",1)].
[Comment] Now the counterparty redeems their 45 ADA from the payout script.
[CallRedeem] Endpoint "redeem" called on 17e676a2-ec2e-4e06-9fe7-5667d15329b0 for role "Counterparty".
[runContract] Instance 17e676a2-ec2e-4e06-9fe7-5667d15329b0 received NewActiveEndpoints [].
[runContract] Instance 17e676a2-ec2e-4e06-9fe7-5667d15329b0 received NewObservableState (Object (fromList [("contents",Array [String "d7b0cf2a-f2db-4236-ad45-1eb70cc849c2",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 17e676a2-ec2e-4e06-9fe7-5667d15329b0 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The counterparty should now have 77 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,75222826),(AssetId "c6935307d41a4185311f3f0d32370c5517f34d95306ca75f2e170ccc" "Counterparty",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 5c1b2c1f-a3d7-4a54-b6bc-607955e98a76 received ContractFinished Nothing.
[Stop] Instance 5c1b2c1f-a3d7-4a54-b6bc-607955e98a76 stopped.
[Stop] Instance 17e676a2-ec2e-4e06-9fe7-5667d15329b0 stopped.
[runContract] Instance 17e676a2-ec2e-4e06-9fe7-5667d15329b0 received ContractFinished Nothing.
[Stop] Instance 003e2a0d-9803-4101-9076-fad2ce693983 stopped.
***** SUCCEEDED *****
