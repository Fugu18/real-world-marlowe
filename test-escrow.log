
***** Test "Escrow" *****
[Comment] Create the wallet for the buyer, fund it with 80 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "start eye breeze say broom earn exist chicken sustain glad jump blur hedgehog elite bracket speed artwork kind pole coral suggest puzzle giraffe long".
[createWallet] First wallet address is addr_test1qp93d836w9u0m0lnnr03dgapnhglw8g9fqk5aejxt6a76kujwxmdpvsmx4c5tmgsphj7n3zpzp8atxc7r69sum4d3x0szs7dcr.
[createWallet] First public key hash is 4b169e3a7178fdbff398df16a3a19dd1f71d05482d4ee6465ebbed5b.
[CreateWallet] Created wallet identified as 35cd3960a85fdf83198bf0e586d415e6ed29f49b for role "Buyer".
[FundWallet] Funded wallet for role "Buyer" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance "BuyerApp" with identifier 85f5f419-3e74-4366-b65b-51759c27b112 for role "Buyer".
[Comment] Create the wallet for the seller, fund it with 15 ADA, and activate the Marlowe endpoints.
[runContract] Instance 85f5f419-3e74-4366-b65b-51759c27b112 received NewObservableState Null.
[runContract] Instance 85f5f419-3e74-4366-b65b-51759c27b112 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 85f5f419-3e74-4366-b65b-51759c27b112 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "train canvas digital multiply bargain dial advance affair flush thrive jelly path satoshi hard estate broken innocent electric weekend nuclear furnace caught begin swarm".
[createWallet] First wallet address is addr_test1qpkpzccn97qzf75kpp2wx7c02srne4mhrw4yu5qw4wqt8jxpe8p8tlhkecm292mr0vn2euewuvs9f030mpe5e7daw6tqvm8kxs.
[createWallet] First public key hash is 6c1163132f8024fa960854e37b0f54073cd7771baa4e500eab80b3c8.
[CreateWallet] Created wallet identified as 4714e8922af3d275567c7f713914aba6add636a4 for role "Seller".
[FundWallet] Funded wallet for role "Seller" with valueFromList [(AdaAssetId,15000000)].
[ActivateApp] Activated MarloweApp instance "SellerApp" with identifier c9674411-8187-4d86-a4b2-ced26a6ca504 for role "Seller".
[Comment] Create the wallet for the mediator, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance c9674411-8187-4d86-a4b2-ced26a6ca504 received NewObservableState Null.
[runContract] Instance c9674411-8187-4d86-a4b2-ced26a6ca504 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance c9674411-8187-4d86-a4b2-ced26a6ca504 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "volume congress scan chair album involve slogan brass tackle gallery genuine erupt cry hidden switch urge damp actress because fire garden siren rural certain".
[createWallet] First wallet address is addr_test1qzupq5k9gvfs6yprdq3lja42kzwnr5h5lt54vff94lckqpfkd9uqhcse3cqdlnj0ytzdl8pj0hhvg7xumn0c75t5dneqn57dpy.
[createWallet] First public key hash is b81052c543130d10236823f976aab09d31d2f4fae9562525aff16005.
[CreateWallet] Created wallet identified as 8211cd5eb91567c71e6f29d27fe3e60d79148aac for role "Mediator".
[FundWallet] Funded wallet for role "Mediator" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance "MediatorApp" with identifier 6a1ab03e-1b12-4b56-a817-9a9a9f308785 for role "Mediator".
[Comment] The mediator creates the escrow contract, which was downloaded from Marlowe Playground. The purchase price is 50 ADA.
[CallCreate] Endpoint "create" called on instance "MediatorApp" for owners [("Buyer",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "4b169e3a7178fdbff398df16a3a19dd1f71d05482d4ee6465ebbed5b")) (StakeRefBase (KeyHashObj (KeyHash "9271b6d0b21b357145ed100de5e9c441104fd59b1e1e8b0e6ead899f"))))),("Seller",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "6c1163132f8024fa960854e37b0f54073cd7771baa4e500eab80b3c8")) (StakeRefBase (KeyHashObj (KeyHash "c1c9c275fef6ce36a2ab637b26acf32ee32054be2fd8734cf9bd7696"))))),("Mediator",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "b81052c543130d10236823f976aab09d31d2f4fae9562525aff16005")) (StakeRefBase (KeyHashObj (KeyHash "3669780be2198e00dfce4f22c4df9c327deec478dcdcdf8f51746cf2")))))].
[runContract] Instance 6a1ab03e-1b12-4b56-a817-9a9a9f308785 received NewObservableState Null.
[runContract] Instance 6a1ab03e-1b12-4b56-a817-9a9a9f308785 received NewActiveEndpoints [].
[runContract] Instance 6a1ab03e-1b12-4b56-a817-9a9a9f308785 received NewYieldedExportTxs [].
[runContract] Instance 6a1ab03e-1b12-4b56-a817-9a9a9f308785 received NewObservableState (Object (fromList [("contents",Array [String "3b772811-0bc1-4522-b292-329f40ef9d22",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "632caa1d1b34258a723c011b306b7d4a2bb3c629a6c93239323b94e3"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "0bedaff0a66387963471ac05748f898341a15c3bc029a80df18c70a0")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 6a1ab03e-1b12-4b56-a817-9a9a9f308785 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wrvhs47h33s064t2seqdq6grfax29mjm4awa80v6lwjqams4rll3v and role address addr_test1wp3je2sarv6ztznj8sq3kvrt049zhv7x9xnvjv3exgaefccmsvhed with MarloweParams {rolePayoutValidatorHash = 632caa1d1b34258a723c011b306b7d4a2bb3c629a6c93239323b94e3, rolesCurrency = 0bedaff0a66387963471ac05748f898341a15c3bc029a80df18c70a0}.
[Comment] The mediator should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the buyer and seller along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Mediator" contains valueFromList [(AdaAssetId,13472128),(AssetId "0bedaff0a66387963471ac05748f898341a15c3bc029a80df18c70a0" "Mediator",1)].
[Comment] The buyer and seller should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,82000000),(AssetId "0bedaff0a66387963471ac05748f898341a15c3bc029a80df18c70a0" "Buyer",1)].
[CheckFunds] Wallet for role "Seller" contains valueFromList [(AdaAssetId,17000000),(AssetId "0bedaff0a66387963471ac05748f898341a15c3bc029a80df18c70a0" "Seller",1)].
[Comment] The buyer and seller each need to follow the contract created by the mediator.
[Follow] Instance "BuyerApp" now follows instance "MediatorApp".
[Follow] Instance "SellerApp" now follows instance "MediatorApp".
[Comment] The buyer deposits the 50 ADA purchase price.
[runContract] Instance 85f5f419-3e74-4366-b65b-51759c27b112 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "BuyerApp" for inputs [ClientInput (IDeposit "Seller" "Buyer" (Token "" "") 50000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 85f5f419-3e74-4366-b65b-51759c27b112 received NewObservableState (Object (fromList [("contents",Array [String "63d7b294-49e9-4515-8576-d9edaf8dee03",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 85f5f419-3e74-4366-b65b-51759c27b112 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The buyer should have about 32 ADA now, since they paid 50 ADA for the purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,30706671),(AssetId "0bedaff0a66387963471ac05748f898341a15c3bc029a80df18c70a0" "Buyer",1)].
[Comment] The buyer receives the purchase and reports that everything is alright.
[runContract] Instance 85f5f419-3e74-4366-b65b-51759c27b112 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "BuyerApp" for inputs [ClientInput (IChoice (ChoiceId "Everything is alright" "Buyer") 0)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 85f5f419-3e74-4366-b65b-51759c27b112 received NewObservableState (Object (fromList [("contents",Array [String "4ad17248-1a09-4343-9571-12b99c49a5c6",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 85f5f419-3e74-4366-b65b-51759c27b112 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The buyer should still have 32 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,29516915),(AssetId "0bedaff0a66387963471ac05748f898341a15c3bc029a80df18c70a0" "Buyer",1)].
[Comment] The mediator should have 16 ADA now because they received back their initial 2 ADA that was contributed when creating the contract, but they did not pay additional fees
[CheckFunds] Wallet for role "Mediator" contains valueFromList [(AdaAssetId,15472128),(AssetId "0bedaff0a66387963471ac05748f898341a15c3bc029a80df18c70a0" "Mediator",1)].
[Comment] Now the seller redeems the 50 ADA from the payout script.
[runContract] Instance c9674411-8187-4d86-a4b2-ced26a6ca504 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "SellerApp" for role "Seller".
[runContract] Instance c9674411-8187-4d86-a4b2-ced26a6ca504 received NewObservableState (Object (fromList [("contents",Array [String "ce375cb8-083d-41fc-b516-3f2991e64850",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance c9674411-8187-4d86-a4b2-ced26a6ca504 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The seller should now have 67 ADA, but they may have paid up to 1 ADA in fees.
[CheckFunds] Wallet for role "Seller" contains valueFromList [(AdaAssetId,66574417),(AssetId "0bedaff0a66387963471ac05748f898341a15c3bc029a80df18c70a0" "Seller",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 85f5f419-3e74-4366-b65b-51759c27b112 received ContractFinished Nothing.
[Stop] Instance "BuyerApp" stopped.
[Stop] Instance "SellerApp" stopped.
[runContract] Instance c9674411-8187-4d86-a4b2-ced26a6ca504 received ContractFinished Nothing.
[Stop] Instance "MediatorApp" stopped.
***** PASSED *****
[runContract] Instance 6a1ab03e-1b12-4b56-a817-9a9a9f308785 received ContractFinished Nothing.
