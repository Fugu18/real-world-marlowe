
***** Test "Escrow" *****
[Comment] Create the wallet for the buyer, fund it with 80 ADA, and activate the Marlowe endpoints.
[CreateWallet] Created wallet 7a976e401060367afdd5ff5a1bcb2235bb8942e5 for role "Buyer".
[FundWallet] Funded wallet 7a976e401060367afdd5ff5a1bcb2235bb8942e5 for role "Buyer" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance 433f7681-eaad-4e08-8f4b-f35cf26fd73f for role "Buyer".
[Comment] Create the wallet for the seller, fund it with 15 ADA, and activate the Marlowe endpoints.
[runContract] Instance 433f7681-eaad-4e08-8f4b-f35cf26fd73f received NewObservableState Null.
[runContract] Instance 433f7681-eaad-4e08-8f4b-f35cf26fd73f received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 433f7681-eaad-4e08-8f4b-f35cf26fd73f received NewYieldedExportTxs [].
[CreateWallet] Created wallet 6a7c8cf268591525300b756115f4c7f7f6fb0cbb for role "Seller".
[FundWallet] Funded wallet 6a7c8cf268591525300b756115f4c7f7f6fb0cbb for role "Seller" with valueFromList [(AdaAssetId,15000000)].
[ActivateApp] Activated MarloweApp instance ee85a47a-59ed-4cbb-a486-7140911a42ba for role "Seller".
[Comment] Create the wallet for the mediator, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance ee85a47a-59ed-4cbb-a486-7140911a42ba received NewObservableState Null.
[runContract] Instance ee85a47a-59ed-4cbb-a486-7140911a42ba received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance ee85a47a-59ed-4cbb-a486-7140911a42ba received NewYieldedExportTxs [].
[CreateWallet] Created wallet cb64e8978ac49a6a687e2d951aeaacec2f261f3a for role "Mediator".
[FundWallet] Funded wallet cb64e8978ac49a6a687e2d951aeaacec2f261f3a for role "Mediator" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance 8440f22b-fea9-4863-a48d-917264a37d97 for role "Mediator".
[Comment] The mediator creates the escrow contract, which was downloaded from Marlowe Playground. The purchase price is 50 ADA.
[runContract] Instance 8440f22b-fea9-4863-a48d-917264a37d97 received NewObservableState Null.
[runContract] Instance 8440f22b-fea9-4863-a48d-917264a37d97 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 8440f22b-fea9-4863-a48d-917264a37d97 received NewYieldedExportTxs [].
[CallCreate] Endpoint "create" called on instance 8440f22b-fea9-4863-a48d-917264a37d97 for owners [("Buyer",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "8a4a927c4fa963c6ef3b0f16deeaf5eb9b989a7334df49acd01c4f09")) (StakeRefBase (KeyHashObj (KeyHash "2666ec7cf51fbfa7c60b67aa16f3b2b69a467708c42e678f0a0e3bf9"))))),("Seller",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "2660d7e01f0063ab248b6065509c07d1289b13b26742dfacb082f507")) (StakeRefBase (KeyHashObj (KeyHash "50bb9f9fb8585db3204b07eab458818db973028064750e5beeeaa043"))))),("Mediator",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "715e4db2bfefa364ab9ea056181c348ba6e472267af7b2080d15bc0c")) (StakeRefBase (KeyHashObj (KeyHash "1d028c23366debb03e761af53b33c890b3c91fc327140aa5f8773008")))))].
[runContract] Instance 8440f22b-fea9-4863-a48d-917264a37d97 received NewActiveEndpoints [].
[runContract] Instance 8440f22b-fea9-4863-a48d-917264a37d97 received NewObservableState (Object (fromList [("contents",Array [String "8055d592-5dae-45ee-8ef5-a2af8c4cdba7",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "f9974ef2eb8dfc8e45af6913fd29c9e42b1bef6923dea7e5ae212b48"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "977e04b805157040748857c28e47eaafbda9272a2178572dafb2b2af")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 8440f22b-fea9-4863-a48d-917264a37d97 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed with MarloweParams {rolePayoutValidatorHash = f9974ef2eb8dfc8e45af6913fd29c9e42b1bef6923dea7e5ae212b48, rolesCurrency = 977e04b805157040748857c28e47eaafbda9272a2178572dafb2b2af}.
[Comment] The mediator should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the buyer and seller along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Mediator" contains valueFromList [(AdaAssetId,13472128),(AssetId "977e04b805157040748857c28e47eaafbda9272a2178572dafb2b2af" "Mediator",1)].
[Comment] The buyer and seller should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,82000000),(AssetId "977e04b805157040748857c28e47eaafbda9272a2178572dafb2b2af" "Buyer",1)].
[CheckFunds] Wallet for role "Seller" contains valueFromList [(AdaAssetId,17000000),(AssetId "977e04b805157040748857c28e47eaafbda9272a2178572dafb2b2af" "Seller",1)].
[Comment] The buyer and seller each need to follow the contract created by the mediator.
[Follow] Instance 433f7681-eaad-4e08-8f4b-f35cf26fd73f now follows instance 8440f22b-fea9-4863-a48d-917264a37d97.
[Follow] Instance ee85a47a-59ed-4cbb-a486-7140911a42ba now follows instance 8440f22b-fea9-4863-a48d-917264a37d97.
[Comment] The buyer deposits the 50 ADA purchase price.
[CallApplyInputs] Endpoint "apply-inputs" called on 433f7681-eaad-4e08-8f4b-f35cf26fd73f for inputs [ClientInput (IDeposit "Seller" "Buyer" (Token "" "") 50000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 433f7681-eaad-4e08-8f4b-f35cf26fd73f received NewActiveEndpoints [].
[runContract] Instance 433f7681-eaad-4e08-8f4b-f35cf26fd73f received NewObservableState (Object (fromList [("contents",Array [String "2d7754c9-dd05-4c8e-bba9-4710bec66dc2",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 433f7681-eaad-4e08-8f4b-f35cf26fd73f received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The buyer should have about 32 ADA now, since they paid 50 ADA for the purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,30795289),(AssetId "977e04b805157040748857c28e47eaafbda9272a2178572dafb2b2af" "Buyer",1)].
[Comment] The buyer receives the purchase and reports that everything is alright.
[CallApplyInputs] Endpoint "apply-inputs" called on 433f7681-eaad-4e08-8f4b-f35cf26fd73f for inputs [ClientInput (IChoice (ChoiceId "Everything is alright" "Buyer") 0)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 433f7681-eaad-4e08-8f4b-f35cf26fd73f received NewActiveEndpoints [].
[runContract] Instance 433f7681-eaad-4e08-8f4b-f35cf26fd73f received NewObservableState (Object (fromList [("contents",Array [String "f8c72526-fa64-4045-a1fd-c742759db097",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 433f7681-eaad-4e08-8f4b-f35cf26fd73f received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The buyer should still have 32 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,29642840),(AssetId "977e04b805157040748857c28e47eaafbda9272a2178572dafb2b2af" "Buyer",1)].
[Comment] The mediator should have 16 ADA now because they received back their initial 2 ADA that was contributed when creating the contract, but they did not pay additional fees
[CheckFunds] Wallet for role "Mediator" contains valueFromList [(AdaAssetId,15472128),(AssetId "977e04b805157040748857c28e47eaafbda9272a2178572dafb2b2af" "Mediator",1)].
[Comment] Now the seller redeems the 50 ADA from the payout script.
[CallRedeem] Endpoint "redeem" called on ee85a47a-59ed-4cbb-a486-7140911a42ba for role "Seller".
[runContract] Instance ee85a47a-59ed-4cbb-a486-7140911a42ba received NewActiveEndpoints [].
[runContract] Instance ee85a47a-59ed-4cbb-a486-7140911a42ba received NewObservableState (Object (fromList [("contents",Array [String "33bf3aee-f7b0-44d3-b7d7-edff37f8d3f0",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance ee85a47a-59ed-4cbb-a486-7140911a42ba received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The seller should now have 67 ADA, but they may have paid up to 1 ADA in fees.
[CheckFunds] Wallet for role "Seller" contains valueFromList [(AdaAssetId,66574417),(AssetId "977e04b805157040748857c28e47eaafbda9272a2178572dafb2b2af" "Seller",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 433f7681-eaad-4e08-8f4b-f35cf26fd73f received ContractFinished Nothing.
[Stop] Instance 433f7681-eaad-4e08-8f4b-f35cf26fd73f stopped.
[Stop] Instance ee85a47a-59ed-4cbb-a486-7140911a42ba stopped.
[runContract] Instance ee85a47a-59ed-4cbb-a486-7140911a42ba received ContractFinished Nothing.
[Stop] Instance 8440f22b-fea9-4863-a48d-917264a37d97 stopped.
[runContract] Instance 8440f22b-fea9-4863-a48d-917264a37d97 received ContractFinished Nothing.
***** SUCCEEDED *****
