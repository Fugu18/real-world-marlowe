
***** Test "Escrow" *****
[Comment] Create the wallet for the buyer, fund it with 80 ADA, and activate the Marlowe endpoints.
[CreateWallet] Created wallet ea85ba3bc5d4c09b36f0349fda39bb1fd7e8ca56 for role "Buyer".
[FundWallet] Funded wallet ea85ba3bc5d4c09b36f0349fda39bb1fd7e8ca56 for role "Buyer" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance 3c7480f5-0347-4858-bb59-8277fb928c71 for role "Buyer".
[Comment] Create the wallet for the seller, fund it with 15 ADA, and activate the Marlowe endpoints.
[runContract] Instance 3c7480f5-0347-4858-bb59-8277fb928c71 received NewObservableState Null.
[runContract] Instance 3c7480f5-0347-4858-bb59-8277fb928c71 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 3c7480f5-0347-4858-bb59-8277fb928c71 received NewYieldedExportTxs [].
[CreateWallet] Created wallet dcf158c8ee7ae2fe62e8748f1b2760ccd32bc354 for role "Seller".
[FundWallet] Funded wallet dcf158c8ee7ae2fe62e8748f1b2760ccd32bc354 for role "Seller" with valueFromList [(AdaAssetId,15000000)].
[ActivateApp] Activated MarloweApp instance cae390c4-efc8-4069-8ab5-f3f32d0928d3 for role "Seller".
[Comment] Create the wallet for the mediator, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance cae390c4-efc8-4069-8ab5-f3f32d0928d3 received NewObservableState Null.
[runContract] Instance cae390c4-efc8-4069-8ab5-f3f32d0928d3 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance cae390c4-efc8-4069-8ab5-f3f32d0928d3 received NewYieldedExportTxs [].
[CreateWallet] Created wallet 8627e50454d6693af9b51220b0c1c2c93c6bd102 for role "Mediator".
[FundWallet] Funded wallet 8627e50454d6693af9b51220b0c1c2c93c6bd102 for role "Mediator" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance 801a8291-2fa8-4ea5-a487-287ca7769cac for role "Mediator".
[Comment] The mediator creates the escrow contract, which was downloaded from Marlowe Playground. The purchase price is 50 ADA.
[runContract] Instance 801a8291-2fa8-4ea5-a487-287ca7769cac received NewObservableState Null.
[runContract] Instance 801a8291-2fa8-4ea5-a487-287ca7769cac received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 801a8291-2fa8-4ea5-a487-287ca7769cac received NewYieldedExportTxs [].
[CallCreate] Endpoint "create" called on instance 801a8291-2fa8-4ea5-a487-287ca7769cac for owners [("Buyer",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "216a0513a04bdeb63f4499691dc888d96092793fae5a17ff4f31b6cd")) (StakeRefBase (KeyHashObj (KeyHash "cc9b59af466e4f0efef4ef066688af3031547beb7d3bd05053634d08"))))),("Seller",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "2ad1720d81f10b529e7999e41e785aaa1aaf6dc78b6e77692e83bb93")) (StakeRefBase (KeyHashObj (KeyHash "e6e70e69552a178220d830d575d0783c5dc50a98d6125bc26403b5c1"))))),("Mediator",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "431b8e9aff43b7fffb3d0bfd8233cc49f57eb8a219845b391ee1b99f")) (StakeRefBase (KeyHashObj (KeyHash "f6bfc2f467ad34ba4c7fa02192537e14d39ef8a98b8dfc60dee19d5f")))))].
[runContract] Instance 801a8291-2fa8-4ea5-a487-287ca7769cac received NewActiveEndpoints [].
[runContract] Instance 801a8291-2fa8-4ea5-a487-287ca7769cac received NewObservableState (Object (fromList [("contents",Array [String "6faaac1c-8020-42fb-9876-a19c52f1aa10",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "31b0e7dcb8f88c32c67f195b566246216b6803cf45b095ae6f830f0a"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "267bf9a565a7b4824485253d07b69f0ec59b0d58697555aad45e8292")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 801a8291-2fa8-4ea5-a487-287ca7769cac received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed with MarloweParams {rolePayoutValidatorHash = 31b0e7dcb8f88c32c67f195b566246216b6803cf45b095ae6f830f0a, rolesCurrency = 267bf9a565a7b4824485253d07b69f0ec59b0d58697555aad45e8292}.
[Comment] The mediator should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the buyer and seller along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Mediator" contains valueFromList [(AdaAssetId,13437841),(AssetId "267bf9a565a7b4824485253d07b69f0ec59b0d58697555aad45e8292" "Mediator",1)].
[Comment] The buyer and seller should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,82000000),(AssetId "267bf9a565a7b4824485253d07b69f0ec59b0d58697555aad45e8292" "Buyer",1)].
[CheckFunds] Wallet for role "Seller" contains valueFromList [(AdaAssetId,17000000),(AssetId "267bf9a565a7b4824485253d07b69f0ec59b0d58697555aad45e8292" "Seller",1)].
[Comment] The buyer and seller each need to follow the contract created by the mediator.
[Follow] Instance 3c7480f5-0347-4858-bb59-8277fb928c71 now follows instance 801a8291-2fa8-4ea5-a487-287ca7769cac.
[Follow] Instance cae390c4-efc8-4069-8ab5-f3f32d0928d3 now follows instance 801a8291-2fa8-4ea5-a487-287ca7769cac.
[Comment] The buyer deposits the 50 ADA purchase price.
[CallApplyInputs] Endpoint "apply-inputs" called on 3c7480f5-0347-4858-bb59-8277fb928c71 for inputs [ClientInput (IDeposit "Seller" "Buyer" (Token "" "") 50000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 3c7480f5-0347-4858-bb59-8277fb928c71 received NewActiveEndpoints [].
[runContract] Instance 3c7480f5-0347-4858-bb59-8277fb928c71 received NewObservableState (Object (fromList [("contents",Array [String "e385299f-5860-49b8-bfa1-79db72fdf270",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 3c7480f5-0347-4858-bb59-8277fb928c71 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The buyer should have about 32 ADA now, since they paid 50 ADA for the purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,30653169),(AssetId "267bf9a565a7b4824485253d07b69f0ec59b0d58697555aad45e8292" "Buyer",1)].
[Comment] The buyer receives the purchase and reports that everything is alright.
[CallApplyInputs] Endpoint "apply-inputs" called on 3c7480f5-0347-4858-bb59-8277fb928c71 for inputs [ClientInput (IChoice (ChoiceId "Everything is alright" "Buyer") 0)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 3c7480f5-0347-4858-bb59-8277fb928c71 received NewActiveEndpoints [].
[runContract] Instance 3c7480f5-0347-4858-bb59-8277fb928c71 received NewObservableState (Object (fromList [("contents",Array [String "33cf27c6-9c37-4d6a-b135-169ba96c4ef0",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 3c7480f5-0347-4858-bb59-8277fb928c71 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The buyer should still have 32 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,29368730),(AssetId "267bf9a565a7b4824485253d07b69f0ec59b0d58697555aad45e8292" "Buyer",1)].
[Comment] The mediator should have 16 ADA now because they received back their initial 2 ADA that was contributed when creating the contract, but they did not pay additional fees
[CheckFunds] Wallet for role "Mediator" contains valueFromList [(AdaAssetId,15437841),(AssetId "267bf9a565a7b4824485253d07b69f0ec59b0d58697555aad45e8292" "Mediator",1)].
[Comment] Now the seller redeems the 50 ADA from the payout script.
[CallRedeem] Endpoint "redeem" called on cae390c4-efc8-4069-8ab5-f3f32d0928d3 for role "Seller".
[runContract] Instance cae390c4-efc8-4069-8ab5-f3f32d0928d3 received NewActiveEndpoints [].
[runContract] Instance cae390c4-efc8-4069-8ab5-f3f32d0928d3 received NewObservableState (Object (fromList [("contents",Array [String "1dd961d7-8759-49a9-924f-da1af77b5a1d",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance cae390c4-efc8-4069-8ab5-f3f32d0928d3 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The seller should now have 67 ADA, but they may have paid up to 1 ADA in fees.
[CheckFunds] Wallet for role "Seller" contains valueFromList [(AdaAssetId,66557410),(AssetId "267bf9a565a7b4824485253d07b69f0ec59b0d58697555aad45e8292" "Seller",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 3c7480f5-0347-4858-bb59-8277fb928c71 received ContractFinished Nothing.
[Stop] Instance 3c7480f5-0347-4858-bb59-8277fb928c71 stopped.
[Stop] Instance cae390c4-efc8-4069-8ab5-f3f32d0928d3 stopped.
[runContract] Instance cae390c4-efc8-4069-8ab5-f3f32d0928d3 received ContractFinished Nothing.
[Stop] Instance 801a8291-2fa8-4ea5-a487-287ca7769cac stopped.
***** SUCCEEDED *****
[runContract] Instance 801a8291-2fa8-4ea5-a487-287ca7769cac received ContractFinished Nothing.
