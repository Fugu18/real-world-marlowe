
***** Test "Escrow" *****
[Comment] Create the wallet for the buyer, fund it with 80 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "domain goddess need cruise tooth clean parrot hidden real alcohol toilet frost over shine nominee parade noodle impact ripple local vital shrimp surge urge".
[createWallet] First wallet address is addr_test1qq2nj5tvqdcsxfagnydu8e06mqcqp7prusurmy2s0us3x6vlmypnqjlvjj8va76qnq2kjzqswycagxt0hetnf44fw3xsg0c8yu.
[createWallet] First public key hash is 1539516c03710327a8991bc3e5fad83000f823e4383d91507f211369.
[CreateWallet] Created wallet identified as ce8f667e74a0bea196580c2e166cf79c4f9b8193 for role "Buyer".
[FundWallet] Funded wallet for role "Buyer" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance "BuyerApp" with identifier bbf73bd8-e963-4982-8af1-360c01fe07fd for role "Buyer".
[Comment] Create the wallet for the seller, fund it with 15 ADA, and activate the Marlowe endpoints.
[runContract] Instance bbf73bd8-e963-4982-8af1-360c01fe07fd received NewObservableState Null.
[runContract] Instance bbf73bd8-e963-4982-8af1-360c01fe07fd received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance bbf73bd8-e963-4982-8af1-360c01fe07fd received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "arrest tool steak woman stick urge caught faint thumb know process allow amazing used people slow garden tunnel ramp castle voyage impose duck snap".
[createWallet] First wallet address is addr_test1qpzufrnqmul5j0y5k5cxs3q68sq8p4kfautc8xr45qsmc98pk6mq00z2wrcmhz936agd5hc97zql3g92w8kv7xeq7rhswygljs.
[createWallet] First public key hash is 45c48e60df3f493c94b53068441a3c0070d6c9ef17839875a021bc14.
[CreateWallet] Created wallet identified as 91b50579fe2148faf84ea58a268fbdb9da41ae5e for role "Seller".
[FundWallet] Funded wallet for role "Seller" with valueFromList [(AdaAssetId,15000000)].
[ActivateApp] Activated MarloweApp instance "SellerApp" with identifier a0b7f39b-1285-4937-b1c4-dd2ea20c4b55 for role "Seller".
[Comment] Create the wallet for the mediator, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance a0b7f39b-1285-4937-b1c4-dd2ea20c4b55 received NewObservableState Null.
[runContract] Instance a0b7f39b-1285-4937-b1c4-dd2ea20c4b55 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance a0b7f39b-1285-4937-b1c4-dd2ea20c4b55 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "crater junior staff limb arena desert excess faint baby come slender table clock unlock solve move adjust file remind laptop crack now finish alley".
[createWallet] First wallet address is addr_test1qpcqr5jrchx6wpdwp0u5n8as3d62ujqm439nu2yeq38y4jwmx5l7unl2hnrmsrv3f3h5m9xumz8qka2hguen8z4p2a6qk9xzcr.
[createWallet] First public key hash is 7001d243c5cda705ae0bf9499fb08b74ae481bac4b3e2899044e4ac9.
[CreateWallet] Created wallet identified as 46f0746cf5cade066b397c2a675509054df96a5e for role "Mediator".
[FundWallet] Funded wallet for role "Mediator" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance "MediatorApp" with identifier 3f425477-70e5-4c36-8135-1428a4de5c1e for role "Mediator".
[Comment] The mediator creates the escrow contract, which was downloaded from Marlowe Playground. The purchase price is 50 ADA.
[runContract] Instance 3f425477-70e5-4c36-8135-1428a4de5c1e received NewObservableState Null.
[runContract] Instance 3f425477-70e5-4c36-8135-1428a4de5c1e received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 3f425477-70e5-4c36-8135-1428a4de5c1e received NewYieldedExportTxs [].
[CallCreate] Endpoint "create" called on instance "MediatorApp" for owners [("Buyer",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "1539516c03710327a8991bc3e5fad83000f823e4383d91507f211369")) (StakeRefBase (KeyHashObj (KeyHash "9fd903304bec948ecefb4098156908107131d4196fbe5734d6a9744d"))))),("Seller",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "45c48e60df3f493c94b53068441a3c0070d6c9ef17839875a021bc14")) (StakeRefBase (KeyHashObj (KeyHash "e1b6b607bc4a70f1bb88b1d750da5f05f081f8a0aa71eccf1b20f0ef"))))),("Mediator",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "7001d243c5cda705ae0bf9499fb08b74ae481bac4b3e2899044e4ac9")) (StakeRefBase (KeyHashObj (KeyHash "db353fee4feabcc7b80d914c6f4d94dcd88e0b75574733338aa15774")))))].
[runContract] Instance 3f425477-70e5-4c36-8135-1428a4de5c1e received NewActiveEndpoints [].
[runContract] Instance 3f425477-70e5-4c36-8135-1428a4de5c1e received NewObservableState (Object (fromList [("contents",Array [String "7a29faeb-fdbe-4dba-a02a-09fccbef484b",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "f68bac66f8c99e1f889102385ec40b4e30850b9109cc0c17a764d7f5"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "e2800156f3126d7d02cab6e1fd3ade7f42550682f651943021d23c65")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 3f425477-70e5-4c36-8135-1428a4de5c1e received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wrcvunye0nha9fnntq266y8xdur6ly57cvg3knq7uptuuqqj9slve and role address addr_test1wrmghtrxlryeu8ugjyprshkypd8rppgtjyyucrqh5ajd0agqkfela with MarloweParams {rolePayoutValidatorHash = f68bac66f8c99e1f889102385ec40b4e30850b9109cc0c17a764d7f5, rolesCurrency = e2800156f3126d7d02cab6e1fd3ade7f42550682f651943021d23c65}.
[Comment] The mediator should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the buyer and seller along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Mediator" contains valueFromList [(AdaAssetId,13472128),(AssetId "e2800156f3126d7d02cab6e1fd3ade7f42550682f651943021d23c65" "Mediator",1)].
[Comment] The buyer and seller should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,82000000),(AssetId "e2800156f3126d7d02cab6e1fd3ade7f42550682f651943021d23c65" "Buyer",1)].
[CheckFunds] Wallet for role "Seller" contains valueFromList [(AdaAssetId,17000000),(AssetId "e2800156f3126d7d02cab6e1fd3ade7f42550682f651943021d23c65" "Seller",1)].
[Comment] The buyer and seller each need to follow the contract created by the mediator.
[Follow] Instance "BuyerApp" now follows instance "MediatorApp".
[Follow] Instance "SellerApp" now follows instance "MediatorApp".
[Comment] The buyer deposits the 50 ADA purchase price.
[runContract] Instance bbf73bd8-e963-4982-8af1-360c01fe07fd received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "BuyerApp" for inputs [ClientInput (IDeposit "Seller" "Buyer" (Token "" "") 50000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance bbf73bd8-e963-4982-8af1-360c01fe07fd received NewObservableState (Object (fromList [("contents",Array [String "b42fa68d-0611-4d2d-839f-dad5309df432",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance bbf73bd8-e963-4982-8af1-360c01fe07fd received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The buyer should have about 32 ADA now, since they paid 50 ADA for the purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,30706847),(AssetId "e2800156f3126d7d02cab6e1fd3ade7f42550682f651943021d23c65" "Buyer",1)].
[Comment] The buyer receives the purchase and reports that everything is alright.
[runContract] Instance bbf73bd8-e963-4982-8af1-360c01fe07fd received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "BuyerApp" for inputs [ClientInput (IChoice (ChoiceId "Everything is alright" "Buyer") 0)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance bbf73bd8-e963-4982-8af1-360c01fe07fd received NewObservableState (Object (fromList [("contents",Array [String "ac4bec78-b7c1-406f-9192-b62e854ea16f",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance bbf73bd8-e963-4982-8af1-360c01fe07fd received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The buyer should still have 32 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,29517267),(AssetId "e2800156f3126d7d02cab6e1fd3ade7f42550682f651943021d23c65" "Buyer",1)].
[Comment] The mediator should have 16 ADA now because they received back their initial 2 ADA that was contributed when creating the contract, but they did not pay additional fees
[CheckFunds] Wallet for role "Mediator" contains valueFromList [(AdaAssetId,15472128),(AssetId "e2800156f3126d7d02cab6e1fd3ade7f42550682f651943021d23c65" "Mediator",1)].
[Comment] Now the seller redeems the 50 ADA from the payout script.
[runContract] Instance a0b7f39b-1285-4937-b1c4-dd2ea20c4b55 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "SellerApp" for role "Seller".
[runContract] Instance a0b7f39b-1285-4937-b1c4-dd2ea20c4b55 received NewObservableState (Object (fromList [("contents",Array [String "a40e0d42-d1a7-4498-94d4-a189951b1f57",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance a0b7f39b-1285-4937-b1c4-dd2ea20c4b55 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The seller should now have 67 ADA, but they may have paid up to 1 ADA in fees.
[CheckFunds] Wallet for role "Seller" contains valueFromList [(AdaAssetId,66580222),(AssetId "e2800156f3126d7d02cab6e1fd3ade7f42550682f651943021d23c65" "Seller",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance bbf73bd8-e963-4982-8af1-360c01fe07fd received ContractFinished Nothing.
[Stop] Instance "BuyerApp" stopped.
[Stop] Instance "SellerApp" stopped.
[runContract] Instance a0b7f39b-1285-4937-b1c4-dd2ea20c4b55 received ContractFinished Nothing.
[Stop] Instance "MediatorApp" stopped.
[runContract] Instance 3f425477-70e5-4c36-8135-1428a4de5c1e received ContractFinished Nothing.
***** PASSED *****
