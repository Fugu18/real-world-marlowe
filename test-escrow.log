
***** Test "Escrow" *****
[Comment] Create the wallet for the buyer, fund it with 80 ADA, and activate the Marlowe endpoints.
[CreateWallet] Created wallet 6f0ecf3ba39c3be42f1ed37e2c61ec9aca35387b for role "Buyer".
[FundWallet] Funded wallet 6f0ecf3ba39c3be42f1ed37e2c61ec9aca35387b for role "Buyer" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance 02e82550-6350-4111-9597-7fdf9f06f587 for role "Buyer".
[Comment] Create the wallet for the seller, fund it with 15 ADA, and activate the Marlowe endpoints.
[runContract] Instance 02e82550-6350-4111-9597-7fdf9f06f587 received NewObservableState Null.
[runContract] Instance 02e82550-6350-4111-9597-7fdf9f06f587 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 02e82550-6350-4111-9597-7fdf9f06f587 received NewYieldedExportTxs [].
[CreateWallet] Created wallet 81096030e2e7b5bd801db2bfa1de6ba034ca51e6 for role "Seller".
[FundWallet] Funded wallet 81096030e2e7b5bd801db2bfa1de6ba034ca51e6 for role "Seller" with valueFromList [(AdaAssetId,15000000)].
[ActivateApp] Activated MarloweApp instance 15d5655b-7bd5-4290-9bc5-f96aed63d17a for role "Seller".
[Comment] Create the wallet for the mediator, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance 15d5655b-7bd5-4290-9bc5-f96aed63d17a received NewObservableState Null.
[runContract] Instance 15d5655b-7bd5-4290-9bc5-f96aed63d17a received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 15d5655b-7bd5-4290-9bc5-f96aed63d17a received NewYieldedExportTxs [].
[CreateWallet] Created wallet 519760696b03ebf78ea529a3cc44b470c3ee34e2 for role "Mediator".
[FundWallet] Funded wallet 519760696b03ebf78ea529a3cc44b470c3ee34e2 for role "Mediator" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance 2b41065a-463c-4df1-9247-202784b96988 for role "Mediator".
[Comment] The mediator creates the escrow contract, which was downloaded from Marlowe Playground. The purchase price is 50 ADA.
[CallCreate] Endpoint "create" called on instance 2b41065a-463c-4df1-9247-202784b96988 for owners [("Buyer",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "a594bbc76923b1f95ce8c6de625c108d6521bd26c7fbf4e831768d08")) (StakeRefBase (KeyHashObj (KeyHash "43bff3281d95f751426481f43db81c5dec69cc49c70cbf598421f56b"))))),("Seller",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "60f4cfc6885a40b87faa80c2a917e96c07274eacdff39e04e65ecffa")) (StakeRefBase (KeyHashObj (KeyHash "afc441d57918ba9169afa7fcc7924345f22e963232e56938e9a42ccb"))))),("Mediator",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "4216e7b8cfbe724686025d5dcd97bde4445ce72b7a0909ab64332571")) (StakeRefBase (KeyHashObj (KeyHash "6c1bb395334e1bab952fce4a53c7204a357c1a36b80eab2de4ccf819")))))].
[runContract] Instance 2b41065a-463c-4df1-9247-202784b96988 received NewObservableState Null.
[runContract] Instance 2b41065a-463c-4df1-9247-202784b96988 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 2b41065a-463c-4df1-9247-202784b96988 received NewYieldedExportTxs [].
[runContract] Instance 2b41065a-463c-4df1-9247-202784b96988 received NewActiveEndpoints [].
[runContract] Instance 2b41065a-463c-4df1-9247-202784b96988 received NewObservableState (Object (fromList [("contents",Array [String "477ffb3e-95cd-4236-bf76-0d155adf7fbc",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "92adac235071d764d9627696fe05037604b5ef9d904a058c6abb1e6a"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "228be992302d1b2fceec6befad98cc299bf6554763382dcaa13184b9")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 2b41065a-463c-4df1-9247-202784b96988 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed with MarloweParams {rolePayoutValidatorHash = 92adac235071d764d9627696fe05037604b5ef9d904a058c6abb1e6a, rolesCurrency = 228be992302d1b2fceec6befad98cc299bf6554763382dcaa13184b9}.
[Comment] The mediator should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the buyer and seller along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Mediator" contains valueFromList [(AdaAssetId,13437841),(AssetId "228be992302d1b2fceec6befad98cc299bf6554763382dcaa13184b9" "Mediator",1)].
[Comment] The buyer and seller should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,82000000),(AssetId "228be992302d1b2fceec6befad98cc299bf6554763382dcaa13184b9" "Buyer",1)].
[CheckFunds] Wallet for role "Seller" contains valueFromList [(AdaAssetId,17000000),(AssetId "228be992302d1b2fceec6befad98cc299bf6554763382dcaa13184b9" "Seller",1)].
[Comment] The buyer and seller each need to follow the contract created by the mediator.
[Follow] Instance 02e82550-6350-4111-9597-7fdf9f06f587 now follows instance 2b41065a-463c-4df1-9247-202784b96988.
[Follow] Instance 15d5655b-7bd5-4290-9bc5-f96aed63d17a now follows instance 2b41065a-463c-4df1-9247-202784b96988.
[Comment] The buyer deposits the 50 ADA purchase price.
[CallApplyInputs] Endpoint "apply-inputs" called on 02e82550-6350-4111-9597-7fdf9f06f587 for inputs [ClientInput (IDeposit "Seller" "Buyer" (Token "" "") 50000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 02e82550-6350-4111-9597-7fdf9f06f587 received NewActiveEndpoints [].
[runContract] Instance 02e82550-6350-4111-9597-7fdf9f06f587 received NewObservableState (Object (fromList [("contents",Array [String "690d286d-ca89-46c3-8d63-98dda713854f",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 02e82550-6350-4111-9597-7fdf9f06f587 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The buyer should have about 32 ADA now, since they paid 50 ADA for the purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,30653169),(AssetId "228be992302d1b2fceec6befad98cc299bf6554763382dcaa13184b9" "Buyer",1)].
[Comment] The buyer receives the purchase and reports that everything is alright.
[CallApplyInputs] Endpoint "apply-inputs" called on 02e82550-6350-4111-9597-7fdf9f06f587 for inputs [ClientInput (IChoice (ChoiceId "Everything is alright" "Buyer") 0)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 02e82550-6350-4111-9597-7fdf9f06f587 received NewActiveEndpoints [].
[runContract] Instance 02e82550-6350-4111-9597-7fdf9f06f587 received NewObservableState (Object (fromList [("contents",Array [String "c9aba115-d5fe-428f-aa32-f120817c9a81",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 02e82550-6350-4111-9597-7fdf9f06f587 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The buyer should still have 32 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,29368730),(AssetId "228be992302d1b2fceec6befad98cc299bf6554763382dcaa13184b9" "Buyer",1)].
[Comment] The mediator should have 16 ADA now because they received back their initial 2 ADA that was contributed when creating the contract, but they did not pay additional fees
[CheckFunds] Wallet for role "Mediator" contains valueFromList [(AdaAssetId,15437841),(AssetId "228be992302d1b2fceec6befad98cc299bf6554763382dcaa13184b9" "Mediator",1)].
[Comment] Now the seller redeems the 50 ADA from the payout script.
[CallRedeem] Endpoint "redeem" called on 15d5655b-7bd5-4290-9bc5-f96aed63d17a for role "Seller".
[runContract] Instance 15d5655b-7bd5-4290-9bc5-f96aed63d17a received NewActiveEndpoints [].
[runContract] Instance 15d5655b-7bd5-4290-9bc5-f96aed63d17a received NewObservableState (Object (fromList [("contents",Array [String "63cec447-da4e-4b52-b243-5736e900afc0",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 15d5655b-7bd5-4290-9bc5-f96aed63d17a received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The seller should now have 67 ADA, but they may have paid up to 1 ADA in fees.
[CheckFunds] Wallet for role "Seller" contains valueFromList [(AdaAssetId,66545253),(AssetId "228be992302d1b2fceec6befad98cc299bf6554763382dcaa13184b9" "Seller",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 02e82550-6350-4111-9597-7fdf9f06f587 received ContractFinished Nothing.
[Stop] Instance 02e82550-6350-4111-9597-7fdf9f06f587 stopped.
[Stop] Instance 15d5655b-7bd5-4290-9bc5-f96aed63d17a stopped.
[runContract] Instance 15d5655b-7bd5-4290-9bc5-f96aed63d17a received ContractFinished Nothing.
[Stop] Instance 2b41065a-463c-4df1-9247-202784b96988 stopped.
***** SUCCEEDED *****
[runContract] Instance 2b41065a-463c-4df1-9247-202784b96988 received ContractFinished Nothing.
