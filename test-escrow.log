
***** Test "Escrow" *****
[Comment] Create the wallet for the buyer, fund it with 80 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "orange execute until innocent front myth remind normal gorilla gun track weather train fog royal render chapter increase cradle faith scorpion square absent tilt".
[createWallet] First wallet address is addr_test1qq6dd72vqhjdjfqtmsncjuuugt2gnmu8xr3jmkr0zhrj686gp6t7khxmj0xkzdrvmxmmv55zekl46upp0z42lyfr56mqmndth8.
[createWallet] First public key hash is 34d6f94c05e4d9240bdc2789739c42d489ef8730e32dd86f15c72d1f.
[CreateWallet] Created wallet identified as cd960c8954ad1a0e36cacb76022a2bcb1012a136 for role "Buyer".
[FundWallet] Funded wallet for role "Buyer" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance "BuyerApp" with identifier 23d2b52e-dbc2-4e2a-939b-87b29729da7c for role "Buyer".
[Comment] Create the wallet for the seller, fund it with 15 ADA, and activate the Marlowe endpoints.
[runContract] Instance 23d2b52e-dbc2-4e2a-939b-87b29729da7c received NewObservableState Null.
[runContract] Instance 23d2b52e-dbc2-4e2a-939b-87b29729da7c received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 23d2b52e-dbc2-4e2a-939b-87b29729da7c received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "congress confirm frog lion improve slide pizza squirrel decline throw toy alley chronic guess badge plastic much vague copper witness skate group empower nature".
[createWallet] First wallet address is addr_test1qpvff3q73cspawtgvxpewqyrx4q040l22y4r7rxutgqfad56azn60thrnd0r65e7j7qx8v9qcqxj5x6qher5092d66aqfh2wxr.
[createWallet] First public key hash is 5894c41e8e201eb96861839700833540fabfea512a3f0cdc5a009eb6.
[CreateWallet] Created wallet identified as ee8c558744aab3aebde3f20c99674d0e269ae265 for role "Seller".
[FundWallet] Funded wallet for role "Seller" with valueFromList [(AdaAssetId,15000000)].
[ActivateApp] Activated MarloweApp instance "SellerApp" with identifier 09a0f291-1a51-42bc-91aa-568464f776f1 for role "Seller".
[Comment] Create the wallet for the mediator, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance 09a0f291-1a51-42bc-91aa-568464f776f1 received NewObservableState Null.
[runContract] Instance 09a0f291-1a51-42bc-91aa-568464f776f1 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 09a0f291-1a51-42bc-91aa-568464f776f1 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "question bike exact brief inflict tell snap wheel exact wagon corn special outdoor void reduce diagram harvest dizzy blue young frog play flash humor".
[createWallet] First wallet address is addr_test1qpvh2u9725kh2kw5mnjzwd8qe6hj6zguekg75y82xvc9j63af8q3us98lcecst6k0r6uj2ypzetrey79652hgxgqthaqemtwtg.
[createWallet] First public key hash is 597570be552d7559d4dce42734e0ceaf2d091ccd91ea10ea3330596a.
[CreateWallet] Created wallet identified as 8a39e1d945d0abcdd624bfe968cd67ceffad7287 for role "Mediator".
[FundWallet] Funded wallet for role "Mediator" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance "MediatorApp" with identifier 442b4f75-d02a-4a88-9683-a4ddfab03bcb for role "Mediator".
[Comment] The mediator creates the escrow contract, which was downloaded from Marlowe Playground. The purchase price is 50 ADA.
[CallCreate] Endpoint "create" called on instance "MediatorApp" for owners [("Buyer",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "34d6f94c05e4d9240bdc2789739c42d489ef8730e32dd86f15c72d1f")) (StakeRefBase (KeyHashObj (KeyHash "480e97eb5cdb93cd61346cd9b7b65282cdbf5d702178aaaf9123a6b6"))))),("Seller",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "5894c41e8e201eb96861839700833540fabfea512a3f0cdc5a009eb6")) (StakeRefBase (KeyHashObj (KeyHash "9ae8a7a7aee39b5e3d533e978063b0a0c00d2a1b40be4747954dd6ba"))))),("Mediator",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "597570be552d7559d4dce42734e0ceaf2d091ccd91ea10ea3330596a")) (StakeRefBase (KeyHashObj (KeyHash "3d49c11e40a7fe33882f5678f5c9288116563c93c5d5157419005dfa")))))].
[runContract] Instance 442b4f75-d02a-4a88-9683-a4ddfab03bcb received NewObservableState Null.
[runContract] Instance 442b4f75-d02a-4a88-9683-a4ddfab03bcb received NewActiveEndpoints [].
[runContract] Instance 442b4f75-d02a-4a88-9683-a4ddfab03bcb received NewYieldedExportTxs [].
[runContract] Instance 442b4f75-d02a-4a88-9683-a4ddfab03bcb received NewObservableState (Object (fromList [("contents",Array [String "0ee9ee2c-6c59-49d0-994f-76bb1e82ccda",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "c3f3f4067f7a0b6e174fed62ee8c5afb4c1fd7cba035ba0ef3365604"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "4bef8367ceb5841b00eeed71fce74277598f7d37fd6aee2c920612f7")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 442b4f75-d02a-4a88-9683-a4ddfab03bcb received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wqhajrlg8k5plajlw6jd6wd570j28adfq6ds9a36r0ax0ysdredvg and role address addr_test1wrpl8aqx0aaqkmshflkk9m5vtta5c87hewsrtwsw7vm9vpq79mu0q with MarloweParams {rolePayoutValidatorHash = c3f3f4067f7a0b6e174fed62ee8c5afb4c1fd7cba035ba0ef3365604, rolesCurrency = 4bef8367ceb5841b00eeed71fce74277598f7d37fd6aee2c920612f7}.
[Comment] The mediator should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the buyer and seller along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Mediator" contains valueFromList [(AdaAssetId,13472128),(AssetId "4bef8367ceb5841b00eeed71fce74277598f7d37fd6aee2c920612f7" "Mediator",1)].
[Comment] The buyer and seller should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,82000000),(AssetId "4bef8367ceb5841b00eeed71fce74277598f7d37fd6aee2c920612f7" "Buyer",1)].
[CheckFunds] Wallet for role "Seller" contains valueFromList [(AdaAssetId,17000000),(AssetId "4bef8367ceb5841b00eeed71fce74277598f7d37fd6aee2c920612f7" "Seller",1)].
[Comment] The buyer and seller each need to follow the contract created by the mediator.
[Follow] Instance "BuyerApp" now follows instance "MediatorApp".
[Follow] Instance "SellerApp" now follows instance "MediatorApp".
[Comment] The buyer deposits the 50 ADA purchase price.
[runContract] Instance 23d2b52e-dbc2-4e2a-939b-87b29729da7c received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "BuyerApp" for inputs [ClientInput (IDeposit "Seller" "Buyer" (Token "" "") 50000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 23d2b52e-dbc2-4e2a-939b-87b29729da7c received NewObservableState (Object (fromList [("contents",Array [String "43f9227c-c237-4a06-89bb-00dffa920729",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 23d2b52e-dbc2-4e2a-939b-87b29729da7c received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The buyer should have about 32 ADA now, since they paid 50 ADA for the purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,30706847),(AssetId "4bef8367ceb5841b00eeed71fce74277598f7d37fd6aee2c920612f7" "Buyer",1)].
[Comment] The buyer receives the purchase and reports that everything is alright.
[runContract] Instance 23d2b52e-dbc2-4e2a-939b-87b29729da7c received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "BuyerApp" for inputs [ClientInput (IChoice (ChoiceId "Everything is alright" "Buyer") 0)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 23d2b52e-dbc2-4e2a-939b-87b29729da7c received NewObservableState (Object (fromList [("contents",Array [String "561d5ade-7bcd-4631-923d-b49b2b87e1a7",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 23d2b52e-dbc2-4e2a-939b-87b29729da7c received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The buyer should still have 32 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,29517267),(AssetId "4bef8367ceb5841b00eeed71fce74277598f7d37fd6aee2c920612f7" "Buyer",1)].
[Comment] The mediator should have 16 ADA now because they received back their initial 2 ADA that was contributed when creating the contract, but they did not pay additional fees
[CheckFunds] Wallet for role "Mediator" contains valueFromList [(AdaAssetId,15472128),(AssetId "4bef8367ceb5841b00eeed71fce74277598f7d37fd6aee2c920612f7" "Mediator",1)].
[Comment] Now the seller redeems the 50 ADA from the payout script.
[runContract] Instance 09a0f291-1a51-42bc-91aa-568464f776f1 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "SellerApp" for role "Seller".
[runContract] Instance 09a0f291-1a51-42bc-91aa-568464f776f1 received NewObservableState (Object (fromList [("contents",Array [String "6dc3e821-7225-48cf-9472-cd5372d2b306",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 09a0f291-1a51-42bc-91aa-568464f776f1 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The seller should now have 67 ADA, but they may have paid up to 1 ADA in fees.
[CheckFunds] Wallet for role "Seller" contains valueFromList [(AdaAssetId,66574417),(AssetId "4bef8367ceb5841b00eeed71fce74277598f7d37fd6aee2c920612f7" "Seller",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 23d2b52e-dbc2-4e2a-939b-87b29729da7c received ContractFinished Nothing.
[Stop] Instance "BuyerApp" stopped.
[Stop] Instance "SellerApp" stopped.
[runContract] Instance 09a0f291-1a51-42bc-91aa-568464f776f1 received ContractFinished Nothing.
[Stop] Instance "MediatorApp" stopped.
***** PASSED *****
