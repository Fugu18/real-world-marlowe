
***** Test "Escrow" *****
[Comment] Create the wallet for the buyer, fund it with 80 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "blame coffee future camera car smoke earn legal figure north skull limb august valley throw cinnamon social disorder fossil fabric market grow pull frost".
[createWallet] First wallet address is addr_test1qr4ej989t3u2zf2xfg3s2x8wrcxtxqw9xq9rn3k9em3zcnrghyza77pn05atmxetck7j233d4vxsmsxmpl2u7g2xv6vsu39fe7.
[createWallet] First public key hash is eb9914e55c78a125464a230518ee1e0cb301c5300a39c6c5cee22c4c.
[CreateWallet] Created wallet identified as 2aa4705e15a1780b4d5f831a73337a3540f1f0c9 for role "Buyer".
[FundWallet] Funded wallet for role "Buyer" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance "BuyerApp" with identifier 1f628268-a181-4dbb-90e6-4e31f5bcb62e for role "Buyer".
[Comment] Create the wallet for the seller, fund it with 15 ADA, and activate the Marlowe endpoints.
[runContract] Instance 1f628268-a181-4dbb-90e6-4e31f5bcb62e received NewObservableState Null.
[runContract] Instance 1f628268-a181-4dbb-90e6-4e31f5bcb62e received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 1f628268-a181-4dbb-90e6-4e31f5bcb62e received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "poverty pudding normal produce erase mass claim tragic devote occur bean winter wolf material only best never cage blush expect picnic delay list segment".
[createWallet] First wallet address is addr_test1qrma0vl5glg5eql9cnl6940vushzkvfctzjk3s2r8zquyq0hfkcpvggk86vkdz7cjrf4dxlhq3zmndgzmnqflw3n2kgq7hdqfu.
[createWallet] First public key hash is f7d7b3f447d14c83e5c4ffa2d5ece42e2b313858a568c1433881c201.
[CreateWallet] Created wallet identified as 6cce187adacd20277328ae2e06e13591bc577e19 for role "Seller".
[FundWallet] Funded wallet for role "Seller" with valueFromList [(AdaAssetId,15000000)].
[ActivateApp] Activated MarloweApp instance "SellerApp" with identifier 352cec51-8583-4113-af3a-f998d0574b27 for role "Seller".
[Comment] Create the wallet for the mediator, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance 352cec51-8583-4113-af3a-f998d0574b27 received NewObservableState Null.
[runContract] Instance 352cec51-8583-4113-af3a-f998d0574b27 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 352cec51-8583-4113-af3a-f998d0574b27 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "account response vault about pipe loud tornado lucky coil country message drift become grunt evolve measure still rally inform assume swamp flight coach craft".
[createWallet] First wallet address is addr_test1qrajxeqyfdj7kss6ssa0d8twld806m8kt56c2c5z5dpgqw937hsrchnqsard6z8gspny7vel3mmtpuscvxur35eqkx0s7wpd23.
[createWallet] First public key hash is fb2364044b65eb421a843af69d6efb4efd6cf65d35856282a3428038.
[CreateWallet] Created wallet identified as ca3ae83ff5f872bc2e208cda944b7801fd6545b5 for role "Mediator".
[FundWallet] Funded wallet for role "Mediator" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance "MediatorApp" with identifier 0b52c196-e17c-41fb-89ed-37afecc0728d for role "Mediator".
[Comment] The mediator creates the escrow contract, which was downloaded from Marlowe Playground. The purchase price is 50 ADA.
[CallCreate] Endpoint "create" called on instance "MediatorApp" for owners [("Buyer",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "eb9914e55c78a125464a230518ee1e0cb301c5300a39c6c5cee22c4c")) (StakeRefBase (KeyHashObj (KeyHash "68b905df78337d3abd9b2bc5bd25462dab0d0dc0db0fd5cf21466699"))))),("Seller",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "f7d7b3f447d14c83e5c4ffa2d5ece42e2b313858a568c1433881c201")) (StakeRefBase (KeyHashObj (KeyHash "f74db01621163e99668bd890d3569bf70445b9b502dcc09fba335590"))))),("Mediator",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "fb2364044b65eb421a843af69d6efb4efd6cf65d35856282a3428038")) (StakeRefBase (KeyHashObj (KeyHash "b1f5e03c5e608746dd08e880664f333f8ef6b0f21861b838d320b19f")))))].
[runContract] Instance 0b52c196-e17c-41fb-89ed-37afecc0728d received NewObservableState Null.
[runContract] Instance 0b52c196-e17c-41fb-89ed-37afecc0728d received NewActiveEndpoints [].
[runContract] Instance 0b52c196-e17c-41fb-89ed-37afecc0728d received NewYieldedExportTxs [].
[runContract] Instance 0b52c196-e17c-41fb-89ed-37afecc0728d received NewObservableState (Object (fromList [("contents",Array [String "03985dbe-64c1-461a-9b53-5b5993dfc1c4",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "194dd429518f279a32c6465f82310ab2d1ab45bcc385ce867e41f5f4"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "6bb8ef21a663a9280d3b861f3bec7e96b5408bad20341846d0147ee6")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 0b52c196-e17c-41fb-89ed-37afecc0728d received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wzs9vy0506etxcgcv8ltulqme70kecyqnewg5pqzsn7nfsc6eru88 and role address addr_test1wqv5m4pf2x8j0x3jcer9lq33p2edr269hnpctn5x0eqltaq3uyleq with MarloweParams {rolePayoutValidatorHash = 194dd429518f279a32c6465f82310ab2d1ab45bcc385ce867e41f5f4, rolesCurrency = 6bb8ef21a663a9280d3b861f3bec7e96b5408bad20341846d0147ee6}.
[Comment] The mediator should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the buyer and seller along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Mediator" contains valueFromList [(AdaAssetId,13472128),(AssetId "6bb8ef21a663a9280d3b861f3bec7e96b5408bad20341846d0147ee6" "Mediator",1)].
[Comment] The buyer and seller should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,82000000),(AssetId "6bb8ef21a663a9280d3b861f3bec7e96b5408bad20341846d0147ee6" "Buyer",1)].
[CheckFunds] Wallet for role "Seller" contains valueFromList [(AdaAssetId,17000000),(AssetId "6bb8ef21a663a9280d3b861f3bec7e96b5408bad20341846d0147ee6" "Seller",1)].
[Comment] The buyer and seller each need to follow the contract created by the mediator.
[Follow] Instance "BuyerApp" now follows instance "MediatorApp".
[Follow] Instance "SellerApp" now follows instance "MediatorApp".
[Comment] The buyer deposits the 50 ADA purchase price.
[runContract] Instance 1f628268-a181-4dbb-90e6-4e31f5bcb62e received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "BuyerApp" for inputs [ClientInput (IDeposit "Seller" "Buyer" (Token "" "") 50000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 1f628268-a181-4dbb-90e6-4e31f5bcb62e received NewObservableState (Object (fromList [("contents",Array [String "9b162a03-3bf6-48e3-9168-17ed34b88939",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 1f628268-a181-4dbb-90e6-4e31f5bcb62e received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The buyer should have about 32 ADA now, since they paid 50 ADA for the purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,30790915),(AssetId "6bb8ef21a663a9280d3b861f3bec7e96b5408bad20341846d0147ee6" "Buyer",1)].
[Comment] The buyer receives the purchase and reports that everything is alright.
[runContract] Instance 1f628268-a181-4dbb-90e6-4e31f5bcb62e received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "BuyerApp" for inputs [ClientInput (IChoice (ChoiceId "Everything is alright" "Buyer") 0)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 1f628268-a181-4dbb-90e6-4e31f5bcb62e received NewObservableState (Object (fromList [("contents",Array [String "503009e0-dd35-4be2-b488-db4539d083e9",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 1f628268-a181-4dbb-90e6-4e31f5bcb62e received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The buyer should still have 32 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,29638466),(AssetId "6bb8ef21a663a9280d3b861f3bec7e96b5408bad20341846d0147ee6" "Buyer",1)].
[Comment] The mediator should have 16 ADA now because they received back their initial 2 ADA that was contributed when creating the contract, but they did not pay additional fees
[CheckFunds] Wallet for role "Mediator" contains valueFromList [(AdaAssetId,15472128),(AssetId "6bb8ef21a663a9280d3b861f3bec7e96b5408bad20341846d0147ee6" "Mediator",1)].
[Comment] Now the seller redeems the 50 ADA from the payout script.
[runContract] Instance 352cec51-8583-4113-af3a-f998d0574b27 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "SellerApp" for role "Seller".
[runContract] Instance 352cec51-8583-4113-af3a-f998d0574b27 received NewObservableState (Object (fromList [("contents",Array [String "c6138e7a-8730-436d-8e4f-9b251e5611a1",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 352cec51-8583-4113-af3a-f998d0574b27 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The seller should now have 67 ADA, but they may have paid up to 1 ADA in fees.
[CheckFunds] Wallet for role "Seller" contains valueFromList [(AdaAssetId,66574417),(AssetId "6bb8ef21a663a9280d3b861f3bec7e96b5408bad20341846d0147ee6" "Seller",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 1f628268-a181-4dbb-90e6-4e31f5bcb62e received ContractFinished Nothing.
[Stop] Instance "BuyerApp" stopped.
[Stop] Instance "SellerApp" stopped.
[runContract] Instance 352cec51-8583-4113-af3a-f998d0574b27 received ContractFinished Nothing.
[Stop] Instance "MediatorApp" stopped.
***** PASSED *****
