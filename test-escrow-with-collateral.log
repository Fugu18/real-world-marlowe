
***** Test "Escrow with Collateral" *****
[Comment] Create the wallet for the buyer, fund it with 90 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "dinosaur combine leisure census vote body eagle avocado arrive blue drift brown property polar skull favorite battle afraid require tackle apology chest airport mail".
[createWallet] First wallet address is addr_test1qqhulerncwjt0z7z5x6tmg2ea9h95t7uae9gfkm5n53j7m58h49gn3vkpwq3dk2fktx5lems6g4z839qrfp03ny4ddwsjjh56j.
[createWallet] First public key hash is 2fcfe473c3a4b78bc2a1b4bda159e96e5a2fdcee4a84db749d232f6e.
[CreateWallet] Created wallet identified as 362be2cf4357dc648eb628a2b42035e8d3aa61f3 for role "Buyer".
[FundWallet] Funded wallet for role "Buyer" with valueFromList [(AdaAssetId,90000000)].
[ActivateApp] Activated MarloweApp instance "BuyerApp" with identifier a4d19c27-c551-43b6-a9a4-0e2ccb8fe609 for role "Buyer".
[Comment] Create the wallet for the seller, fund it with 25 ADA, and activate the Marlowe endpoints.
[runContract] Instance a4d19c27-c551-43b6-a9a4-0e2ccb8fe609 received NewObservableState Null.
[runContract] Instance a4d19c27-c551-43b6-a9a4-0e2ccb8fe609 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance a4d19c27-c551-43b6-a9a4-0e2ccb8fe609 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "page side finish insect endless thunder garage token month all used chapter nothing taxi have castle opera smart drip friend average borrow elephant north".
[createWallet] First wallet address is addr_test1qpt6jvfgnqpv3cyl6at9s5phjggsvqyvj54tuztwtph8gnk2tjyryne9nl0cqsr6df79m8n5amphcy932fq0gg20j7nslvfpnz.
[createWallet] First public key hash is 57a931289802c8e09fd756585037921106008c952abe096e586e744e.
[CreateWallet] Created wallet identified as 03c4471f8467249b9f7d217bebc4b4336bcbd2e1 for role "Seller".
[FundWallet] Funded wallet for role "Seller" with valueFromList [(AdaAssetId,25000000)].
[ActivateApp] Activated MarloweApp instance "SellerApp" with identifier 0bfc196a-0bc5-4182-92a8-e5872621fc0d for role "Seller".
[Comment] Create the wallet for the mediator, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance 0bfc196a-0bc5-4182-92a8-e5872621fc0d received NewObservableState Null.
[runContract] Instance 0bfc196a-0bc5-4182-92a8-e5872621fc0d received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 0bfc196a-0bc5-4182-92a8-e5872621fc0d received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "erase unique congress combine weekend snake hat salmon apart exist front genuine enemy cycle region payment shift cube foam protect grace gain afraid width".
[createWallet] First wallet address is addr_test1qz3a3pdz0y4zcyfrhqesuvm9q4vrdugzpcvlyx54j0fw87qvrcndnde905d67j5k7ruplhd2a5ev89pxq2r4axl5z7dshz30l2.
[createWallet] First public key hash is a3d885a2792a2c1123b8330e3365055836f1020e19f21a9593d2e3f8.
[CreateWallet] Created wallet identified as d55d059ad5b56ff462bb659c072d88f2fb862d0b for role "Mediator".
[FundWallet] Funded wallet for role "Mediator" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance "MediatorApp" with identifier 8eb590d2-f01e-423b-82e8-f4e6357c8ade for role "Mediator".
[Comment] The mediator creates the escrow contract, which was downloaded from Marlowe Playground. The purchase price is 50 ADA, and each party must deposit 10 ADA of collateral.
[CallCreate] Endpoint "create" called on instance "MediatorApp" for owners [("Buyer",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "2fcfe473c3a4b78bc2a1b4bda159e96e5a2fdcee4a84db749d232f6e")) (StakeRefBase (KeyHashObj (KeyHash "87bd4a89c5960b8116d949b2cd4fe770d22a23c4a01a42f8cc956b5d"))))),("Seller",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "57a931289802c8e09fd756585037921106008c952abe096e586e744e")) (StakeRefBase (KeyHashObj (KeyHash "ca5c88324f259fdf80407a6a7c5d9e74eec37c10b15240f4214f97a7"))))),("Mediator",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "a3d885a2792a2c1123b8330e3365055836f1020e19f21a9593d2e3f8")) (StakeRefBase (KeyHashObj (KeyHash "0c1e26d9b7257d1baf4a96f0f81fddaaed32c3942602875e9bf4179b")))))].
[runContract] Instance 8eb590d2-f01e-423b-82e8-f4e6357c8ade received NewObservableState Null.
[runContract] Instance 8eb590d2-f01e-423b-82e8-f4e6357c8ade received NewActiveEndpoints [].
[runContract] Instance 8eb590d2-f01e-423b-82e8-f4e6357c8ade received NewYieldedExportTxs [].
[runContract] Instance 8eb590d2-f01e-423b-82e8-f4e6357c8ade received NewObservableState (Object (fromList [("contents",Array [String "96e3ff91-a258-4615-8a7d-b3607fcc78fc",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "5a4b0f1aff188cd5e5bed802d9895823011e8a0800ae13e55e70a6a8"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "2423393d2eacb3b7172124a4966caeabec062efe3bf9bc49cbbb3a7e")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 8eb590d2-f01e-423b-82e8-f4e6357c8ade received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wzhe2lrsrksxk828cazzprjfft3am6nexc33e9dk0lc476gvxe2pt and role address addr_test1wpdykrc6luvge409hmvq9kvftq3sz852pqq2uyl9tec2d2q5jad9s with MarloweParams {rolePayoutValidatorHash = 5a4b0f1aff188cd5e5bed802d9895823011e8a0800ae13e55e70a6a8, rolesCurrency = 2423393d2eacb3b7172124a4966caeabec062efe3bf9bc49cbbb3a7e}.
[Comment] The mediator should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the buyer and seller along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Mediator" contains valueFromList [(AdaAssetId,13469664),(AssetId "2423393d2eacb3b7172124a4966caeabec062efe3bf9bc49cbbb3a7e" "Mediator",1)].
[Comment] The buyer and seller should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,92000000),(AssetId "2423393d2eacb3b7172124a4966caeabec062efe3bf9bc49cbbb3a7e" "Buyer",1)].
[CheckFunds] Wallet for role "Seller" contains valueFromList [(AdaAssetId,27000000),(AssetId "2423393d2eacb3b7172124a4966caeabec062efe3bf9bc49cbbb3a7e" "Seller",1)].
[Comment] The buyer and seller each need to follow the contract created by the mediator.
[Follow] Instance "BuyerApp" now follows instance "MediatorApp".
[Follow] Instance "SellerApp" now follows instance "MediatorApp".
[Comment] The seller deposits the 10 ADA collateral.
[runContract] Instance 0bfc196a-0bc5-4182-92a8-e5872621fc0d received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "SellerApp" for inputs [ClientInput (IDeposit "Seller" "Seller" (Token "" "") 10000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 0bfc196a-0bc5-4182-92a8-e5872621fc0d received NewObservableState (Object (fromList [("contents",Array [String "9b2503f6-f076-42dc-bfeb-ab917a9189f5",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 0bfc196a-0bc5-4182-92a8-e5872621fc0d received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The seller should have about 17 ADA now, since they paid 10 ADA of collateral, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Seller" contains valueFromList [(AdaAssetId,15681139),(AssetId "2423393d2eacb3b7172124a4966caeabec062efe3bf9bc49cbbb3a7e" "Seller",1)].
[Comment] The buyer deposits the 10 ADA collateral.
[runContract] Instance a4d19c27-c551-43b6-a9a4-0e2ccb8fe609 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "BuyerApp" for inputs [ClientInput (IDeposit "Buyer" "Buyer" (Token "" "") 10000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance a4d19c27-c551-43b6-a9a4-0e2ccb8fe609 received NewObservableState (Object (fromList [("contents",Array [String "3298f54f-3932-4b7f-b573-68b66a0b27e1",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance a4d19c27-c551-43b6-a9a4-0e2ccb8fe609 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The buyer should have about 82 ADA now, since they paid 10 ADA of collateral, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,80667336),(AssetId "2423393d2eacb3b7172124a4966caeabec062efe3bf9bc49cbbb3a7e" "Buyer",1)].
[Comment] The buyer deposits the 50 ADA purchase price.
[runContract] Instance a4d19c27-c551-43b6-a9a4-0e2ccb8fe609 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "BuyerApp" for inputs [ClientInput (IDeposit "Seller" "Buyer" (Token "" "") 50000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance a4d19c27-c551-43b6-a9a4-0e2ccb8fe609 received NewObservableState (Object (fromList [("contents",Array [String "3d71eec0-aada-4dc2-938a-d251b8a43f79",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance a4d19c27-c551-43b6-a9a4-0e2ccb8fe609 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The buyer should have about 32 ADA now, since they paid 50 ADA for the purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,29261441),(AssetId "2423393d2eacb3b7172124a4966caeabec062efe3bf9bc49cbbb3a7e" "Buyer",1)].
[Comment] The buyer receives the purchase and reports that there is a problem.
[runContract] Instance a4d19c27-c551-43b6-a9a4-0e2ccb8fe609 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "BuyerApp" for inputs [ClientInput (IChoice (ChoiceId "Report problem" "Buyer") 1)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance a4d19c27-c551-43b6-a9a4-0e2ccb8fe609 received NewObservableState (Object (fromList [("contents",Array [String "d1599412-996f-40fc-a6cb-f3d931400f32",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance a4d19c27-c551-43b6-a9a4-0e2ccb8fe609 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The buyer should have 32 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Buyer" contains valueFromList [(AdaAssetId,27794185),(AssetId "2423393d2eacb3b7172124a4966caeabec062efe3bf9bc49cbbb3a7e" "Buyer",1)].
[Comment] The seller disputes that there is a problem.
[runContract] Instance 0bfc196a-0bc5-4182-92a8-e5872621fc0d received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "SellerApp" for inputs [ClientInput (IChoice (ChoiceId "Dispute problem" "Seller") 0)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 0bfc196a-0bc5-4182-92a8-e5872621fc0d received NewObservableState (Object (fromList [("contents",Array [String "052bd1f2-87f7-4592-91f5-b60a9e47268c",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 0bfc196a-0bc5-4182-92a8-e5872621fc0d received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The seller should still have 5 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Seller" contains valueFromList [(AdaAssetId,14283154),(AssetId "2423393d2eacb3b7172124a4966caeabec062efe3bf9bc49cbbb3a7e" "Seller",1)].
[Comment] Now the mediator redeems the 22 ADA from the payout script.
[runContract] Instance 8eb590d2-f01e-423b-82e8-f4e6357c8ade received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "MediatorApp" for role "Mediator".
[runContract] Instance 8eb590d2-f01e-423b-82e8-f4e6357c8ade received NewObservableState (Object (fromList [("contents",Array [String "839ee715-01a1-4d4e-81f3-1209486fa3a9",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 8eb590d2-f01e-423b-82e8-f4e6357c8ade received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The mediator should have 36 ADA now because they received back their initial 2 ADA that was contributed when creating the contract and they received all of the collateral, but they paid additional fees.
***** FAILED *****
[CheckFunds]: Wallet for role "Mediator" contains Lovelace 15469664, which is outside the range (Lovelace 34000000,Lovelace 36000000).
