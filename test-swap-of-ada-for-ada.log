
***** Test "Swap of ADA for ADA" *****
[Comment] Create the wallet for the ADA provider, fund it with 50 ADA, and activate the Marlowe endpoints.
[CreateWallet] Created wallet b5d63443b1f7fe833fb2cd523beacb8011d4f6cc for role "Ada provider".
[FundWallet] Funded wallet b5d63443b1f7fe833fb2cd523beacb8011d4f6cc for role "Ada provider" with valueFromList [(AdaAssetId,50000000)].
[ActivateApp] Activated MarloweApp instance 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 for role "Ada provider".
[Comment] Create the wallet for the other provider, fund it with 40 ADA, and activate the Marlowe endpoints.
[runContract] Instance 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 received NewObservableState Null.
[runContract] Instance 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 received NewYieldedExportTxs [].
[CreateWallet] Created wallet fccb239bd193c5a7c3de283ba29b210853581812 for role "Other provider".
[FundWallet] Funded wallet fccb239bd193c5a7c3de283ba29b210853581812 for role "Other provider" with valueFromList [(AdaAssetId,40000000)].
[ActivateApp] Activated MarloweApp instance 21b98f0d-1813-4feb-8e3c-24901b0e29b8 for role "Other provider".
[Comment] The ADA provider creates the swap contract for 30 ADA to 25 ADA.
[runContract] Instance 21b98f0d-1813-4feb-8e3c-24901b0e29b8 received NewObservableState Null.
[runContract] Instance 21b98f0d-1813-4feb-8e3c-24901b0e29b8 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 21b98f0d-1813-4feb-8e3c-24901b0e29b8 received NewYieldedExportTxs [].
[CallCreate] Endpoint "create" called on instance 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 for owners [("Ada provider",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "6d0076afacbe49cb278d216819b1bf4f775b7a1fb47dfb3dcbd72a26")) (StakeRefBase (KeyHashObj (KeyHash "a9da82fe22bfe8cb18961d9a38ef1fb62ba014affd0f4522ca83f8ec"))))),("Other provider",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "6bdcd6813cbc6c4b58e95246ca6d65ca76e41994a81f9910d333fc4f")) (StakeRefBase (KeyHashObj (KeyHash "03a99a67ef615b4f24c77e58f07795f0b8a00af55adca7f1bdb8554d")))))].
[runContract] Instance 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 received NewActiveEndpoints [].
[runContract] Instance 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 received NewObservableState (Object (fromList [("contents",Array [String "cd715a25-2209-4462-9356-aedf34746c98",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "2613a2a3c9871b806c94eb0f7e463d5947beb7b1bf52112732d45041"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "fb0f22de7f3b5ba70a257ac8227128e05d324589d30c4413409c7454")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed with MarloweParams {rolePayoutValidatorHash = 2613a2a3c9871b806c94eb0f7e463d5947beb7b1bf52112732d45041, rolesCurrency = fb0f22de7f3b5ba70a257ac8227128e05d324589d30c4413409c7454}.
[Comment] The ADA provider should have 46 ADA now, since 2 ADA was sent to the script when creating the contract and 2 ADA was sent to the other provider along with their role token, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,45533562),(AssetId "fb0f22de7f3b5ba70a257ac8227128e05d324589d30c4413409c7454" "Ada provider",1)].
[Comment] The other provider should have 42 ADA.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,42000000),(AssetId "fb0f22de7f3b5ba70a257ac8227128e05d324589d30c4413409c7454" "Other provider",1)].
[Comment] The other provider needs to followe the contract created by the ada provider.
[Follow] Instance 21b98f0d-1813-4feb-8e3c-24901b0e29b8 now follows instance 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5.
[Comment] The ADA provider deposits their 30 ADA for the swap.
[CallApplyInputs] Endpoint "apply-inputs" called on 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 for inputs [ClientInput (IDeposit "Ada provider" "Ada provider" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 received NewActiveEndpoints [].
[runContract] Instance 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 received NewObservableState (Object (fromList [("contents",Array [String "cac87812-a292-4bb3-bd16-23695bd00c06",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The ADA provider should have 16 ADA now, since they paid 30 ADA for the swap, minus up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,14309284),(AssetId "fb0f22de7f3b5ba70a257ac8227128e05d324589d30c4413409c7454" "Ada provider",1)].
[Comment] The other provider deposits their 25 ADA for the swap.
[CallApplyInputs] Endpoint "apply-inputs" called on 21b98f0d-1813-4feb-8e3c-24901b0e29b8 for inputs [ClientInput (IDeposit "Other provider" "Other provider" (Token "" "") 25000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 21b98f0d-1813-4feb-8e3c-24901b0e29b8 received NewActiveEndpoints [].
[runContract] Instance 21b98f0d-1813-4feb-8e3c-24901b0e29b8 received NewObservableState (Object (fromList [("contents",Array [String "f2714798-a18c-44fc-a45b-11c490b51a01",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 21b98f0d-1813-4feb-8e3c-24901b0e29b8 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The other provider should have 17 ADA, since they paid 25 USD for the swap, minus up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,15680401),(AssetId "fb0f22de7f3b5ba70a257ac8227128e05d324589d30c4413409c7454" "Other provider",1)].
[Comment] Now the ADA provider redeems the 27 ADA from the payout script.
[CallRedeem] Endpoint "redeem" called on 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 for role "Ada provider".
[runContract] Instance 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 received NewActiveEndpoints [].
[runContract] Instance 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 received NewObservableState (Object (fromList [("contents",Array [String "52cf0523-513a-45e2-95fc-16e1b6af8561",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The ADA provider should now have 42 ADA, but they may have paid up to 4 ADA in fees.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,40821715),(AssetId "fb0f22de7f3b5ba70a257ac8227128e05d324589d30c4413409c7454" "Ada provider",1)].
[Comment] Now the other provider redeems the 30 ADA from the payout script.
[CallRedeem] Endpoint "redeem" called on 21b98f0d-1813-4feb-8e3c-24901b0e29b8 for role "Other provider".
[runContract] Instance 21b98f0d-1813-4feb-8e3c-24901b0e29b8 received NewActiveEndpoints [].
[runContract] Instance 21b98f0d-1813-4feb-8e3c-24901b0e29b8 received NewObservableState (Object (fromList [("contents",Array [String "08f117dd-2681-47e6-9d5b-7762c8ac4db8",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 21b98f0d-1813-4feb-8e3c-24901b0e29b8 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The other provider should now have 47 ADA, but they may have paid up to 3 ADA in fees.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,45176132),(AssetId "fb0f22de7f3b5ba70a257ac8227128e05d324589d30c4413409c7454" "Other provider",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 received ContractFinished Nothing.
[Stop] Instance 00c695cb-24e5-4c4e-92d4-c5ae3d6829a5 stopped.
[Stop] Instance 21b98f0d-1813-4feb-8e3c-24901b0e29b8 stopped.
***** SUCCEEDED *****
