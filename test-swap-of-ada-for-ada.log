
***** Test "Swap of ADA for ADA" *****
[Comment] Create the wallet for the ADA provider, fund it with 50 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "culture prepare fatal sell survey depart injury alley fun depth mouse dune image public wing tag warm topple since rough broccoli life enrich group".
[createWallet] First wallet address is addr_test1qq9e02lskf0mfgrh8ejxk6wa8xck2ccdsatp63dcawm6484urde23puwv9knz5e63kct07mpew98kqg4wx040tjhma5qesudj7.
[createWallet] First public key hash is 0b97abf0b25fb4a0773e646b69dd39b165630d87561d45b8ebb7aa9e.
[CreateWallet] Created wallet identified as 1b8dec7e554227e6614458b9218e5d1b3125b4ef for role "Ada provider".
[FundWallet] Funded wallet for role "Ada provider" with valueFromList [(AdaAssetId,50000000)].
[ActivateApp] Activated MarloweApp instance "AdaApp" with identifier 3ac8c238-6b0a-497a-9de4-c3ce347a6d2c for role "Ada provider".
[Comment] Create the wallet for the other provider, fund it with 40 ADA, and activate the Marlowe endpoints.
[runContract] Instance 3ac8c238-6b0a-497a-9de4-c3ce347a6d2c received NewObservableState Null.
[runContract] Instance 3ac8c238-6b0a-497a-9de4-c3ce347a6d2c received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 3ac8c238-6b0a-497a-9de4-c3ce347a6d2c received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "seek erupt digital uphold shove venue dry crash use sample pair reject youth avoid search laundry only knock cream village mystery amazing focus fit".
[createWallet] First wallet address is addr_test1qphax9ge2nux5kg6t0dtv57yvnzpmyyta7kztjlm6hp2c5658330s5qw29clee2y2ur9cvh0zupmnne7ur6cym7rnkzqaprh42.
[createWallet] First public key hash is 6fd3151954f86a591a5bdab653c464c41d908befac25cbfbd5c2ac53.
[CreateWallet] Created wallet identified as 37ec27d39469b33b98ab9a6d0ccedcd6a5074c72 for role "Other provider".
[FundWallet] Funded wallet for role "Other provider" with valueFromList [(AdaAssetId,40000000)].
[ActivateApp] Activated MarloweApp instance "OtherApp" with identifier 5336ad75-6a39-4744-8bfc-21acdf3a97b5 for role "Other provider".
[Comment] The ADA provider creates the swap contract for 30 ADA to 25 ADA.
[CallCreate] Endpoint "create" called on instance "AdaApp" for owners [("Ada provider",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "0b97abf0b25fb4a0773e646b69dd39b165630d87561d45b8ebb7aa9e")) (StakeRefBase (KeyHashObj (KeyHash "bc1b72a8878e616d31533a8db0b7fb61cb8a7b0115719f57ae57df68"))))),("Other provider",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "6fd3151954f86a591a5bdab653c464c41d908befac25cbfbd5c2ac53")) (StakeRefBase (KeyHashObj (KeyHash "543c62f8500e5171fce54457065c32ef1703b9cf3ee0f5826fc39d84")))))].
[runContract] Instance 3ac8c238-6b0a-497a-9de4-c3ce347a6d2c received NewActiveEndpoints [].
[runContract] Instance 5336ad75-6a39-4744-8bfc-21acdf3a97b5 received NewObservableState Null.
[runContract] Instance 5336ad75-6a39-4744-8bfc-21acdf3a97b5 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 5336ad75-6a39-4744-8bfc-21acdf3a97b5 received NewYieldedExportTxs [].
[runContract] Instance 3ac8c238-6b0a-497a-9de4-c3ce347a6d2c received NewObservableState (Object (fromList [("contents",Array [String "f05c90c4-3c9e-4c09-b389-319907e49cb0",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "df573e3d178e2c254dda96427863d13553121139b4dace3a54d0426d"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "de6fea3afc04f4358e1e6be1f88603e6072807ac2e118bfbd2a0281c")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 3ac8c238-6b0a-497a-9de4-c3ce347a6d2c received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wq8nhqxu9a0rhs84pqwjh9wth7ym57dtxjzvzuren8rt2ts8v0zc6 and role address addr_test1wr04w03az78zcf2dm2tyy7rr6y64xys38x6d4n362ngyymg27f5z7 with MarloweParams {rolePayoutValidatorHash = df573e3d178e2c254dda96427863d13553121139b4dace3a54d0426d, rolesCurrency = de6fea3afc04f4358e1e6be1f88603e6072807ac2e118bfbd2a0281c}.
[Comment] The ADA provider should have 46 ADA now, since 2 ADA was sent to the script when creating the contract and 2 ADA was sent to the other provider along with their role token, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,45533562),(AssetId "de6fea3afc04f4358e1e6be1f88603e6072807ac2e118bfbd2a0281c" "Ada provider",1)].
[Comment] The other provider should have 42 ADA.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,42000000),(AssetId "de6fea3afc04f4358e1e6be1f88603e6072807ac2e118bfbd2a0281c" "Other provider",1)].
[Comment] The other provider needs to followe the contract created by the ada provider.
[Follow] Instance "OtherApp" now follows instance "AdaApp".
[Comment] The ADA provider deposits their 30 ADA for the swap.
[runContract] Instance 3ac8c238-6b0a-497a-9de4-c3ce347a6d2c received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "AdaApp" for inputs [ClientInput (IDeposit "Ada provider" "Ada provider" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 3ac8c238-6b0a-497a-9de4-c3ce347a6d2c received NewObservableState (Object (fromList [("contents",Array [String "9dacc629-aca3-4732-b9ed-2029f9047675",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 3ac8c238-6b0a-497a-9de4-c3ce347a6d2c received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The ADA provider should have 16 ADA now, since they paid 30 ADA for the swap, minus up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,14160840),(AssetId "de6fea3afc04f4358e1e6be1f88603e6072807ac2e118bfbd2a0281c" "Ada provider",1)].
[Comment] The other provider deposits their 25 ADA for the swap.
[runContract] Instance 5336ad75-6a39-4744-8bfc-21acdf3a97b5 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OtherApp" for inputs [ClientInput (IDeposit "Other provider" "Other provider" (Token "" "") 25000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 5336ad75-6a39-4744-8bfc-21acdf3a97b5 received NewObservableState (Object (fromList [("contents",Array [String "4ac69874-84e0-4fd6-b721-abc4bd7fc665",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 5336ad75-6a39-4744-8bfc-21acdf3a97b5 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The other provider should have 17 ADA, since they paid 25 USD for the swap, minus up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,15657727),(AssetId "de6fea3afc04f4358e1e6be1f88603e6072807ac2e118bfbd2a0281c" "Other provider",1)].
[Comment] Now the ADA provider redeems the 27 ADA from the payout script.
[runContract] Instance 3ac8c238-6b0a-497a-9de4-c3ce347a6d2c received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "AdaApp" for role "Ada provider".
[runContract] Instance 3ac8c238-6b0a-497a-9de4-c3ce347a6d2c received NewObservableState (Object (fromList [("contents",Array [String "9fd9d6eb-93e9-4f01-8294-87babbee07cd",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 3ac8c238-6b0a-497a-9de4-c3ce347a6d2c received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The ADA provider should now have 42 ADA, but they may have paid up to 4 ADA in fees.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,40684880),(AssetId "de6fea3afc04f4358e1e6be1f88603e6072807ac2e118bfbd2a0281c" "Ada provider",1)].
[Comment] Now the other provider redeems the 30 ADA from the payout script.
[runContract] Instance 5336ad75-6a39-4744-8bfc-21acdf3a97b5 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "OtherApp" for role "Other provider".
[runContract] Instance 5336ad75-6a39-4744-8bfc-21acdf3a97b5 received NewObservableState (Object (fromList [("contents",Array [String "1f08fe4e-5f01-4714-9f9b-aaeb9ed8724a",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 5336ad75-6a39-4744-8bfc-21acdf3a97b5 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The other provider should now have 47 ADA, but they may have paid up to 3 ADA in fees.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,45153458),(AssetId "de6fea3afc04f4358e1e6be1f88603e6072807ac2e118bfbd2a0281c" "Other provider",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 3ac8c238-6b0a-497a-9de4-c3ce347a6d2c received ContractFinished Nothing.
[Stop] Instance "AdaApp" stopped.
[Stop] Instance "OtherApp" stopped.
***** PASSED *****
