
***** Test "Swap of ADA for ADA" *****
[Comment] Create the wallet for the ADA provider, fund it with 50 ADA, and activate the Marlowe endpoints.
[CreateWallet] Created wallet 1564cb419155092a56bce51ecb47579ecfe11005 for role "Ada provider".
[FundWallet] Funded wallet 1564cb419155092a56bce51ecb47579ecfe11005 for role "Ada provider" with valueFromList [(AdaAssetId,50000000)].
[ActivateApp] Activated MarloweApp instance e2c2a930-b6ff-4853-8200-aee54b6b7ace for role "Ada provider".
[Comment] Create the wallet for the other provider, fund it with 40 ADA, and activate the Marlowe endpoints.
[runContract] Instance e2c2a930-b6ff-4853-8200-aee54b6b7ace received NewObservableState Null.
[runContract] Instance e2c2a930-b6ff-4853-8200-aee54b6b7ace received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance e2c2a930-b6ff-4853-8200-aee54b6b7ace received NewYieldedExportTxs [].
[CreateWallet] Created wallet 5bbfe6d06c617ba5c8ec3a66035a37203c67140b for role "Other provider".
[FundWallet] Funded wallet 5bbfe6d06c617ba5c8ec3a66035a37203c67140b for role "Other provider" with valueFromList [(AdaAssetId,40000000)].
[ActivateApp] Activated MarloweApp instance e63e32cf-da63-4cd3-9bf7-7d02a0c0f34b for role "Other provider".
[Comment] The ADA provider creates the swap contract for 30 ADA to 25 ADA.
[CallCreate] Endpoint "create" called on instance e2c2a930-b6ff-4853-8200-aee54b6b7ace for owners [("Ada provider",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "986b0cbd66c6a5821b85fc3a5bd6e2b3db16cb0f6bc45ad24e0991c7")) (StakeRefBase (KeyHashObj (KeyHash "53ecc429553619d107003f7840ef9101c13ba86f36b634497ca2f509"))))),("Other provider",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "63f3f6373d17f13f71559be49257d9feb29c23f5a4dcfcf1843e91e4")) (StakeRefBase (KeyHashObj (KeyHash "a8b4fb5cb5e4212b5dac3ccd5ea32221fdebb422f9cfbdab2ff80e4e")))))].
[runContract] Instance e63e32cf-da63-4cd3-9bf7-7d02a0c0f34b received NewObservableState Null.
[runContract] Instance e63e32cf-da63-4cd3-9bf7-7d02a0c0f34b received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance e63e32cf-da63-4cd3-9bf7-7d02a0c0f34b received NewYieldedExportTxs [].
[runContract] Instance e2c2a930-b6ff-4853-8200-aee54b6b7ace received NewActiveEndpoints [].
[runContract] Instance e2c2a930-b6ff-4853-8200-aee54b6b7ace received NewObservableState (Object (fromList [("contents",Array [String "7ebcf1e7-6b47-4ea2-aff5-60aa16af490f",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "1f3d54818d16c6a117c5d400a9d44025cca3a04fdd76e7d7551f1a38"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "50ee003183de2300ec093ee4321ece7f20b2da1f298392933979f196")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance e2c2a930-b6ff-4853-8200-aee54b6b7ace received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed with MarloweParams {rolePayoutValidatorHash = 1f3d54818d16c6a117c5d400a9d44025cca3a04fdd76e7d7551f1a38, rolesCurrency = 50ee003183de2300ec093ee4321ece7f20b2da1f298392933979f196}.
[Comment] The ADA provider should have 46 ADA now, since 2 ADA was sent to the script when creating the contract and 2 ADA was sent to the other provider along with their role token, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,45533562),(AssetId "50ee003183de2300ec093ee4321ece7f20b2da1f298392933979f196" "Ada provider",1)].
[Comment] The other provider should have 42 ADA.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,42000000),(AssetId "50ee003183de2300ec093ee4321ece7f20b2da1f298392933979f196" "Other provider",1)].
[Comment] The other provider needs to followe the contract created by the ada provider.
[Follow] Instance e63e32cf-da63-4cd3-9bf7-7d02a0c0f34b now follows instance e2c2a930-b6ff-4853-8200-aee54b6b7ace.
[Comment] The ADA provider deposits their 30 ADA for the swap.
[CallApplyInputs] Endpoint "apply-inputs" called on e2c2a930-b6ff-4853-8200-aee54b6b7ace for inputs [ClientInput (IDeposit "Ada provider" "Ada provider" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance e2c2a930-b6ff-4853-8200-aee54b6b7ace received NewActiveEndpoints [].
[runContract] Instance e2c2a930-b6ff-4853-8200-aee54b6b7ace received NewObservableState (Object (fromList [("contents",Array [String "a52445cc-e0cf-4b2d-8fa5-dad1ec790090",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[AwaitApplyInputs] Input application confirmed.
[Comment] The ADA provider should have 16 ADA now, since they paid 30 ADA for the swap, minus up to an additional 2 ADA in fees.
[runContract] Instance e2c2a930-b6ff-4853-8200-aee54b6b7ace received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,14309284),(AssetId "50ee003183de2300ec093ee4321ece7f20b2da1f298392933979f196" "Ada provider",1)].
[Comment] The other provider deposits their 25 ADA for the swap.
[CallApplyInputs] Endpoint "apply-inputs" called on e63e32cf-da63-4cd3-9bf7-7d02a0c0f34b for inputs [ClientInput (IDeposit "Other provider" "Other provider" (Token "" "") 25000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance e63e32cf-da63-4cd3-9bf7-7d02a0c0f34b received NewActiveEndpoints [].
[runContract] Instance e63e32cf-da63-4cd3-9bf7-7d02a0c0f34b received NewObservableState (Object (fromList [("contents",Array [String "94e3ba02-e41f-4a83-a67e-8e9280b28499",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance e63e32cf-da63-4cd3-9bf7-7d02a0c0f34b received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The other provider should have 17 ADA, since they paid 25 USD for the swap, minus up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,15690610),(AssetId "50ee003183de2300ec093ee4321ece7f20b2da1f298392933979f196" "Other provider",1)].
[Comment] Now the ADA provider redeems the 27 ADA from the payout script.
[CallRedeem] Endpoint "redeem" called on e2c2a930-b6ff-4853-8200-aee54b6b7ace for role "Ada provider".
[runContract] Instance e2c2a930-b6ff-4853-8200-aee54b6b7ace received NewActiveEndpoints [].
[runContract] Instance e2c2a930-b6ff-4853-8200-aee54b6b7ace received NewObservableState (Object (fromList [("contents",Array [String "27d012be-d5aa-40d1-88e7-22b79447b029",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance e2c2a930-b6ff-4853-8200-aee54b6b7ace received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The ADA provider should now have 42 ADA, but they may have paid up to 4 ADA in fees.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,40833324),(AssetId "50ee003183de2300ec093ee4321ece7f20b2da1f298392933979f196" "Ada provider",1)].
[Comment] Now the other provider redeems the 30 ADA from the payout script.
[CallRedeem] Endpoint "redeem" called on e63e32cf-da63-4cd3-9bf7-7d02a0c0f34b for role "Other provider".
[runContract] Instance e63e32cf-da63-4cd3-9bf7-7d02a0c0f34b received NewActiveEndpoints [].
[runContract] Instance e63e32cf-da63-4cd3-9bf7-7d02a0c0f34b received NewObservableState (Object (fromList [("contents",Array [String "8729f74e-c26b-4cb5-b920-0fb0a1c117ba",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance e63e32cf-da63-4cd3-9bf7-7d02a0c0f34b received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The other provider should now have 47 ADA, but they may have paid up to 3 ADA in fees.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,45186341),(AssetId "50ee003183de2300ec093ee4321ece7f20b2da1f298392933979f196" "Other provider",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance e2c2a930-b6ff-4853-8200-aee54b6b7ace received ContractFinished Nothing.
[Stop] Instance e2c2a930-b6ff-4853-8200-aee54b6b7ace stopped.
[Stop] Instance e63e32cf-da63-4cd3-9bf7-7d02a0c0f34b stopped.
***** SUCCEEDED *****
