
***** Test "Swap of ADA for ADA" *****
[Comment] Create the wallet for the ADA provider, fund it with 50 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "engage attend coast item better copper ivory embark juice merit broom general quarter brown inflict will human harsh edge teach lift biology net sketch".
[createWallet] First wallet address is addr_test1qpr8s8hd7gj42mc0yhc4sktz0n70z3vwrtvgcs6vqksedgx9cj3pepmlnwc9dylff822n7k9qnnxhkgs59nte2sakztqr2kqga.
[createWallet] First public key hash is 46781eedf225556f0f25f15859627cfcf1458e1ad88c434c05a196a0.
[CreateWallet] Created wallet identified as 937386a7e7c9cbd2a864baf37f78eda8158c7c67 for role "Ada provider".
[FundWallet] Funded wallet for role "Ada provider" with valueFromList [(AdaAssetId,50000000)].
[ActivateApp] Activated MarloweApp instance "AdaApp" with identifier 7e1d23ee-1dc8-4a9a-bdba-4531549658d8 for role "Ada provider".
[Comment] Create the wallet for the other provider, fund it with 40 ADA, and activate the Marlowe endpoints.
[runContract] Instance 7e1d23ee-1dc8-4a9a-bdba-4531549658d8 received NewObservableState Null.
[runContract] Instance 7e1d23ee-1dc8-4a9a-bdba-4531549658d8 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 7e1d23ee-1dc8-4a9a-bdba-4531549658d8 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "easy panther river voice deputy clap visual race reunion hazard horn uphold health card veteran drill hybrid hour food tool simple village same jewel".
[createWallet] First wallet address is addr_test1qp42u236ly7fe4fjk0wvtk57guxcxyjcmgq9wz0968uar2dkzt8z6cg6pcnqs2w5fc4x9k2saqjj3df2xs7ne97rczeqy4uwsa.
[createWallet] First public key hash is 6aae2a3af93c9cd532b3dcc5da9e470d831258da005709e5d1f9d1a9.
[CreateWallet] Created wallet identified as 7830376f057bb061a8311937a99bd843ace88736 for role "Other provider".
[FundWallet] Funded wallet for role "Other provider" with valueFromList [(AdaAssetId,40000000)].
[ActivateApp] Activated MarloweApp instance "OtherApp" with identifier 7a48e594-fb05-43d2-85f6-080f8be5a5f6 for role "Other provider".
[Comment] The ADA provider creates the swap contract for 30 ADA to 25 ADA.
[runContract] Instance 7a48e594-fb05-43d2-85f6-080f8be5a5f6 received NewObservableState Null.
[runContract] Instance 7a48e594-fb05-43d2-85f6-080f8be5a5f6 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 7a48e594-fb05-43d2-85f6-080f8be5a5f6 received NewYieldedExportTxs [].
[CallCreate] Endpoint "create" called on instance "AdaApp" for owners [("Ada provider",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "46781eedf225556f0f25f15859627cfcf1458e1ad88c434c05a196a0")) (StakeRefBase (KeyHashObj (KeyHash "c5c4a21c877f9bb05693e949d4a9fac504e66bd910a166bcaa1db096"))))),("Other provider",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "6aae2a3af93c9cd532b3dcc5da9e470d831258da005709e5d1f9d1a9")) (StakeRefBase (KeyHashObj (KeyHash "b612ce2d611a0e260829d44e2a62d950e82528b52a343d3c97c3c0b2")))))].
[runContract] Instance 7e1d23ee-1dc8-4a9a-bdba-4531549658d8 received NewActiveEndpoints [].
[runContract] Instance 7e1d23ee-1dc8-4a9a-bdba-4531549658d8 received NewObservableState (Object (fromList [("contents",Array [String "e763c782-4299-4d29-af02-49ae609dccf0",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "f74ed9f06cf3f87078654abce8adcdbc7c27a6a11b9e5ded2fab5bd7"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "dbb4b20c3295632d6644bd557f257c83cb9a018dc945f9d1ed98db71")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 7e1d23ee-1dc8-4a9a-bdba-4531549658d8 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wqae2pjq0vt7c8ch972nq96ymerxzkhhf74wjx8q4uhylps2je522 and role address addr_test1wrm5ak0sdnelsurcv49te69dek78cfax5ydeuh0d9744h4cyz0dh9 with MarloweParams {rolePayoutValidatorHash = f74ed9f06cf3f87078654abce8adcdbc7c27a6a11b9e5ded2fab5bd7, rolesCurrency = dbb4b20c3295632d6644bd557f257c83cb9a018dc945f9d1ed98db71}.
[Comment] The ADA provider should have 46 ADA now, since 2 ADA was sent to the script when creating the contract and 2 ADA was sent to the other provider along with their role token, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,45533562),(AssetId "dbb4b20c3295632d6644bd557f257c83cb9a018dc945f9d1ed98db71" "Ada provider",1)].
[Comment] The other provider should have 42 ADA.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,42000000),(AssetId "dbb4b20c3295632d6644bd557f257c83cb9a018dc945f9d1ed98db71" "Other provider",1)].
[Comment] The other provider needs to followe the contract created by the ada provider.
[Follow] Instance "OtherApp" now follows instance "AdaApp".
[Comment] The ADA provider deposits their 30 ADA for the swap.
[runContract] Instance 7e1d23ee-1dc8-4a9a-bdba-4531549658d8 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "AdaApp" for inputs [ClientInput (IDeposit "Ada provider" "Ada provider" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 7e1d23ee-1dc8-4a9a-bdba-4531549658d8 received NewObservableState (Object (fromList [("contents",Array [String "ed23e469-d09a-4c89-857a-71e4f57b8ff9",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 7e1d23ee-1dc8-4a9a-bdba-4531549658d8 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The ADA provider should have 16 ADA now, since they paid 30 ADA for the swap, minus up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,14309284),(AssetId "dbb4b20c3295632d6644bd557f257c83cb9a018dc945f9d1ed98db71" "Ada provider",1)].
[Comment] The other provider deposits their 25 ADA for the swap.
[runContract] Instance 7a48e594-fb05-43d2-85f6-080f8be5a5f6 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OtherApp" for inputs [ClientInput (IDeposit "Other provider" "Other provider" (Token "" "") 25000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 7a48e594-fb05-43d2-85f6-080f8be5a5f6 received NewObservableState (Object (fromList [("contents",Array [String "c3a5e7f3-9b6e-4404-896c-c0786405f5da",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 7a48e594-fb05-43d2-85f6-080f8be5a5f6 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The other provider should have 17 ADA, since they paid 25 USD for the swap, minus up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,15690610),(AssetId "dbb4b20c3295632d6644bd557f257c83cb9a018dc945f9d1ed98db71" "Other provider",1)].
[Comment] Now the ADA provider redeems the 27 ADA from the payout script.
[runContract] Instance 7e1d23ee-1dc8-4a9a-bdba-4531549658d8 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "AdaApp" for role "Ada provider".
[runContract] Instance 7e1d23ee-1dc8-4a9a-bdba-4531549658d8 received NewObservableState (Object (fromList [("contents",Array [String "3d15a58a-1451-4229-bc69-042e22a5deac",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 7e1d23ee-1dc8-4a9a-bdba-4531549658d8 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The ADA provider should now have 42 ADA, but they may have paid up to 4 ADA in fees.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,40821715),(AssetId "dbb4b20c3295632d6644bd557f257c83cb9a018dc945f9d1ed98db71" "Ada provider",1)].
[Comment] Now the other provider redeems the 30 ADA from the payout script.
[runContract] Instance 7a48e594-fb05-43d2-85f6-080f8be5a5f6 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "OtherApp" for role "Other provider".
[runContract] Instance 7a48e594-fb05-43d2-85f6-080f8be5a5f6 received NewObservableState (Object (fromList [("contents",Array [String "a0ce7cc6-a04f-4bfc-9a03-3e2ffcb17012",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 7a48e594-fb05-43d2-85f6-080f8be5a5f6 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The other provider should now have 47 ADA, but they may have paid up to 3 ADA in fees.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,45186341),(AssetId "dbb4b20c3295632d6644bd557f257c83cb9a018dc945f9d1ed98db71" "Other provider",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 7e1d23ee-1dc8-4a9a-bdba-4531549658d8 received ContractFinished Nothing.
[Stop] Instance "AdaApp" stopped.
[Stop] Instance "OtherApp" stopped.
***** PASSED *****
