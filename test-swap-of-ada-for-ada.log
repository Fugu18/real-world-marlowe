
***** Test "Swap of ADA for ADA" *****
[Comment] Create the wallet for the ADA provider, fund it with 50 ADA, and activate the Marlowe endpoints.
[CreateWallet] Created wallet c3d39110846c317ad94fdcd6ef092ee675e4f7d1 for role "Ada provider".
[FundWallet] Funded wallet c3d39110846c317ad94fdcd6ef092ee675e4f7d1 for role "Ada provider" with valueFromList [(AdaAssetId,50000000)].
[ActivateApp] Activated MarloweApp instance b9a01e46-a273-4052-8658-254a18e06686 for role "Ada provider".
[Comment] Create the wallet for the other provider, fund it with 40 ADA, and activate the Marlowe endpoints.
[runContract] Instance b9a01e46-a273-4052-8658-254a18e06686 received NewObservableState Null.
[runContract] Instance b9a01e46-a273-4052-8658-254a18e06686 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance b9a01e46-a273-4052-8658-254a18e06686 received NewYieldedExportTxs [].
[CreateWallet] Created wallet 047a28b3bd773b4dddb093a594a231a94a5aedab for role "Other provider".
[FundWallet] Funded wallet 047a28b3bd773b4dddb093a594a231a94a5aedab for role "Other provider" with valueFromList [(AdaAssetId,40000000)].
[ActivateApp] Activated MarloweApp instance d656923a-711e-4fa0-ba37-ffa7ff29b93e for role "Other provider".
[Comment] The ADA provider creates the swap contract for 30 ADA to 25 ADA.
[CallCreate] Endpoint "create" called on instance b9a01e46-a273-4052-8658-254a18e06686 for owners [("Ada provider",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "ca99093d17b333184c7cf0465a66efe882bd466c0e23a6a97521bd5a")) (StakeRefBase (KeyHashObj (KeyHash "295cccba92f22150489b9b94363aed95e7f81b766a5cdfac0df2bc97"))))),("Other provider",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "5c9790ef57e35a11cc7589c20d9c98a0a0e7d4fd20f090154388eefa")) (StakeRefBase (KeyHashObj (KeyHash "a1d08d76d719d2906bc89f2cb82c1c17a05044466e747949293af302")))))].
[runContract] Instance d656923a-711e-4fa0-ba37-ffa7ff29b93e received NewObservableState Null.
[runContract] Instance d656923a-711e-4fa0-ba37-ffa7ff29b93e received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance d656923a-711e-4fa0-ba37-ffa7ff29b93e received NewYieldedExportTxs [].
[runContract] Instance b9a01e46-a273-4052-8658-254a18e06686 received NewActiveEndpoints [].
[runContract] Instance b9a01e46-a273-4052-8658-254a18e06686 received NewObservableState (Object (fromList [("contents",Array [String "fb8555c4-1782-4493-8f2a-039d90dfcca9",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "fb3b7ee8db920a5f21ec79274b0bace6b3234f3330d27a67e281d09f"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "f0539e12c83504c4ff1f0a5025d03fa58fbcfb14133f80bfcdb9ccc1")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance b9a01e46-a273-4052-8658-254a18e06686 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed with MarloweParams {rolePayoutValidatorHash = fb3b7ee8db920a5f21ec79274b0bace6b3234f3330d27a67e281d09f, rolesCurrency = f0539e12c83504c4ff1f0a5025d03fa58fbcfb14133f80bfcdb9ccc1}.
[Comment] The ADA provider should have 46 ADA now, since 2 ADA was sent to the script when creating the contract and 2 ADA was sent to the other provider along with their role token, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,45505188),(AssetId "f0539e12c83504c4ff1f0a5025d03fa58fbcfb14133f80bfcdb9ccc1" "Ada provider",1)].
[Comment] The other provider should have 42 ADA.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,42000000),(AssetId "f0539e12c83504c4ff1f0a5025d03fa58fbcfb14133f80bfcdb9ccc1" "Other provider",1)].
[Comment] The other provider needs to followe the contract created by the ada provider.
[Follow] Instance d656923a-711e-4fa0-ba37-ffa7ff29b93e now follows instance b9a01e46-a273-4052-8658-254a18e06686.
[Comment] The ADA provider deposits their 30 ADA for the swap.
[CallApplyInputs] Endpoint "apply-inputs" called on b9a01e46-a273-4052-8658-254a18e06686 for inputs [ClientInput (IDeposit "Ada provider" "Ada provider" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance b9a01e46-a273-4052-8658-254a18e06686 received NewActiveEndpoints [].
[runContract] Instance b9a01e46-a273-4052-8658-254a18e06686 received NewObservableState (Object (fromList [("contents",Array [String "59a13ed1-bbc0-4c2a-9ee0-9fe69acfb42e",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance b9a01e46-a273-4052-8658-254a18e06686 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The ADA provider should have 16 ADA now, since they paid 30 ADA for the swap, minus up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,14138992),(AssetId "f0539e12c83504c4ff1f0a5025d03fa58fbcfb14133f80bfcdb9ccc1" "Ada provider",1)].
[Comment] The other provider deposits their 25 ADA for the swap.
[CallApplyInputs] Endpoint "apply-inputs" called on d656923a-711e-4fa0-ba37-ffa7ff29b93e for inputs [ClientInput (IDeposit "Other provider" "Other provider" (Token "" "") 25000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance d656923a-711e-4fa0-ba37-ffa7ff29b93e received NewActiveEndpoints [].
[runContract] Instance d656923a-711e-4fa0-ba37-ffa7ff29b93e received NewObservableState (Object (fromList [("contents",Array [String "4fb3460a-de57-4604-a06e-b81fbdd126f5",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance d656923a-711e-4fa0-ba37-ffa7ff29b93e received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The other provider should have 17 ADA, since they paid 25 USD for the swap, minus up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,15518180),(AssetId "f0539e12c83504c4ff1f0a5025d03fa58fbcfb14133f80bfcdb9ccc1" "Other provider",1)].
[Comment] Now the ADA provider redeems the 27 ADA from the payout script.
[CallRedeem] Endpoint "redeem" called on b9a01e46-a273-4052-8658-254a18e06686 for role "Ada provider".
[runContract] Instance b9a01e46-a273-4052-8658-254a18e06686 received NewActiveEndpoints [].
[runContract] Instance b9a01e46-a273-4052-8658-254a18e06686 received NewObservableState (Object (fromList [("contents",Array [String "c37acdfd-7fe4-49d7-809a-33fbe073eac4",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance b9a01e46-a273-4052-8658-254a18e06686 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The ADA provider should now have 42 ADA, but they may have paid up to 4 ADA in fees.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,40634916),(AssetId "f0539e12c83504c4ff1f0a5025d03fa58fbcfb14133f80bfcdb9ccc1" "Ada provider",1)].
[Comment] Now the other provider redeems the 30 ADA from the payout script.
[CallRedeem] Endpoint "redeem" called on d656923a-711e-4fa0-ba37-ffa7ff29b93e for role "Other provider".
[runContract] Instance d656923a-711e-4fa0-ba37-ffa7ff29b93e received NewActiveEndpoints [].
[runContract] Instance d656923a-711e-4fa0-ba37-ffa7ff29b93e received NewObservableState (Object (fromList [("contents",Array [String "bf791a49-a8e2-494a-850c-49fc9777407f",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance d656923a-711e-4fa0-ba37-ffa7ff29b93e received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The other provider should now have 47 ADA, but they may have paid up to 3 ADA in fees.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,44983143),(AssetId "f0539e12c83504c4ff1f0a5025d03fa58fbcfb14133f80bfcdb9ccc1" "Other provider",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance b9a01e46-a273-4052-8658-254a18e06686 received ContractFinished Nothing.
[Stop] Instance b9a01e46-a273-4052-8658-254a18e06686 stopped.
[Stop] Instance d656923a-711e-4fa0-ba37-ffa7ff29b93e stopped.
***** SUCCEEDED *****
