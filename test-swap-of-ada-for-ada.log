
***** Test "Swap of ADA for ADA" *****
[Comment] Create the wallet for the ADA provider, fund it with 50 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "negative slab scrub hawk play scrub blame cruel very plunge side recycle demise body barrel magnet ladder obvious hard profit cat option essence surface".
[createWallet] First wallet address is addr_test1qzu5j6p5zpywjnqhh03dlmxzlwm5vh5s97460fd45pc938kttggv7pcqdurp3w26up2lljk7qjwsw9rxku8qk29f66usjasdkg.
[createWallet] First public key hash is b94968341048e94c17bbe2dfecc2fbb7465e902faba7a5b5a070589e.
[CreateWallet] Created wallet identified as 7fc86a4a0fc0b5c6464591638c7e1f3186290992 for role "Ada provider".
[FundWallet] Funded wallet for role "Ada provider" with valueFromList [(AdaAssetId,50000000)].
[ActivateApp] Activated MarloweApp instance "AdaApp" with identifier 8d318fe5-2108-4e2f-9559-06911e09d1f7 for role "Ada provider".
[Comment] Create the wallet for the other provider, fund it with 40 ADA, and activate the Marlowe endpoints.
[runContract] Instance 8d318fe5-2108-4e2f-9559-06911e09d1f7 received NewObservableState Null.
[runContract] Instance 8d318fe5-2108-4e2f-9559-06911e09d1f7 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 8d318fe5-2108-4e2f-9559-06911e09d1f7 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "treat plastic bid useless romance access account essence inner sense absorb frozen camp sweet awful vote fine solution fiction impose midnight spawn assist equip".
[createWallet] First wallet address is addr_test1qrvl3kp8gn8mhxxhq3t0828n40flnrg30xds3cev6hht0vs88lzu5rpchl0qcp92qxy2fvrt22m7h5dzjk4fga7jzcms2nhuns.
[createWallet] First public key hash is d9f8d82744cfbb98d70456f3a8f3abd3f98d11799b08e32cd5eeb7b2.
[CreateWallet] Created wallet identified as 59ac59e1b8f249df82eb18f3a346ade5b8e279b0 for role "Other provider".
[FundWallet] Funded wallet for role "Other provider" with valueFromList [(AdaAssetId,40000000)].
[ActivateApp] Activated MarloweApp instance "OtherApp" with identifier 1294ef66-4808-46c0-806a-91466f02ea71 for role "Other provider".
[Comment] The ADA provider creates the swap contract for 30 ADA to 25 ADA.
[CallCreate] Endpoint "create" called on instance "AdaApp" for owners [("Ada provider",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "b94968341048e94c17bbe2dfecc2fbb7465e902faba7a5b5a070589e")) (StakeRefBase (KeyHashObj (KeyHash "cb5a10cf07006f0618b95ae055ffcade049d071466b70e0b28a9d6b9"))))),("Other provider",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "d9f8d82744cfbb98d70456f3a8f3abd3f98d11799b08e32cd5eeb7b2")) (StakeRefBase (KeyHashObj (KeyHash "073fc5ca0c38bfde0c04aa0188a4b06b52b7ebd1a295aa9477d21637")))))].
[runContract] Instance 8d318fe5-2108-4e2f-9559-06911e09d1f7 received NewActiveEndpoints [].
[runContract] Instance 1294ef66-4808-46c0-806a-91466f02ea71 received NewObservableState Null.
[runContract] Instance 1294ef66-4808-46c0-806a-91466f02ea71 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 1294ef66-4808-46c0-806a-91466f02ea71 received NewYieldedExportTxs [].
[runContract] Instance 8d318fe5-2108-4e2f-9559-06911e09d1f7 received NewObservableState (Object (fromList [("contents",Array [String "14692a11-5847-4d68-a703-a9c1d21cd461",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "02dfbdf6fc58d0f06b229ebf52dbbdf01a9d51d5ec73145968139f9b"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "0b3f7be53fa288407bd686519f3029e9cbfa3e3737472f61adbd5a2d")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 8d318fe5-2108-4e2f-9559-06911e09d1f7 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wp750pn44ak75hq58vmsruay8sktu5qs5qh6pmx8pesm3acwzs2hp and role address addr_test1wqpdl00kl3vdpurty20t75kmhhcp48236hk8x9zedqfelxcvme8l2 with MarloweParams {rolePayoutValidatorHash = 02dfbdf6fc58d0f06b229ebf52dbbdf01a9d51d5ec73145968139f9b, rolesCurrency = 0b3f7be53fa288407bd686519f3029e9cbfa3e3737472f61adbd5a2d}.
[Comment] The ADA provider should have 46 ADA now, since 2 ADA was sent to the script when creating the contract and 2 ADA was sent to the other provider along with their role token, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,45533562),(AssetId "0b3f7be53fa288407bd686519f3029e9cbfa3e3737472f61adbd5a2d" "Ada provider",1)].
[Comment] The other provider should have 42 ADA.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,42000000),(AssetId "0b3f7be53fa288407bd686519f3029e9cbfa3e3737472f61adbd5a2d" "Other provider",1)].
[Comment] The other provider needs to followe the contract created by the ada provider.
[Follow] Instance "OtherApp" now follows instance "AdaApp".
[Comment] The ADA provider deposits their 30 ADA for the swap.
[runContract] Instance 8d318fe5-2108-4e2f-9559-06911e09d1f7 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "AdaApp" for inputs [ClientInput (IDeposit "Ada provider" "Ada provider" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 8d318fe5-2108-4e2f-9559-06911e09d1f7 received NewObservableState (Object (fromList [("contents",Array [String "cfba6226-33a9-4f8e-8108-d73df6abe5b3",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 8d318fe5-2108-4e2f-9559-06911e09d1f7 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The ADA provider should have 16 ADA now, since they paid 30 ADA for the swap, minus up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,14161016),(AssetId "0b3f7be53fa288407bd686519f3029e9cbfa3e3737472f61adbd5a2d" "Ada provider",1)].
[Comment] The other provider deposits their 25 ADA for the swap.
[runContract] Instance 1294ef66-4808-46c0-806a-91466f02ea71 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OtherApp" for inputs [ClientInput (IDeposit "Other provider" "Other provider" (Token "" "") 25000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 1294ef66-4808-46c0-806a-91466f02ea71 received NewObservableState (Object (fromList [("contents",Array [String "5d738fdf-41b6-4f30-b4a5-0bd4a816fe8f",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 1294ef66-4808-46c0-806a-91466f02ea71 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The other provider should have 17 ADA, since they paid 25 USD for the swap, minus up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,15652067),(AssetId "0b3f7be53fa288407bd686519f3029e9cbfa3e3737472f61adbd5a2d" "Other provider",1)].
[Comment] Now the ADA provider redeems the 27 ADA from the payout script.
[runContract] Instance 8d318fe5-2108-4e2f-9559-06911e09d1f7 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "AdaApp" for role "Ada provider".
[runContract] Instance 8d318fe5-2108-4e2f-9559-06911e09d1f7 received NewObservableState (Object (fromList [("contents",Array [String "1f7ec7e2-bc55-4c24-b5eb-62c5969d5209",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 8d318fe5-2108-4e2f-9559-06911e09d1f7 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The ADA provider should now have 42 ADA, but they may have paid up to 4 ADA in fees.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,40673447),(AssetId "0b3f7be53fa288407bd686519f3029e9cbfa3e3737472f61adbd5a2d" "Ada provider",1)].
[Comment] Now the other provider redeems the 30 ADA from the payout script.
[runContract] Instance 1294ef66-4808-46c0-806a-91466f02ea71 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "OtherApp" for role "Other provider".
[runContract] Instance 1294ef66-4808-46c0-806a-91466f02ea71 received NewObservableState (Object (fromList [("contents",Array [String "18409b6d-224a-4cee-b7e7-a82cf18f4aed",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 1294ef66-4808-46c0-806a-91466f02ea71 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The other provider should now have 47 ADA, but they may have paid up to 3 ADA in fees.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,45147798),(AssetId "0b3f7be53fa288407bd686519f3029e9cbfa3e3737472f61adbd5a2d" "Other provider",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 8d318fe5-2108-4e2f-9559-06911e09d1f7 received ContractFinished Nothing.
[Stop] Instance "AdaApp" stopped.
[Stop] Instance "OtherApp" stopped.
***** PASSED *****
[runContract] Instance 1294ef66-4808-46c0-806a-91466f02ea71 received ContractFinished Nothing.
