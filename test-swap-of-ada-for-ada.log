
***** Test "Swap of ADA for ADA" *****
[Comment] Create the wallet for the ADA provider, fund it with 50 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "tomato eight erase recall recycle cushion margin onion october cross motor insane screen magic smart hammer fancy museum portion average gym hen resource bundle".
[createWallet] First wallet address is addr_test1qpd6ywnxpdcyqvsg8mqvnfynlwkv7d4pa2g62zuruej3w7u560svz7jh94tqp7uxw4gyvmjgvjgx4qempgvhzn36thmqvvwmwy.
[createWallet] First public key hash is 5ba23a660b704032083ec0c9a493fbaccf36a1ea91a50b83e665177b.
[CreateWallet] Created wallet identified as c09de91fb891577ff38b4656ac2cecc8b9dffb49 for role "Ada provider".
[FundWallet] Funded wallet for role "Ada provider" with valueFromList [(AdaAssetId,50000000)].
[ActivateApp] Activated MarloweApp instance "AdaApp" with identifier fbb848cb-86b2-4443-ba1d-62b0488d35b4 for role "Ada provider".
[Comment] Create the wallet for the other provider, fund it with 40 ADA, and activate the Marlowe endpoints.
[runContract] Instance fbb848cb-86b2-4443-ba1d-62b0488d35b4 received NewObservableState Null.
[runContract] Instance fbb848cb-86b2-4443-ba1d-62b0488d35b4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance fbb848cb-86b2-4443-ba1d-62b0488d35b4 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "arrive radio spread garden present weasel list degree bitter pill gate entire bleak car solar kind famous black rent budget ask raven intact gun".
[createWallet] First wallet address is addr_test1qzqzg9m9ud9pyc2jyljny4fzn6fl34sj5m7hawhvt20y9npz99admqu4eqgpfu7s384fh4f6fqxrgxsnvar7h3x2uazsl0z4lk.
[createWallet] First public key hash is 80241765e34a12615227e53255229e93f8d612a6fd7ebaec5a9e42cc.
[CreateWallet] Created wallet identified as c24fe4722238271178f599539cdc14a89e466c00 for role "Other provider".
[FundWallet] Funded wallet for role "Other provider" with valueFromList [(AdaAssetId,40000000)].
[ActivateApp] Activated MarloweApp instance "OtherApp" with identifier c69b0dee-e4ae-4f98-bf36-2161071a88d2 for role "Other provider".
[Comment] The ADA provider creates the swap contract for 30 ADA to 25 ADA.
[CallCreate] Endpoint "create" called on instance "AdaApp" for owners [("Ada provider",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "5ba23a660b704032083ec0c9a493fbaccf36a1ea91a50b83e665177b")) (StakeRefBase (KeyHashObj (KeyHash "94d3e0c17a572d5600fb867550466e4864906a833b0a19714e3a5df6"))))),("Other provider",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "80241765e34a12615227e53255229e93f8d612a6fd7ebaec5a9e42cc")) (StakeRefBase (KeyHashObj (KeyHash "22297add8395c81014f3d089ea9bd53a480c341a136747ebc4cae745")))))].
[runContract] Instance c69b0dee-e4ae-4f98-bf36-2161071a88d2 received NewObservableState Null.
[runContract] Instance c69b0dee-e4ae-4f98-bf36-2161071a88d2 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance c69b0dee-e4ae-4f98-bf36-2161071a88d2 received NewYieldedExportTxs [].
[runContract] Instance fbb848cb-86b2-4443-ba1d-62b0488d35b4 received NewActiveEndpoints [].
[runContract] Instance fbb848cb-86b2-4443-ba1d-62b0488d35b4 received NewObservableState (Object (fromList [("contents",Array [String "4a5d4532-1d1c-43e4-a684-9a7ecb9660b3",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "8aefc88b7fda725f2bd7df8c96613ede8eb17d933687dbdde0d037a7"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "ffd80473e79426fef5de6c124369bb96a67a8b5814211009354e311e")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance fbb848cb-86b2-4443-ba1d-62b0488d35b4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wr8677v8y88degtjeuacegpujt3fa5a4zztk7m35zf7ymzgm8a4gk and role address addr_test1wz9wljyt0ld8yhet6l0ce9np8m0gavtajvmg0k7aurgr0fcfd2c00 with MarloweParams {rolePayoutValidatorHash = 8aefc88b7fda725f2bd7df8c96613ede8eb17d933687dbdde0d037a7, rolesCurrency = ffd80473e79426fef5de6c124369bb96a67a8b5814211009354e311e}.
[Comment] The ADA provider should have 46 ADA now, since 2 ADA was sent to the script when creating the contract and 2 ADA was sent to the other provider along with their role token, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,45533562),(AssetId "ffd80473e79426fef5de6c124369bb96a67a8b5814211009354e311e" "Ada provider",1)].
[Comment] The other provider should have 42 ADA.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,42000000),(AssetId "ffd80473e79426fef5de6c124369bb96a67a8b5814211009354e311e" "Other provider",1)].
[Comment] The other provider needs to followe the contract created by the ada provider.
[Follow] Instance "OtherApp" now follows instance "AdaApp".
[Comment] The ADA provider deposits their 30 ADA for the swap.
[runContract] Instance fbb848cb-86b2-4443-ba1d-62b0488d35b4 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "AdaApp" for inputs [ClientInput (IDeposit "Ada provider" "Ada provider" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance fbb848cb-86b2-4443-ba1d-62b0488d35b4 received NewObservableState (Object (fromList [("contents",Array [String "7b8c0e90-0c95-4061-9726-eb36c8439832",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance fbb848cb-86b2-4443-ba1d-62b0488d35b4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The ADA provider should have 16 ADA now, since they paid 30 ADA for the swap, minus up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,14161016),(AssetId "ffd80473e79426fef5de6c124369bb96a67a8b5814211009354e311e" "Ada provider",1)].
[Comment] The other provider deposits their 25 ADA for the swap.
[runContract] Instance c69b0dee-e4ae-4f98-bf36-2161071a88d2 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OtherApp" for inputs [ClientInput (IDeposit "Other provider" "Other provider" (Token "" "") 25000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance c69b0dee-e4ae-4f98-bf36-2161071a88d2 received NewObservableState (Object (fromList [("contents",Array [String "4897dd37-44ae-41f6-b6c1-cef2b1d0be02",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance c69b0dee-e4ae-4f98-bf36-2161071a88d2 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The other provider should have 17 ADA, since they paid 25 USD for the swap, minus up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,15652067),(AssetId "ffd80473e79426fef5de6c124369bb96a67a8b5814211009354e311e" "Other provider",1)].
[Comment] Now the ADA provider redeems the 27 ADA from the payout script.
[runContract] Instance fbb848cb-86b2-4443-ba1d-62b0488d35b4 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "AdaApp" for role "Ada provider".
[runContract] Instance fbb848cb-86b2-4443-ba1d-62b0488d35b4 received NewObservableState (Object (fromList [("contents",Array [String "abfe9d50-c94c-49c3-b2e6-cb1727f0fcb8",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance fbb848cb-86b2-4443-ba1d-62b0488d35b4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The ADA provider should now have 42 ADA, but they may have paid up to 4 ADA in fees.
[CheckFunds] Wallet for role "Ada provider" contains valueFromList [(AdaAssetId,40673447),(AssetId "ffd80473e79426fef5de6c124369bb96a67a8b5814211009354e311e" "Ada provider",1)].
[Comment] Now the other provider redeems the 30 ADA from the payout script.
[runContract] Instance c69b0dee-e4ae-4f98-bf36-2161071a88d2 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "OtherApp" for role "Other provider".
[runContract] Instance c69b0dee-e4ae-4f98-bf36-2161071a88d2 received NewObservableState (Object (fromList [("contents",Array [String "2986d7c6-0544-4463-ad71-5d2b6bb4b613",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance c69b0dee-e4ae-4f98-bf36-2161071a88d2 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The other provider should now have 47 ADA, but they may have paid up to 3 ADA in fees.
[CheckFunds] Wallet for role "Other provider" contains valueFromList [(AdaAssetId,45147798),(AssetId "ffd80473e79426fef5de6c124369bb96a67a8b5814211009354e311e" "Other provider",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance fbb848cb-86b2-4443-ba1d-62b0488d35b4 received ContractFinished Nothing.
[Stop] Instance "AdaApp" stopped.
[Stop] Instance "OtherApp" stopped.
***** PASSED *****
[runContract] Instance c69b0dee-e4ae-4f98-bf36-2161071a88d2 received ContractFinished Nothing.
