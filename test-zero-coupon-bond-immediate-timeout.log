
***** Test "Zero-Coupon Bond with Immediate Timeout" *****
[Comment] is test case closes the contract immediately after creation.
[Comment] Create the wallet for the lender, fund it with 80 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "hand hedgehog wheat attitude portion mad funny next garlic very help hole legal treat effort sunny ready credit resource ribbon dry bone pioneer reason".
[createWallet] First wallet address is addr_test1qzvysaggkfgl5q6tnn6ftx67span4gp735wgcc4zdr0fes2agmswng4ut3qmk0wsm560jn4ejff7nrkaa0jass63jngsdpdge6.
[createWallet] First public key hash is 98487508b251fa034b9cf4959b5e807b3aa03e8d1c8c62a268de9cc1.
[CreateWallet] Created wallet identified as 77db0ee7567673e6a749e78f085b096a875574e9 for role "Lender".
[FundWallet] Funded wallet for role "Lender" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance "LenderApp" with identifier 59c9c0e1-f628-40d5-b196-335ab2316e09 for role "Lender".
[Comment] Create the wallet for the borrower and fund it with 10 ADA, and activate the Marlowe endpoints.
[runContract] Instance 59c9c0e1-f628-40d5-b196-335ab2316e09 received NewObservableState Null.
[runContract] Instance 59c9c0e1-f628-40d5-b196-335ab2316e09 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 59c9c0e1-f628-40d5-b196-335ab2316e09 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "curve borrow blue peasant release material foot umbrella animal embrace drive pizza trip aunt diet struggle chicken frost short amount weird else fresh pool".
[createWallet] First wallet address is addr_test1qp83gdrkesmx9lfumwwv5pjrelj2le0p9ud5fentewc2yceqj3kz2kjfgq7pt44qd9c4rlj3wmmty6dudxxkd7gjlv2sf9z9lu.
[createWallet] First public key hash is 4f143476cc3662fd3cdb9cca0643cfe4afe5e12f1b44e66bcbb0a263.
[CreateWallet] Created wallet identified as 67154cf24a6f897e2cf4e4dad802c29b3ff8153c for role "Borrower".
[FundWallet] Funded wallet for role "Borrower" with valueFromList [(AdaAssetId,10000000)].
[ActivateApp] Activated MarloweApp instance "BorrowerApp" with identifier df86a1aa-3329-4368-994e-dda2d075a108 for role "Borrower".
[Comment] Show the contents of the wallets.
[runContract] Instance df86a1aa-3329-4368-994e-dda2d075a108 received NewObservableState Null.
[runContract] Instance df86a1aa-3329-4368-994e-dda2d075a108 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance df86a1aa-3329-4368-994e-dda2d075a108 received NewYieldedExportTxs [].
[PrintWallet] Wallet for role "Lender" contains valueFromList [(AdaAssetId,80000000)].
[PrintWallet] Wallet for role "Borrower" contains valueFromList [(AdaAssetId,10000000)].
[Comment] The lender creates the ZCB contract, which was downloaded from Marlowe Playground. The loan amount is 50 ADA and the interest amount is 3 ADA.
[CallCreate] Endpoint "create" called on instance "LenderApp" for owners [("Lender",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "98487508b251fa034b9cf4959b5e807b3aa03e8d1c8c62a268de9cc1")) (StakeRefBase (KeyHashObj (KeyHash "5d46e0e9a2bc5c41bb3dd0dd34f94eb99253e98eddebe5d8435194d1"))))),("Borrower",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "4f143476cc3662fd3cdb9cca0643cfe4afe5e12f1b44e66bcbb0a263")) (StakeRefBase (KeyHashObj (KeyHash "20946c255a49403c15d6a0697151fe5176f6b269bc698d66f912fb15")))))].
[runContract] Instance 59c9c0e1-f628-40d5-b196-335ab2316e09 received NewActiveEndpoints [].
[runContract] Instance 59c9c0e1-f628-40d5-b196-335ab2316e09 received NewObservableState (Object (fromList [("contents",Array [String "45de33ea-f944-4879-a82e-053f06382377",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "d844611742d96baa56e0f2cd31479b0ffc59489c111eb5b4d3e7269a"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "0dbede13cc9e90fd40b62f9e857171416ca868f533ae481e9519fc7a")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 59c9c0e1-f628-40d5-b196-335ab2316e09 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wq0c0q7e7cznyygte7tu6psrxrj9mmuvpsvnrwen6s0vawctaqffr and role address addr_test1wrvygcghgtvkh2jkurev6v28nv8lck2gnsg3add560njdxs3ulcld with MarloweParams {rolePayoutValidatorHash = d844611742d96baa56e0f2cd31479b0ffc59489c111eb5b4d3e7269a, rolesCurrency = 0dbede13cc9e90fd40b62f9e857171416ca868f533ae481e9519fc7a}.
[Comment] The lender should have about 76 ADA now, since 2 ADA was sent to the script address when creating the contract, 2 ADA was sent the borrower along with the role token, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Lender" contains valueFromList [(AdaAssetId,75537874),(AssetId "0dbede13cc9e90fd40b62f9e857171416ca868f533ae481e9519fc7a" "Lender",1)].
[Comment] The borrower should now have their original 10 ADA plus the 2 ADA that arrived with the role token.
[CheckFunds] Wallet for role "Borrower" contains valueFromList [(AdaAssetId,12000000),(AssetId "0dbede13cc9e90fd40b62f9e857171416ca868f533ae481e9519fc7a" "Borrower",1)].
[Comment] The borrower needs to follow this contract in order to interact with it.
[Follow] Instance "BorrowerApp" now follows instance "LenderApp".
[Comment] Since the timeout has expired, the lender closes the contract, receiving their 2 ADA back.
[runContract] Instance 59c9c0e1-f628-40d5-b196-335ab2316e09 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "LenderApp" for inputs [] and times Just (POSIXTime {getPOSIXTime = 1646094122000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 59c9c0e1-f628-40d5-b196-335ab2316e09 received NewObservableState (Object (fromList [("contents",Array [String "61dfb31c-a6e9-4564-b855-4e3013d2f7c4",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 59c9c0e1-f628-40d5-b196-335ab2316e09 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The lender now has paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Lender" contains valueFromList [(AdaAssetId,76627900),(AssetId "0dbede13cc9e90fd40b62f9e857171416ca868f533ae481e9519fc7a" "Lender",1)].
[Comment] The borrower's funds are unchanged.
[CheckFunds] Wallet for role "Borrower" contains valueFromList [(AdaAssetId,12000000),(AssetId "0dbede13cc9e90fd40b62f9e857171416ca868f533ae481e9519fc7a" "Borrower",1)].
[Comment] Return unused funds.
[ReturnFunds] Returned funds from wallet for role "Lender".
[ReturnFunds] Returned funds from wallet for role "Borrower".
[Comment] Stop the Marlowe application.
[runContract] Instance 59c9c0e1-f628-40d5-b196-335ab2316e09 received ContractFinished Nothing.
[Stop] Instance "LenderApp" stopped.
[Stop] Instance "BorrowerApp" stopped.
***** PASSED *****
