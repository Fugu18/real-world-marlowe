
***** Test "Contract for Differences with Oracle" *****
[Comment] Create the wallet for the party, fund it with 80 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "hole month kidney vote help garden bench rain tuition stock weather strong flower solid primary mansion various trust expire cover merit crucial cart noise".
[createWallet] First wallet address is addr_test1qzvucva829kqxx9lfte5l0gq8jwqffw9n0a4nrl3jqr7zer3uruuzxk8gg9ge48znet89pna9fnqz998ky625xlt42wsmwk26a.
[createWallet] First public key hash is 99cc33a7516c0318bf4af34fbd003c9c04a5c59bfb598ff19007e164.
[CreateWallet] Created wallet identified as 2aaa85a831979f72c3976964c101dc37a337d79c for role "Party".
[FundWallet] Funded wallet for role "Party" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance "PartyApp" with identifier 562a6160-f905-42f7-ade7-346c48873060 for role "Party".
[Comment] Create the wallet for the counterparty, fund it with 60 ADA, and activate the Marlowe endpoints.
[runContract] Instance 562a6160-f905-42f7-ade7-346c48873060 received NewObservableState Null.
[runContract] Instance 562a6160-f905-42f7-ade7-346c48873060 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 562a6160-f905-42f7-ade7-346c48873060 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "fee memory honey device extra stand still loop oblige sting fork cake hospital crawl cover smart token absent timber client birth slide pupil large".
[createWallet] First wallet address is addr_test1qqazv5h95ghzsllpaqevndqcc4sdzu6czvzw5jsrym80f64fmxkfrvwuae58qduw86qg0aa7ggs8hcq97mts6fysn0qsnpd3cz.
[createWallet] First public key hash is 3a2652e5a22e287fe1e832c9b418c560d173581304ea4a0326cef4ea.
[CreateWallet] Created wallet identified as e0967fee88cfc043617dcf52f3b14b892756e813 for role "Counterparty".
[FundWallet] Funded wallet for role "Counterparty" with valueFromList [(AdaAssetId,60000000)].
[ActivateApp] Activated MarloweApp instance "CounterpartyApp" with identifier e73d08b6-1f6c-4fe3-8912-d1f23037280c for role "Counterparty".
[Comment] Create the wallet for the oracle, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance e73d08b6-1f6c-4fe3-8912-d1f23037280c received NewObservableState Null.
[runContract] Instance e73d08b6-1f6c-4fe3-8912-d1f23037280c received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance e73d08b6-1f6c-4fe3-8912-d1f23037280c received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "coach fall merit wreck recall clay wrist army language target couple state lunar dose tube rookie puzzle axis tilt grain remind believe mixture capital".
[createWallet] First wallet address is addr_test1qqsedyuqkt8x3ppwstltep498jj3jqu0jpz7nvg3yy4k6sc0ef73m0rn6etprdh9u82su5ksfxttzhrmk3mudqzqvaps5gml72.
[createWallet] First public key hash is 21969380b2ce68842e82febc86a53ca519038f9045e9b111212b6d43.
[CreateWallet] Created wallet identified as 038c14204a33b8a47af9f93d457617ca9e5758d6 for role "Oracle".
[FundWallet] Funded wallet for role "Oracle" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance "OracleApp" with identifier 0f2c7936-28bd-462c-81af-19e8beac9122 for role "Oracle".
[Comment] The oracle creates the contract with differences, which was downloaded from Marlowe Playground. The party deposits 20 ADA to cover the margin collateral and the counterparty deposits 30 ADA.
[runContract] Instance 0f2c7936-28bd-462c-81af-19e8beac9122 received NewObservableState Null.
[runContract] Instance 0f2c7936-28bd-462c-81af-19e8beac9122 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 0f2c7936-28bd-462c-81af-19e8beac9122 received NewYieldedExportTxs [].
[CallCreate] Endpoint "create" called on instance "OracleApp" for owners [("Party",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "99cc33a7516c0318bf4af34fbd003c9c04a5c59bfb598ff19007e164")) (StakeRefBase (KeyHashObj (KeyHash "71e0f9c11ac7420a8cd4e29e5672867d2a660114a7b134aa1bebaa9d"))))),("Counterparty",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "3a2652e5a22e287fe1e832c9b418c560d173581304ea4a0326cef4ea")) (StakeRefBase (KeyHashObj (KeyHash "a9d9ac91b1dcee6870378e3e8087f7be42207be005f6d70d24909bc1"))))),("Oracle",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "21969380b2ce68842e82febc86a53ca519038f9045e9b111212b6d43")) (StakeRefBase (KeyHashObj (KeyHash "0fca7d1dbc73d65611b6e5e1d50e52d04996b15c7bb477c680406743")))))].
[runContract] Instance 0f2c7936-28bd-462c-81af-19e8beac9122 received NewActiveEndpoints [].
[runContract] Instance 0f2c7936-28bd-462c-81af-19e8beac9122 received NewObservableState (Object (fromList [("contents",Array [String "d68bc222-b9a9-44b7-9551-2573cc16bf26",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "cabfbdb08e75b36b9c4c0419246e06a463671958816577ef47e96af8"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "1ff1bfd025ba149ba663db5ea20483ff8f847765f94aeb3d76a40bea")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 0f2c7936-28bd-462c-81af-19e8beac9122 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wq0ve3v8llukvdldv2xxt3u3qmj5jj5ty3amettu9yjhneqna8gld and role address addr_test1wr9tl0ds3e6mx6uufszpjfrwq6jxxecetzqk2al0gl5k47qxtzwz2 with MarloweParams {rolePayoutValidatorHash = cabfbdb08e75b36b9c4c0419246e06a463671958816577ef47e96af8, rolesCurrency = 1ff1bfd025ba149ba663db5ea20483ff8f847765f94aeb3d76a40bea}.
[Comment] The oracle should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the party and counterparty along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,13443061),(AssetId "1ff1bfd025ba149ba663db5ea20483ff8f847765f94aeb3d76a40bea" "Oracle",1)].
[Comment] The party and counterpary should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,82000000),(AssetId "1ff1bfd025ba149ba663db5ea20483ff8f847765f94aeb3d76a40bea" "Party",1)].
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,62000000),(AssetId "1ff1bfd025ba149ba663db5ea20483ff8f847765f94aeb3d76a40bea" "Counterparty",1)].
[Comment] The party and counterparty each need to follow the contract created by the mediator.
[Follow] Instance "PartyApp" now follows instance "OracleApp".
[Follow] Instance "CounterpartyApp" now follows instance "OracleApp".
[Comment] The party deposits their 20 ADA margin.
[runContract] Instance 562a6160-f905-42f7-ade7-346c48873060 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "PartyApp" for inputs [ClientInput (IDeposit "Party" "Party" (Token "" "") 20000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 562a6160-f905-42f7-ade7-346c48873060 received NewObservableState (Object (fromList [("contents",Array [String "d50c0177-e4cf-4c1c-9914-d15643211c78",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 562a6160-f905-42f7-ade7-346c48873060 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The party should have about 62 ADA now, since they paid 20 ADA for the margin, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,60616335),(AssetId "1ff1bfd025ba149ba663db5ea20483ff8f847765f94aeb3d76a40bea" "Party",1)].
[Comment] The counterparty deposits their 30 ADA margin.
[runContract] Instance e73d08b6-1f6c-4fe3-8912-d1f23037280c received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "CounterpartyApp" for inputs [ClientInput (IDeposit "Counterparty" "Counterparty" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance e73d08b6-1f6c-4fe3-8912-d1f23037280c received NewObservableState (Object (fromList [("contents",Array [String "bceb9db5-a22f-4a1d-aeff-064fb3dc359f",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance e73d08b6-1f6c-4fe3-8912-d1f23037280c received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The counterparty should have about 32 ADA now, since they paid 30 ADA for the margin purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,30649389),(AssetId "1ff1bfd025ba149ba663db5ea20483ff8f847765f94aeb3d76a40bea" "Counterparty",1)].
[Comment] The oracle reports that the price is 1.2 ADA/USD in the first window.
[runContract] Instance 0f2c7936-28bd-462c-81af-19e8beac9122 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OracleApp" for inputs [ClientInput (IChoice (ChoiceId "ADA/USD" "Oracle") 1200000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 0f2c7936-28bd-462c-81af-19e8beac9122 received NewObservableState (Object (fromList [("contents",Array [String "1f3f199b-1f6e-475a-b654-13562c89176a",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 0f2c7936-28bd-462c-81af-19e8beac9122 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should still have 14 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12024398),(AssetId "1ff1bfd025ba149ba663db5ea20483ff8f847765f94aeb3d76a40bea" "Oracle",1)].
[Comment] The oracle reports that the price is 0.700000 USD/ADA in the second window.
[WaitFor] Waited for 12000 milliseconds.
[runContract] Instance 0f2c7936-28bd-462c-81af-19e8beac9122 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OracleApp" for inputs [ClientInput (IChoice (ChoiceId "USD/ADA" "Oracle") 700000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 0f2c7936-28bd-462c-81af-19e8beac9122 received NewObservableState (Object (fromList [("contents",Array [String "62dfc216-213f-44d1-9d5e-e6fea13d4726",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 0f2c7936-28bd-462c-81af-19e8beac9122 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should have 16 ADA now because they received their original min-ADA deposit back, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12304312),(AssetId "1ff1bfd025ba149ba663db5ea20483ff8f847765f94aeb3d76a40bea" "Oracle",1)].
[Comment] Now the party redeems from the payout script their 36 ADA, margin plus profit.
[runContract] Instance 562a6160-f905-42f7-ade7-346c48873060 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "PartyApp" for role "Party".
[runContract] Instance 562a6160-f905-42f7-ade7-346c48873060 received NewObservableState (Object (fromList [("contents",Array [String "d23579c7-0617-4966-9ecc-df7487cef687",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[AwaitRedeem] Redemption confirmed.
[runContract] Instance 562a6160-f905-42f7-ade7-346c48873060 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[Comment] The party should now have 98 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,96193542),(AssetId "1ff1bfd025ba149ba663db5ea20483ff8f847765f94aeb3d76a40bea" "Party",1)].
[Comment] Now the counterparty redeems their remaining 14 ADA margin from the payout script.
[runContract] Instance e73d08b6-1f6c-4fe3-8912-d1f23037280c received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "CounterpartyApp" for role "Counterparty".
[runContract] Instance e73d08b6-1f6c-4fe3-8912-d1f23037280c received NewObservableState (Object (fromList [("contents",Array [String "5cc9f430-ae1e-4daa-bae2-9c97e795e3eb",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance e73d08b6-1f6c-4fe3-8912-d1f23037280c received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The counterparty should now have 46 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,44230424),(AssetId "1ff1bfd025ba149ba663db5ea20483ff8f847765f94aeb3d76a40bea" "Counterparty",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 562a6160-f905-42f7-ade7-346c48873060 received ContractFinished Nothing.
[Stop] Instance "PartyApp" stopped.
[Stop] Instance "CounterpartyApp" stopped.
[runContract] Instance e73d08b6-1f6c-4fe3-8912-d1f23037280c received ContractFinished Nothing.
[Stop] Instance "OracleApp" stopped.
***** PASSED *****
[runContract] Instance 0f2c7936-28bd-462c-81af-19e8beac9122 received ContractFinished Nothing.
