
***** Test "Contract for Differences with Oracle" *****
[Comment] Create the wallet for the party, fund it with 80 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "situate start hotel manual debate police candy quote large faith permit learn pond unable essence spot gorilla toward fury monster feel dad where report".
[createWallet] First wallet address is addr_test1qzjg5hthpgmhkf70ueswq57p48yavg7jh3tpa4hmxrau420wsu68j26lc2twqneq4sx5f5qerpjasftscs8hq4weqajsswxjp5.
[createWallet] First public key hash is a48a5d770a377b27cfe660e053c1a9c9d623d2bc561ed6fb30fbcaa9.
[CreateWallet] Created wallet identified as 73fd23ce8e86d7fb062e09cffa0960bc4c10ec69 for role "Party".
[FundWallet] Funded wallet for role "Party" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance "PartyApp" with identifier 308c6fcf-8324-4df7-9994-e33092a943d4 for role "Party".
[Comment] Create the wallet for the counterparty, fund it with 60 ADA, and activate the Marlowe endpoints.
[runContract] Instance 308c6fcf-8324-4df7-9994-e33092a943d4 received NewObservableState Null.
[runContract] Instance 308c6fcf-8324-4df7-9994-e33092a943d4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 308c6fcf-8324-4df7-9994-e33092a943d4 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "century retreat van liquid panel essay excess tooth danger list dream lake spare undo pride ridge funny inquiry auto moon extend swear nose wasp".
[createWallet] First wallet address is addr_test1qquyhfghef4tnnswlnf889l9sr9ljahayv67fy5nyjcaspxq74hs49yryhlcrk6yskky2ngjeldqcwzulsw42z3we7jqz664we.
[createWallet] First public key hash is 384ba517ca6ab9ce0efcd27397e580cbf976fd2335e4929324b1d804.
[CreateWallet] Created wallet identified as 7c0c973203a865ffcb239ccd1d62d2e7e4af2ddb for role "Counterparty".
[FundWallet] Funded wallet for role "Counterparty" with valueFromList [(AdaAssetId,60000000)].
[ActivateApp] Activated MarloweApp instance "CounterpartyApp" with identifier 3f0111d5-5ab0-4be3-beaa-22dafd0f01ce for role "Counterparty".
[Comment] Create the wallet for the oracle, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance 3f0111d5-5ab0-4be3-beaa-22dafd0f01ce received NewObservableState Null.
[runContract] Instance 3f0111d5-5ab0-4be3-beaa-22dafd0f01ce received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 3f0111d5-5ab0-4be3-beaa-22dafd0f01ce received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "trial arrive turkey battle produce figure quote vote dog hat track liar spider civil regret witness movie daring dice penalty kangaroo give cloud equip".
[createWallet] First wallet address is addr_test1qrj26q6ysvepa4ag2r57c88xekd7zpev99cjruk9axc2apdquxcgjcwhyp0eex9e84r09txexmktkjh5yjhv22s6u6uqga3vjt.
[createWallet] First public key hash is e4ad034483321ed7a850e9ec1ce6cd9be1072c297121f2c5e9b0ae85.
[CreateWallet] Created wallet identified as f7bd2bbbc66c35d3157669e7c9752a7b0e49526b for role "Oracle".
[FundWallet] Funded wallet for role "Oracle" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance "OracleApp" with identifier 66f5bd1e-c2a4-4646-bf7c-f9c5463a4ee1 for role "Oracle".
[Comment] The oracle creates the contract with differences, which was downloaded from Marlowe Playground. The party deposits 20 ADA to cover the margin collateral and the counterparty deposits 30 ADA.
[CallCreate] Endpoint "create" called on instance "OracleApp" for owners [("Party",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "a48a5d770a377b27cfe660e053c1a9c9d623d2bc561ed6fb30fbcaa9")) (StakeRefBase (KeyHashObj (KeyHash "ee8734792b5fc296e04f20ac0d44d0191865d82570c40f7055d90765"))))),("Counterparty",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "384ba517ca6ab9ce0efcd27397e580cbf976fd2335e4929324b1d804")) (StakeRefBase (KeyHashObj (KeyHash "c0f56f0a948325ff81db4485ac454d12cfda0c385cfc1d550a2ecfa4"))))),("Oracle",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "e4ad034483321ed7a850e9ec1ce6cd9be1072c297121f2c5e9b0ae85")) (StakeRefBase (KeyHashObj (KeyHash "a0e1b08961d7205f9c98b93d46f2acd936ecbb4af424aec52a1ae6b8")))))].
[runContract] Instance 66f5bd1e-c2a4-4646-bf7c-f9c5463a4ee1 received NewObservableState Null.
[runContract] Instance 66f5bd1e-c2a4-4646-bf7c-f9c5463a4ee1 received NewActiveEndpoints [].
[runContract] Instance 66f5bd1e-c2a4-4646-bf7c-f9c5463a4ee1 received NewYieldedExportTxs [].
[runContract] Instance 66f5bd1e-c2a4-4646-bf7c-f9c5463a4ee1 received NewObservableState (Object (fromList [("contents",Array [String "e592f5fe-09ef-45a7-b130-d05a42422cff",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "c1b515f0568700eaaab052478fdda7a678c169b9044f3a1172787925"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "83c9a9e80ef5bd85d8aacf61d866adb06caf7570fca908c1b6bcfc00")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 66f5bd1e-c2a4-4646-bf7c-f9c5463a4ee1 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wq0rcmlhzezu3usg6nhle9d50gqpm5dtwm6sh8m4z62mvag6kpy0j and role address addr_test1wrqm290s26rsp642kpfy0r7a57n83stfhyzy7ws3wfu8jfggfpxx8 with MarloweParams {rolePayoutValidatorHash = c1b515f0568700eaaab052478fdda7a678c169b9044f3a1172787925, rolesCurrency = 83c9a9e80ef5bd85d8aacf61d866adb06caf7570fca908c1b6bcfc00}.
[Comment] The oracle should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the party and counterparty along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,13443061),(AssetId "83c9a9e80ef5bd85d8aacf61d866adb06caf7570fca908c1b6bcfc00" "Oracle",1)].
[Comment] The party and counterpary should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,82000000),(AssetId "83c9a9e80ef5bd85d8aacf61d866adb06caf7570fca908c1b6bcfc00" "Party",1)].
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,62000000),(AssetId "83c9a9e80ef5bd85d8aacf61d866adb06caf7570fca908c1b6bcfc00" "Counterparty",1)].
[Comment] The party and counterparty each need to follow the contract created by the mediator.
[Follow] Instance "PartyApp" now follows instance "OracleApp".
[Follow] Instance "CounterpartyApp" now follows instance "OracleApp".
[Comment] The party deposits their 20 ADA margin.
[runContract] Instance 308c6fcf-8324-4df7-9994-e33092a943d4 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "PartyApp" for inputs [ClientInput (IDeposit "Party" "Party" (Token "" "") 20000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 308c6fcf-8324-4df7-9994-e33092a943d4 received NewObservableState (Object (fromList [("contents",Array [String "5a77886c-60dd-4328-8556-69a34f16d3a3",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 308c6fcf-8324-4df7-9994-e33092a943d4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The party should have about 62 ADA now, since they paid 20 ADA for the margin, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,60532091),(AssetId "83c9a9e80ef5bd85d8aacf61d866adb06caf7570fca908c1b6bcfc00" "Party",1)].
[Comment] The counterparty deposits their 30 ADA margin.
[runContract] Instance 3f0111d5-5ab0-4be3-beaa-22dafd0f01ce received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "CounterpartyApp" for inputs [ClientInput (IDeposit "Counterparty" "Counterparty" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 3f0111d5-5ab0-4be3-beaa-22dafd0f01ce received NewObservableState (Object (fromList [("contents",Array [String "2269c727-ced9-4163-b893-7973927d7044",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 3f0111d5-5ab0-4be3-beaa-22dafd0f01ce received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The counterparty should have about 32 ADA now, since they paid 30 ADA for the margin purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,30559111),(AssetId "83c9a9e80ef5bd85d8aacf61d866adb06caf7570fca908c1b6bcfc00" "Counterparty",1)].
[Comment] The oracle reports that the price is 1.2 ADA/USD in the first window.
[runContract] Instance 66f5bd1e-c2a4-4646-bf7c-f9c5463a4ee1 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OracleApp" for inputs [ClientInput (IChoice (ChoiceId "ADA/USD" "Oracle") 1200000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 66f5bd1e-c2a4-4646-bf7c-f9c5463a4ee1 received NewObservableState (Object (fromList [("contents",Array [String "d34d0a6d-3b03-40fc-8d98-4d66752b9fc0",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 66f5bd1e-c2a4-4646-bf7c-f9c5463a4ee1 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should still have 14 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,11860962),(AssetId "83c9a9e80ef5bd85d8aacf61d866adb06caf7570fca908c1b6bcfc00" "Oracle",1)].
[Comment] The oracle reports that the price is 0.700000 USD/ADA in the second window.
[WaitFor] Waited for 12000 milliseconds.
[runContract] Instance 66f5bd1e-c2a4-4646-bf7c-f9c5463a4ee1 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OracleApp" for inputs [ClientInput (IChoice (ChoiceId "USD/ADA" "Oracle") 700000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 66f5bd1e-c2a4-4646-bf7c-f9c5463a4ee1 received NewObservableState (Object (fromList [("contents",Array [String "b340e841-db68-464e-b616-af4bc7257d4b",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 66f5bd1e-c2a4-4646-bf7c-f9c5463a4ee1 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should have 16 ADA now because they received their original min-ADA deposit back, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12103600),(AssetId "83c9a9e80ef5bd85d8aacf61d866adb06caf7570fca908c1b6bcfc00" "Oracle",1)].
[Comment] Now the party redeems from the payout script their 36 ADA, margin plus profit.
[runContract] Instance 308c6fcf-8324-4df7-9994-e33092a943d4 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "PartyApp" for role "Party".
[runContract] Instance 308c6fcf-8324-4df7-9994-e33092a943d4 received NewObservableState (Object (fromList [("contents",Array [String "ca063525-3a9e-4c2b-b790-fb7a9c432dde",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 308c6fcf-8324-4df7-9994-e33092a943d4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The party should now have 98 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,96109298),(AssetId "83c9a9e80ef5bd85d8aacf61d866adb06caf7570fca908c1b6bcfc00" "Party",1)].
[Comment] Now the counterparty redeems their remaining 14 ADA margin from the payout script.
[runContract] Instance 3f0111d5-5ab0-4be3-beaa-22dafd0f01ce received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "CounterpartyApp" for role "Counterparty".
[runContract] Instance 3f0111d5-5ab0-4be3-beaa-22dafd0f01ce received NewObservableState (Object (fromList [("contents",Array [String "25f895e4-ba6e-4a15-82b2-79cf4bb56a9c",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 3f0111d5-5ab0-4be3-beaa-22dafd0f01ce received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The counterparty should now have 46 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,44134341),(AssetId "83c9a9e80ef5bd85d8aacf61d866adb06caf7570fca908c1b6bcfc00" "Counterparty",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 308c6fcf-8324-4df7-9994-e33092a943d4 received ContractFinished Nothing.
[Stop] Instance "PartyApp" stopped.
[Stop] Instance "CounterpartyApp" stopped.
[runContract] Instance 3f0111d5-5ab0-4be3-beaa-22dafd0f01ce received ContractFinished Nothing.
[Stop] Instance "OracleApp" stopped.
[runContract] Instance 66f5bd1e-c2a4-4646-bf7c-f9c5463a4ee1 received ContractFinished Nothing.
***** PASSED *****
