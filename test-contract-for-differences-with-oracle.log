
***** Test "Contract for Differences with Oracle" *****
[Comment] Create the wallet for the party, fund it with 80 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "slot bomb unfold fox stone crystal build cake icon office bundle ridge divorce mean setup crunch artwork episode doll kid arrive use inform unfair".
[createWallet] First wallet address is addr_test1qrzm7x4x25exj7hckgazpw92nwra2erl2gpjeh7mugnc24m4etx6xh48c799mpawjm8pgfmknntwpruyqhfulqgjalasaged4l.
[createWallet] First public key hash is c5bf1aa65532697af8b23a20b8aa9b87d5647f52032cdfdbe2278557.
[CreateWallet] Created wallet identified as 4e6556fbe8ca14c9ecebc42a0b74013c0c6097e6 for role "Party".
[FundWallet] Funded wallet for role "Party" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance "PartyApp" with identifier 21afdf00-9472-467b-9224-86fe28725c74 for role "Party".
[Comment] Create the wallet for the counterparty, fund it with 60 ADA, and activate the Marlowe endpoints.
[runContract] Instance 21afdf00-9472-467b-9224-86fe28725c74 received NewObservableState Null.
[runContract] Instance 21afdf00-9472-467b-9224-86fe28725c74 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 21afdf00-9472-467b-9224-86fe28725c74 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "rack visa session winter try clap just giraffe love focus rate angle renew million rapid pass remove swift little crisp food meadow label tonight".
[createWallet] First wallet address is addr_test1qr8h9ak9yhduq70z46lf7wtz4v5jldhehlxzhd824flmslvgfd58w32cej32jx6gfq7tqj7aqx8fdh4zxfr2mehanw0qw5hu7f.
[createWallet] First public key hash is cf72f6c525dbc079e2aebe9f3962ab292fb6f9bfcc2bb4eaaa7fb87d.
[CreateWallet] Created wallet identified as 3d0bfcd501491c4b2fb97f21c05afe82996de13e for role "Counterparty".
[FundWallet] Funded wallet for role "Counterparty" with valueFromList [(AdaAssetId,60000000)].
[ActivateApp] Activated MarloweApp instance "CounterpartyApp" with identifier 4f4b2678-b2e4-4c6c-836d-79650a5fef39 for role "Counterparty".
[Comment] Create the wallet for the oracle, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance 4f4b2678-b2e4-4c6c-836d-79650a5fef39 received NewObservableState Null.
[runContract] Instance 4f4b2678-b2e4-4c6c-836d-79650a5fef39 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 4f4b2678-b2e4-4c6c-836d-79650a5fef39 received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "wise tomorrow worry area toilet fit oval rice text asset sponsor often avoid badge cradle tree kangaroo razor shy stool drastic beyond emerge chef".
[createWallet] First wallet address is addr_test1qz8w0p3srkpfss23mh424p0z5kprqlqjezzjdm8vwgzr3kqv7296ns6g4j5204l4d682zgxqflkzwfdjskfr3unmktqq286ng2.
[createWallet] First public key hash is 8ee786301d82984151ddeaaa85e2a582307c12c88526ecec720438d8.
[CreateWallet] Created wallet identified as bfdff8d5b2588e5ccb99f6693a9f565ae12a4ae3 for role "Oracle".
[FundWallet] Funded wallet for role "Oracle" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance "OracleApp" with identifier 9fd6f34b-2979-4200-aa20-0d1885061025 for role "Oracle".
[Comment] The oracle creates the contract with differences, which was downloaded from Marlowe Playground. The party deposits 20 ADA to cover the margin collateral and the counterparty deposits 30 ADA.
[CallCreate] Endpoint "create" called on instance "OracleApp" for owners [("Party",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "c5bf1aa65532697af8b23a20b8aa9b87d5647f52032cdfdbe2278557")) (StakeRefBase (KeyHashObj (KeyHash "75cacda35ea7c78a5d87ae96ce1427769cd6e08f8405d3cf8112effb"))))),("Counterparty",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "cf72f6c525dbc079e2aebe9f3962ab292fb6f9bfcc2bb4eaaa7fb87d")) (StakeRefBase (KeyHashObj (KeyHash "884b68774558cca2a91b48483cb04bdd018e96dea23246ade6fd9b9e"))))),("Oracle",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "8ee786301d82984151ddeaaa85e2a582307c12c88526ecec720438d8")) (StakeRefBase (KeyHashObj (KeyHash "0cf28ba9c348aca8a7d7f56e8ea120c04fec2725b2859238f27bb2c0")))))].
[runContract] Instance 9fd6f34b-2979-4200-aa20-0d1885061025 received NewObservableState Null.
[runContract] Instance 9fd6f34b-2979-4200-aa20-0d1885061025 received NewActiveEndpoints [].
[runContract] Instance 9fd6f34b-2979-4200-aa20-0d1885061025 received NewYieldedExportTxs [].
[runContract] Instance 9fd6f34b-2979-4200-aa20-0d1885061025 received NewObservableState (Object (fromList [("contents",Array [String "388aa9de-9ffd-4510-9b9c-58e45dbeb367",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "e9dea7e4a7adcd7a503efe9a6b641015ed56fbe6f80d3f2e0e2ab97d"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "8dd4049315688fae9d7c1dcd5efb85a76e2f4e018350920d12d72339")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 9fd6f34b-2979-4200-aa20-0d1885061025 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wplr65kadnv5x3gnxy6xuhfzm0vhxmrunhx223mplsvsc9gp00fd3 and role address addr_test1wr5aafly57ku67js8mlf56myzq2764hmumuq60ewpc4tjlgg7j9ha with MarloweParams {rolePayoutValidatorHash = e9dea7e4a7adcd7a503efe9a6b641015ed56fbe6f80d3f2e0e2ab97d, rolesCurrency = 8dd4049315688fae9d7c1dcd5efb85a76e2f4e018350920d12d72339}.
[Comment] The oracle should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the party and counterparty along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,13443061),(AssetId "8dd4049315688fae9d7c1dcd5efb85a76e2f4e018350920d12d72339" "Oracle",1)].
[Comment] The party and counterpary should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,82000000),(AssetId "8dd4049315688fae9d7c1dcd5efb85a76e2f4e018350920d12d72339" "Party",1)].
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,62000000),(AssetId "8dd4049315688fae9d7c1dcd5efb85a76e2f4e018350920d12d72339" "Counterparty",1)].
[Comment] The party and counterparty each need to follow the contract created by the mediator.
[Follow] Instance "PartyApp" now follows instance "OracleApp".
[Follow] Instance "CounterpartyApp" now follows instance "OracleApp".
[Comment] The party deposits their 20 ADA margin.
[runContract] Instance 21afdf00-9472-467b-9224-86fe28725c74 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "PartyApp" for inputs [ClientInput (IDeposit "Party" "Party" (Token "" "") 20000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 21afdf00-9472-467b-9224-86fe28725c74 received NewObservableState (Object (fromList [("contents",Array [String "a06660e5-cd3d-4029-a4dc-6a9589a0a05b",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 21afdf00-9472-467b-9224-86fe28725c74 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The party should have about 62 ADA now, since they paid 20 ADA for the margin, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,60527894),(AssetId "8dd4049315688fae9d7c1dcd5efb85a76e2f4e018350920d12d72339" "Party",1)].
[Comment] The counterparty deposits their 30 ADA margin.
[runContract] Instance 4f4b2678-b2e4-4c6c-836d-79650a5fef39 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "CounterpartyApp" for inputs [ClientInput (IDeposit "Counterparty" "Counterparty" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 4f4b2678-b2e4-4c6c-836d-79650a5fef39 received NewObservableState (Object (fromList [("contents",Array [String "838d89bf-3871-4ab6-9e31-d4bc2e00d9db",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 4f4b2678-b2e4-4c6c-836d-79650a5fef39 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The counterparty should have about 32 ADA now, since they paid 30 ADA for the margin purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,30559287),(AssetId "8dd4049315688fae9d7c1dcd5efb85a76e2f4e018350920d12d72339" "Counterparty",1)].
[Comment] The oracle reports that the price is 1.2 ADA/USD in the first window.
[runContract] Instance 9fd6f34b-2979-4200-aa20-0d1885061025 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OracleApp" for inputs [ClientInput (IChoice (ChoiceId "ADA/USD" "Oracle") 1200000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 9fd6f34b-2979-4200-aa20-0d1885061025 received NewObservableState (Object (fromList [("contents",Array [String "61ea5999-13d7-4bdf-86d8-34a16117bd6c",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 9fd6f34b-2979-4200-aa20-0d1885061025 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should still have 14 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,11855302),(AssetId "8dd4049315688fae9d7c1dcd5efb85a76e2f4e018350920d12d72339" "Oracle",1)].
[Comment] The oracle reports that the price is 0.700000 USD/ADA in the second window.
[WaitFor] Waited for 12000 milliseconds.
[runContract] Instance 9fd6f34b-2979-4200-aa20-0d1885061025 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OracleApp" for inputs [ClientInput (IChoice (ChoiceId "USD/ADA" "Oracle") 700000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 9fd6f34b-2979-4200-aa20-0d1885061025 received NewObservableState (Object (fromList [("contents",Array [String "17f13422-65b5-4b6d-98fe-f127de82d5d0",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 9fd6f34b-2979-4200-aa20-0d1885061025 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should have 16 ADA now because they received their original min-ADA deposit back, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12098116),(AssetId "8dd4049315688fae9d7c1dcd5efb85a76e2f4e018350920d12d72339" "Oracle",1)].
[Comment] Now the party redeems from the payout script their 36 ADA, margin plus profit.
[runContract] Instance 21afdf00-9472-467b-9224-86fe28725c74 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "PartyApp" for role "Party".
[runContract] Instance 21afdf00-9472-467b-9224-86fe28725c74 received NewObservableState (Object (fromList [("contents",Array [String "1004cb6c-ae06-45f7-a00d-be1e9946a556",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 21afdf00-9472-467b-9224-86fe28725c74 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The party should now have 98 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,96081169),(AssetId "8dd4049315688fae9d7c1dcd5efb85a76e2f4e018350920d12d72339" "Party",1)].
[Comment] Now the counterparty redeems their remaining 14 ADA margin from the payout script.
[runContract] Instance 4f4b2678-b2e4-4c6c-836d-79650a5fef39 received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "CounterpartyApp" for role "Counterparty".
[runContract] Instance 4f4b2678-b2e4-4c6c-836d-79650a5fef39 received NewObservableState (Object (fromList [("contents",Array [String "69b48691-6257-4f11-8a60-ca36059fd425",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 4f4b2678-b2e4-4c6c-836d-79650a5fef39 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The counterparty should now have 46 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,44111946),(AssetId "8dd4049315688fae9d7c1dcd5efb85a76e2f4e018350920d12d72339" "Counterparty",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 21afdf00-9472-467b-9224-86fe28725c74 received ContractFinished Nothing.
[Stop] Instance "PartyApp" stopped.
[Stop] Instance "CounterpartyApp" stopped.
[runContract] Instance 4f4b2678-b2e4-4c6c-836d-79650a5fef39 received ContractFinished Nothing.
[Stop] Instance "OracleApp" stopped.
***** PASSED *****
