
***** Test "Contract for Differences with Oracle" *****
[Comment] Create the wallet for the party, fund it with 80 ADA, and activate the Marlowe endpoints.
[createWallet] Mnemonic sentence is "happy floor live absurd forest easily between illness keen tent deposit undo loud husband pull zone fade subject vague wage they sample blind pumpkin".
[createWallet] First wallet address is addr_test1qr0wnvaknxz8g8ww9gajy542vavnqpz6kuae3gm0lr35w4ay4nfvz6rlylvzm6lsx4nse5ha99euqhy3v62ya9rk5gyq9k53qs.
[createWallet] First public key hash is dee9b3b69984741dce2a3b2252aa675930045ab73b98a36ff8e34757.
[CreateWallet] Created wallet identified as f2130780c560de7464d2a86835e56e18e26aa979 for role "Party".
[FundWallet] Funded wallet for role "Party" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance "PartyApp" with identifier 44a1fca5-425b-47be-bd42-ea6663cfe63a for role "Party".
[Comment] Create the wallet for the counterparty, fund it with 60 ADA, and activate the Marlowe endpoints.
[runContract] Instance 44a1fca5-425b-47be-bd42-ea6663cfe63a received NewObservableState Null.
[runContract] Instance 44a1fca5-425b-47be-bd42-ea6663cfe63a received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 44a1fca5-425b-47be-bd42-ea6663cfe63a received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "glad tenant crash pistol upgrade person announce usage laptop goose rule apology hunt cash retire because sure ethics client toy dove insane record across".
[createWallet] First wallet address is addr_test1qqhqejauljh9hzm5375uz0melcava6c7p0szyq4mse2e4vl5thcz9tqmwqakz9swf0gmeqq7h6fuwyp4sfj7y8cc7fkqjn487p.
[createWallet] First public key hash is 2e0ccbbcfcae5b8b748fa9c13f79fe3aceeb1e0be02202bb86559ab3.
[CreateWallet] Created wallet identified as 20ac4ca7d9f97d8608c76c777016e7530f56dd3d for role "Counterparty".
[FundWallet] Funded wallet for role "Counterparty" with valueFromList [(AdaAssetId,60000000)].
[ActivateApp] Activated MarloweApp instance "CounterpartyApp" with identifier c9230d46-43be-4d6a-af23-525ef4376b0a for role "Counterparty".
[Comment] Create the wallet for the oracle, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance c9230d46-43be-4d6a-af23-525ef4376b0a received NewObservableState Null.
[runContract] Instance c9230d46-43be-4d6a-af23-525ef4376b0a received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance c9230d46-43be-4d6a-af23-525ef4376b0a received NewYieldedExportTxs [].
[createWallet] Mnemonic sentence is "doll marriage couple frame combine inspire pair concert employ aspect silent cost wise almost badge anxiety omit wrap equal leopard inflict cave cover excite".
[createWallet] First wallet address is addr_test1qqk6xe49h30lqvt7agcscpxwq3wkd45fey63d8u5u8l3wqvtltyx8lxnn93xtf295x9fu0xujcv4p6cdzj6jzw2q97rs52c6ph.
[createWallet] First public key hash is 2da366a5bc5ff0317eea310c04ce045d66d689c935169f94e1ff1701.
[CreateWallet] Created wallet identified as 33765a5479552d5150df61065efb9dde01c1e646 for role "Oracle".
[FundWallet] Funded wallet for role "Oracle" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance "OracleApp" with identifier 185b36e4-e732-41fc-8a79-97fc39646870 for role "Oracle".
[Comment] The oracle creates the contract with differences, which was downloaded from Marlowe Playground. The party deposits 20 ADA to cover the margin collateral and the counterparty deposits 30 ADA.
[CallCreate] Endpoint "create" called on instance "OracleApp" for owners [("Party",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "dee9b3b69984741dce2a3b2252aa675930045ab73b98a36ff8e34757")) (StakeRefBase (KeyHashObj (KeyHash "a4acd2c1687f27d82debf035670cd2fd2973c05c9166944e9476a208"))))),("Counterparty",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "2e0ccbbcfcae5b8b748fa9c13f79fe3aceeb1e0be02202bb86559ab3")) (StakeRefBase (KeyHashObj (KeyHash "f45df022ac1b703b61160e4bd1bc801ebe93c710358265e21f18f26c"))))),("Oracle",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "2da366a5bc5ff0317eea310c04ce045d66d689c935169f94e1ff1701")) (StakeRefBase (KeyHashObj (KeyHash "8bfac863fcd3996265a545a18a9e3cdc961950eb0d14b52139402f87")))))].
[runContract] Instance 185b36e4-e732-41fc-8a79-97fc39646870 received NewObservableState Null.
[runContract] Instance 185b36e4-e732-41fc-8a79-97fc39646870 received NewActiveEndpoints [].
[runContract] Instance 185b36e4-e732-41fc-8a79-97fc39646870 received NewYieldedExportTxs [].
[runContract] Instance 185b36e4-e732-41fc-8a79-97fc39646870 received NewObservableState (Object (fromList [("contents",Array [String "d26375d3-556e-41b3-84c4-83d17d4e38a1",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "0efee86ca0f5648110f9288f58d70f4e3aec87982d49a9225b04f912"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "ac2f14b1644c544f08a6e20ae799e0618b119b3b618d090ac1346c8d")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 185b36e4-e732-41fc-8a79-97fc39646870 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed for app address addr_test1wz4eeq94fmp7txyy85y4pkr536n0dmpnlnvt6hrnmarhxqqnjzm0p and role address addr_test1wq80a6rv5r6kfqgsly5g7kxhpa8r4my8nqk5n2fztvz0jys84mwks with MarloweParams {rolePayoutValidatorHash = 0efee86ca0f5648110f9288f58d70f4e3aec87982d49a9225b04f912, rolesCurrency = ac2f14b1644c544f08a6e20ae799e0618b119b3b618d090ac1346c8d}.
[Comment] The oracle should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the party and counterparty along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,13443061),(AssetId "ac2f14b1644c544f08a6e20ae799e0618b119b3b618d090ac1346c8d" "Oracle",1)].
[Comment] The party and counterpary should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,82000000),(AssetId "ac2f14b1644c544f08a6e20ae799e0618b119b3b618d090ac1346c8d" "Party",1)].
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,62000000),(AssetId "ac2f14b1644c544f08a6e20ae799e0618b119b3b618d090ac1346c8d" "Counterparty",1)].
[Comment] The party and counterparty each need to follow the contract created by the mediator.
[Follow] Instance "PartyApp" now follows instance "OracleApp".
[Follow] Instance "CounterpartyApp" now follows instance "OracleApp".
[Comment] The party deposits their 20 ADA margin.
[runContract] Instance 44a1fca5-425b-47be-bd42-ea6663cfe63a received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "PartyApp" for inputs [ClientInput (IDeposit "Party" "Party" (Token "" "") 20000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 44a1fca5-425b-47be-bd42-ea6663cfe63a received NewObservableState (Object (fromList [("contents",Array [String "faf42d89-2195-4094-9e5a-3757ac753ad2",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 44a1fca5-425b-47be-bd42-ea6663cfe63a received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The party should have about 62 ADA now, since they paid 20 ADA for the margin, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,60527894),(AssetId "ac2f14b1644c544f08a6e20ae799e0618b119b3b618d090ac1346c8d" "Party",1)].
[Comment] The counterparty deposits their 30 ADA margin.
[runContract] Instance c9230d46-43be-4d6a-af23-525ef4376b0a received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "CounterpartyApp" for inputs [ClientInput (IDeposit "Counterparty" "Counterparty" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance c9230d46-43be-4d6a-af23-525ef4376b0a received NewObservableState (Object (fromList [("contents",Array [String "796da755-89e9-4077-8e25-cbb54aae1519",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance c9230d46-43be-4d6a-af23-525ef4376b0a received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The counterparty should have about 32 ADA now, since they paid 30 ADA for the margin purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,30559287),(AssetId "ac2f14b1644c544f08a6e20ae799e0618b119b3b618d090ac1346c8d" "Counterparty",1)].
[Comment] The oracle reports that the price is 1.2 ADA/USD in the first window.
[runContract] Instance 185b36e4-e732-41fc-8a79-97fc39646870 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OracleApp" for inputs [ClientInput (IChoice (ChoiceId "ADA/USD" "Oracle") 1200000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 185b36e4-e732-41fc-8a79-97fc39646870 received NewObservableState (Object (fromList [("contents",Array [String "d2d7cede-993d-4638-b7be-54c8ed6fc1d5",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 185b36e4-e732-41fc-8a79-97fc39646870 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should still have 14 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,11855302),(AssetId "ac2f14b1644c544f08a6e20ae799e0618b119b3b618d090ac1346c8d" "Oracle",1)].
[Comment] The oracle reports that the price is 0.700000 USD/ADA in the second window.
[WaitFor] Waited for 12000 milliseconds.
[runContract] Instance 185b36e4-e732-41fc-8a79-97fc39646870 received NewActiveEndpoints [].
[CallApplyInputs] Endpoint "apply-inputs" called on instance "OracleApp" for inputs [ClientInput (IChoice (ChoiceId "USD/ADA" "Oracle") 700000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 185b36e4-e732-41fc-8a79-97fc39646870 received NewObservableState (Object (fromList [("contents",Array [String "8dcf5368-6197-4918-9d01-5c33053e5964",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 185b36e4-e732-41fc-8a79-97fc39646870 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should have 16 ADA now because they received their original min-ADA deposit back, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12098116),(AssetId "ac2f14b1644c544f08a6e20ae799e0618b119b3b618d090ac1346c8d" "Oracle",1)].
[Comment] Now the party redeems from the payout script their 36 ADA, margin plus profit.
[runContract] Instance 44a1fca5-425b-47be-bd42-ea6663cfe63a received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "PartyApp" for role "Party".
[runContract] Instance 44a1fca5-425b-47be-bd42-ea6663cfe63a received NewObservableState (Object (fromList [("contents",Array [String "87c52360-aadd-441e-b9a9-c7ead718f437",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 44a1fca5-425b-47be-bd42-ea6663cfe63a received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The party should now have 98 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,96081169),(AssetId "ac2f14b1644c544f08a6e20ae799e0618b119b3b618d090ac1346c8d" "Party",1)].
[Comment] Now the counterparty redeems their remaining 14 ADA margin from the payout script.
[runContract] Instance c9230d46-43be-4d6a-af23-525ef4376b0a received NewActiveEndpoints [].
[CallRedeem] Endpoint "redeem" called on instance "CounterpartyApp" for role "Counterparty".
[runContract] Instance c9230d46-43be-4d6a-af23-525ef4376b0a received NewObservableState (Object (fromList [("contents",Array [String "af46128c-317a-4587-82d5-b2e52f52db52",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance c9230d46-43be-4d6a-af23-525ef4376b0a received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The counterparty should now have 46 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,44140322),(AssetId "ac2f14b1644c544f08a6e20ae799e0618b119b3b618d090ac1346c8d" "Counterparty",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 44a1fca5-425b-47be-bd42-ea6663cfe63a received ContractFinished Nothing.
[Stop] Instance "PartyApp" stopped.
[Stop] Instance "CounterpartyApp" stopped.
[runContract] Instance c9230d46-43be-4d6a-af23-525ef4376b0a received ContractFinished Nothing.
[Stop] Instance "OracleApp" stopped.
***** PASSED *****
