
***** Test "Contract for Differences with Oracle" *****
[Comment] Create the wallet for the party, fund it with 80 ADA, and activate the Marlowe endpoints.
[CreateWallet] Created wallet 7efec01b5ee2bc179deae4c2b4864948d165171c for role "Party".
[FundWallet] Funded wallet 7efec01b5ee2bc179deae4c2b4864948d165171c for role "Party" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance 2d335fca-b82c-43e4-95d5-f843f24b73d1 for role "Party".
[Comment] Create the wallet for the counterparty, fund it with 60 ADA, and activate the Marlowe endpoints.
[runContract] Instance 2d335fca-b82c-43e4-95d5-f843f24b73d1 received NewObservableState Null.
[runContract] Instance 2d335fca-b82c-43e4-95d5-f843f24b73d1 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 2d335fca-b82c-43e4-95d5-f843f24b73d1 received NewYieldedExportTxs [].
[CreateWallet] Created wallet 0ea7c42a3973e4215dd3eba1bb05b1b673ec189e for role "Counterparty".
[FundWallet] Funded wallet 0ea7c42a3973e4215dd3eba1bb05b1b673ec189e for role "Counterparty" with valueFromList [(AdaAssetId,60000000)].
[ActivateApp] Activated MarloweApp instance 573adab5-abb8-407a-8f04-89618cb13ce5 for role "Counterparty".
[Comment] Create the wallet for the oracle, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance 573adab5-abb8-407a-8f04-89618cb13ce5 received NewObservableState Null.
[runContract] Instance 573adab5-abb8-407a-8f04-89618cb13ce5 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 573adab5-abb8-407a-8f04-89618cb13ce5 received NewYieldedExportTxs [].
[CreateWallet] Created wallet 6e026545048202582c84e6c172fc74b8aec5e4f8 for role "Oracle".
[FundWallet] Funded wallet 6e026545048202582c84e6c172fc74b8aec5e4f8 for role "Oracle" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e for role "Oracle".
[Comment] The oracle creates the contract with differences, which was downloaded from Marlowe Playground. The party deposits 20 ADA to cover the margin collateral and the counterparty deposits 30 ADA.
[runContract] Instance fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e received NewObservableState Null.
[runContract] Instance fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e received NewYieldedExportTxs [].
[CallCreate] Endpoint "create" called on instance fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e for owners [("Party",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "4bb4f6968b0699e73af73603c71fb907c3d1cfc944b63be61d3c6848")) (StakeRefBase (KeyHashObj (KeyHash "ea99e995642aa8d1fa20ecb5ba8a327c99f5cf2f594051eb41bf19be"))))),("Counterparty",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "ce6f94a51f0e19c929a47f756e84cf76c9162669d9516185ebbcd64f")) (StakeRefBase (KeyHashObj (KeyHash "e6aef13a69b18d6960ab995a8c5ad8b9326d243cb5bfce67c1a2f2ee"))))),("Oracle",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "911d14bbb544673dc1606a56b62ca11b033a761517f4a8ac0ae20f22")) (StakeRefBase (KeyHashObj (KeyHash "85944ccb9f8f8f0c2e54b27bbf238460c98697f6bc2dbdf669f0a763")))))].
[runContract] Instance fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e received NewActiveEndpoints [].
[runContract] Instance fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e received NewObservableState (Object (fromList [("contents",Array [String "515c1f4d-52bc-477f-a895-fb8089960f00",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "aae5044bc0cf870ca828d8ef80246e6d1661cb8abb7341fad7f3ca50"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "9c7635e254cb9beec24991bc3036b6b5727a090e1052fd0fe8642af0")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed with MarloweParams {rolePayoutValidatorHash = aae5044bc0cf870ca828d8ef80246e6d1661cb8abb7341fad7f3ca50, rolesCurrency = 9c7635e254cb9beec24991bc3036b6b5727a090e1052fd0fe8642af0}.
[Comment] The oracle should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the party and counterparty along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,13443061),(AssetId "9c7635e254cb9beec24991bc3036b6b5727a090e1052fd0fe8642af0" "Oracle",1)].
[Comment] The party and counterpary should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,82000000),(AssetId "9c7635e254cb9beec24991bc3036b6b5727a090e1052fd0fe8642af0" "Party",1)].
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,62000000),(AssetId "9c7635e254cb9beec24991bc3036b6b5727a090e1052fd0fe8642af0" "Counterparty",1)].
[Comment] The party and counterparty each need to follow the contract created by the mediator.
[Follow] Instance 2d335fca-b82c-43e4-95d5-f843f24b73d1 now follows instance fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e.
[Follow] Instance 573adab5-abb8-407a-8f04-89618cb13ce5 now follows instance fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e.
[Comment] The party deposits their 20 ADA margin.
[CallApplyInputs] Endpoint "apply-inputs" called on 2d335fca-b82c-43e4-95d5-f843f24b73d1 for inputs [ClientInput (IDeposit "Party" "Party" (Token "" "") 20000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 2d335fca-b82c-43e4-95d5-f843f24b73d1 received NewActiveEndpoints [].
[runContract] Instance 2d335fca-b82c-43e4-95d5-f843f24b73d1 received NewObservableState (Object (fromList [("contents",Array [String "01a7c962-1a61-417a-8555-3fdb40733ac8",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 2d335fca-b82c-43e4-95d5-f843f24b73d1 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The party should have about 62 ADA now, since they paid 20 ADA for the margin, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,60620709),(AssetId "9c7635e254cb9beec24991bc3036b6b5727a090e1052fd0fe8642af0" "Party",1)].
[Comment] The counterparty deposits their 30 ADA margin.
[CallApplyInputs] Endpoint "apply-inputs" called on 573adab5-abb8-407a-8f04-89618cb13ce5 for inputs [ClientInput (IDeposit "Counterparty" "Counterparty" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 573adab5-abb8-407a-8f04-89618cb13ce5 received NewActiveEndpoints [].
[runContract] Instance 573adab5-abb8-407a-8f04-89618cb13ce5 received NewObservableState (Object (fromList [("contents",Array [String "67bcf7b3-2648-4de1-90cd-1881c8cb5621",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 573adab5-abb8-407a-8f04-89618cb13ce5 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The counterparty should have about 32 ADA now, since they paid 30 ADA for the margin purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,30645016),(AssetId "9c7635e254cb9beec24991bc3036b6b5727a090e1052fd0fe8642af0" "Counterparty",1)].
[Comment] The oracle reports that the price is 1.2 ADA/USD in the first window.
[CallApplyInputs] Endpoint "apply-inputs" called on fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e for inputs [ClientInput (IChoice (ChoiceId "ADA/USD" "Oracle") 1200000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e received NewActiveEndpoints [].
[runContract] Instance fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e received NewObservableState (Object (fromList [("contents",Array [String "78ebdfce-6e4c-4242-90e4-4e43cd032805",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should still have 14 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12024398),(AssetId "9c7635e254cb9beec24991bc3036b6b5727a090e1052fd0fe8642af0" "Oracle",1)].
[Comment] The oracle reports that the price is 0.700000 USD/ADA in the second window.
[WaitFor] Waited for 12000 milliseconds.
[CallApplyInputs] Endpoint "apply-inputs" called on fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e for inputs [ClientInput (IChoice (ChoiceId "USD/ADA" "Oracle") 700000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e received NewActiveEndpoints [].
[runContract] Instance fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e received NewObservableState (Object (fromList [("contents",Array [String "bf47c568-74e1-466e-b176-277975741d46",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should have 16 ADA now because they received their original min-ADA deposit back, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,12304312),(AssetId "9c7635e254cb9beec24991bc3036b6b5727a090e1052fd0fe8642af0" "Oracle",1)].
[Comment] Now the party redeems from the payout script their 36 ADA, margin plus profit.
[CallRedeem] Endpoint "redeem" called on 2d335fca-b82c-43e4-95d5-f843f24b73d1 for role "Party".
[runContract] Instance 2d335fca-b82c-43e4-95d5-f843f24b73d1 received NewActiveEndpoints [].
[runContract] Instance 2d335fca-b82c-43e4-95d5-f843f24b73d1 received NewObservableState (Object (fromList [("contents",Array [String "d7e16b65-2cf7-4cd1-be96-562ad414d2f6",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 2d335fca-b82c-43e4-95d5-f843f24b73d1 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The party should now have 98 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,96192111),(AssetId "9c7635e254cb9beec24991bc3036b6b5727a090e1052fd0fe8642af0" "Party",1)].
[Comment] Now the counterparty redeems their remaining 14 ADA margin from the payout script.
[CallRedeem] Endpoint "redeem" called on 573adab5-abb8-407a-8f04-89618cb13ce5 for role "Counterparty".
[runContract] Instance 573adab5-abb8-407a-8f04-89618cb13ce5 received NewActiveEndpoints [].
[runContract] Instance 573adab5-abb8-407a-8f04-89618cb13ce5 received NewObservableState (Object (fromList [("contents",Array [String "368204f7-ab1e-497e-851e-e3d989c58045",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 573adab5-abb8-407a-8f04-89618cb13ce5 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The counterparty should now have 46 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,44220246),(AssetId "9c7635e254cb9beec24991bc3036b6b5727a090e1052fd0fe8642af0" "Counterparty",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 2d335fca-b82c-43e4-95d5-f843f24b73d1 received ContractFinished Nothing.
[Stop] Instance 2d335fca-b82c-43e4-95d5-f843f24b73d1 stopped.
[Stop] Instance 573adab5-abb8-407a-8f04-89618cb13ce5 stopped.
[runContract] Instance 573adab5-abb8-407a-8f04-89618cb13ce5 received ContractFinished Nothing.
[Stop] Instance fb0f94bb-2aea-4416-b47c-72ba3b8b2c3e stopped.
***** SUCCEEDED *****
