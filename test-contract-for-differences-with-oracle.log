
***** Test "Contract for Differences with Oracle" *****
[Comment] Create the wallet for the party, fund it with 80 ADA, and activate the Marlowe endpoints.
[CreateWallet] Created wallet c445b2b16c1ea2b9c44f019d1cdd7d3a22fb698a for role "Party".
[FundWallet] Funded wallet c445b2b16c1ea2b9c44f019d1cdd7d3a22fb698a for role "Party" with valueFromList [(AdaAssetId,80000000)].
[ActivateApp] Activated MarloweApp instance 49c8eb75-bb55-4ac3-b8e1-67f9763aa201 for role "Party".
[Comment] Create the wallet for the counterparty, fund it with 60 ADA, and activate the Marlowe endpoints.
[runContract] Instance 49c8eb75-bb55-4ac3-b8e1-67f9763aa201 received NewObservableState Null.
[runContract] Instance 49c8eb75-bb55-4ac3-b8e1-67f9763aa201 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance 49c8eb75-bb55-4ac3-b8e1-67f9763aa201 received NewYieldedExportTxs [].
[CreateWallet] Created wallet 7cd857ea9b2ce505ede0770173aaba15d3145a70 for role "Counterparty".
[FundWallet] Funded wallet 7cd857ea9b2ce505ede0770173aaba15d3145a70 for role "Counterparty" with valueFromList [(AdaAssetId,60000000)].
[ActivateApp] Activated MarloweApp instance f50bc2b4-db4f-4300-af0f-119e4cda47e4 for role "Counterparty".
[Comment] Create the wallet for the oracle, fund it with 20 ADA, and activate the Marlowe endpoints.
[runContract] Instance f50bc2b4-db4f-4300-af0f-119e4cda47e4 received NewObservableState Null.
[runContract] Instance f50bc2b4-db4f-4300-af0f-119e4cda47e4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance f50bc2b4-db4f-4300-af0f-119e4cda47e4 received NewYieldedExportTxs [].
[CreateWallet] Created wallet b7244770caf4ccb4574820395f61c11bdbf882aa for role "Oracle".
[FundWallet] Funded wallet b7244770caf4ccb4574820395f61c11bdbf882aa for role "Oracle" with valueFromList [(AdaAssetId,20000000)].
[ActivateApp] Activated MarloweApp instance eabe1033-b316-429c-b782-9717a0846636 for role "Oracle".
[Comment] The oracle creates the contract with differences, which was downloaded from Marlowe Playground. The party deposits 20 ADA to cover the margin collateral and the counterparty deposits 30 ADA.
[CallCreate] Endpoint "create" called on instance eabe1033-b316-429c-b782-9717a0846636 for owners [("Party",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "120c576dcd0bb036c213985899dd3e5b10a8460020f4f54f44d7d7b2")) (StakeRefBase (KeyHashObj (KeyHash "f3605627ca033bf19a5416a1c7553b49fe8ec8ab139624acb0d35589"))))),("Counterparty",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "0ac2fc4dff3fc933064f10b5613939b3e06655e0e6af2e62a6d621e5")) (StakeRefBase (KeyHashObj (KeyHash "0b0d23914c612bd84c0248f4324fb70e754eb77a09d7da214d4e4adb"))))),("Oracle",AddressInEra (ShelleyAddressInEra ShelleyBasedEraShelley) (ShelleyAddress Testnet (KeyHashObj (KeyHash "e476cb087c8d329b8686ea634fc19ba08ec55ee4f2a5b42cc138d3dd")) (StakeRefBase (KeyHashObj (KeyHash "086dd0e18bc1ac4993ad0833f23c7fc6925c74a95b11c4e53f75bd67")))))].
[runContract] Instance eabe1033-b316-429c-b782-9717a0846636 received NewObservableState Null.
[runContract] Instance eabe1033-b316-429c-b782-9717a0846636 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[runContract] Instance eabe1033-b316-429c-b782-9717a0846636 received NewYieldedExportTxs [].
[runContract] Instance eabe1033-b316-429c-b782-9717a0846636 received NewActiveEndpoints [].
[runContract] Instance eabe1033-b316-429c-b782-9717a0846636 received NewObservableState (Object (fromList [("contents",Array [String "2b45536c-3491-42e8-9d63-0665901335f8",Object (fromList [("contents",Object (fromList [("rolePayoutValidatorHash",String "5b73c28d84f82f7255d6943d279a4c071cc89ff2a3dc4ed4879dc25a"),("rolesCurrency",Object (fromList [("unCurrencySymbol",String "516951ad13a08bd27c472bcaa9936388a55d0f3917f0b945fd648f05")]))])),("tag",String "CreateResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance eabe1033-b316-429c-b782-9717a0846636 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitCreate] Creation confirmed with MarloweParams {rolePayoutValidatorHash = 5b73c28d84f82f7255d6943d279a4c071cc89ff2a3dc4ed4879dc25a, rolesCurrency = 516951ad13a08bd27c472bcaa9936388a55d0f3917f0b945fd648f05}.
[Comment] The oracle should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the party and counterparty along with their role tokens, and up to 1 ADA in fees might have been paid.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,13408774),(AssetId "516951ad13a08bd27c472bcaa9936388a55d0f3917f0b945fd648f05" "Oracle",1)].
[Comment] The party and counterpary should each now have an additional 2 ADA that arrived with their role token.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,82000000),(AssetId "516951ad13a08bd27c472bcaa9936388a55d0f3917f0b945fd648f05" "Party",1)].
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,62000000),(AssetId "516951ad13a08bd27c472bcaa9936388a55d0f3917f0b945fd648f05" "Counterparty",1)].
[Comment] The party and counterparty each need to follow the contract created by the mediator.
[Follow] Instance 49c8eb75-bb55-4ac3-b8e1-67f9763aa201 now follows instance eabe1033-b316-429c-b782-9717a0846636.
[Follow] Instance f50bc2b4-db4f-4300-af0f-119e4cda47e4 now follows instance eabe1033-b316-429c-b782-9717a0846636.
[Comment] The party deposits their 20 ADA margin.
[CallApplyInputs] Endpoint "apply-inputs" called on 49c8eb75-bb55-4ac3-b8e1-67f9763aa201 for inputs [ClientInput (IDeposit "Party" "Party" (Token "" "") 20000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance 49c8eb75-bb55-4ac3-b8e1-67f9763aa201 received NewActiveEndpoints [].
[runContract] Instance 49c8eb75-bb55-4ac3-b8e1-67f9763aa201 received NewObservableState (Object (fromList [("contents",Array [String "6f2abcca-7014-4793-a3f2-d7e0c4ba0185",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 49c8eb75-bb55-4ac3-b8e1-67f9763aa201 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The party should have about 62 ADA now, since they paid 20 ADA for the margin, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,60471591),(AssetId "516951ad13a08bd27c472bcaa9936388a55d0f3917f0b945fd648f05" "Party",1)].
[Comment] The counterparty deposits their 30 ADA margin.
[CallApplyInputs] Endpoint "apply-inputs" called on f50bc2b4-db4f-4300-af0f-119e4cda47e4 for inputs [ClientInput (IDeposit "Counterparty" "Counterparty" (Token "" "") 30000000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance f50bc2b4-db4f-4300-af0f-119e4cda47e4 received NewActiveEndpoints [].
[runContract] Instance f50bc2b4-db4f-4300-af0f-119e4cda47e4 received NewObservableState (Object (fromList [("contents",Array [String "70f96bcc-f724-4b31-9a75-f2ef21fe7caa",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance f50bc2b4-db4f-4300-af0f-119e4cda47e4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The counterparty should have about 32 ADA now, since they paid 30 ADA for the margin purchase, but there is up to an additional 2 ADA in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,30511082),(AssetId "516951ad13a08bd27c472bcaa9936388a55d0f3917f0b945fd648f05" "Counterparty",1)].
[Comment] The oracle reports that the price is 1.2 ADA/USD in the first window.
[CallApplyInputs] Endpoint "apply-inputs" called on eabe1033-b316-429c-b782-9717a0846636 for inputs [ClientInput (IChoice (ChoiceId "ADA/USD" "Oracle") 1200000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance eabe1033-b316-429c-b782-9717a0846636 received NewActiveEndpoints [].
[runContract] Instance eabe1033-b316-429c-b782-9717a0846636 received NewObservableState (Object (fromList [("contents",Array [String "0f46c53a-b434-4697-aa3e-d64495c5256c",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance eabe1033-b316-429c-b782-9717a0846636 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should still have 14 ADA now, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,11829421),(AssetId "516951ad13a08bd27c472bcaa9936388a55d0f3917f0b945fd648f05" "Oracle",1)].
[Comment] The oracle reports that the price is 0.700000 USD/ADA in the second window.
[WaitFor] Waited for 12000 milliseconds.
[CallApplyInputs] Endpoint "apply-inputs" called on eabe1033-b316-429c-b782-9717a0846636 for inputs [ClientInput (IChoice (ChoiceId "USD/ADA" "Oracle") 700000)] and times Just (POSIXTime {getPOSIXTime = 1645590825000},POSIXTime {getPOSIXTime = 1898051625000}).
[runContract] Instance eabe1033-b316-429c-b782-9717a0846636 received NewActiveEndpoints [].
[runContract] Instance eabe1033-b316-429c-b782-9717a0846636 received NewObservableState (Object (fromList [("contents",Array [String "856bac9b-47ef-4643-92d3-f97337e9b739",Object (fromList [("tag",String "ApplyInputsResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance eabe1033-b316-429c-b782-9717a0846636 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitApplyInputs] Input application confirmed.
[Comment] The oracle should have 16 ADA now because they received their original min-ADA deposit back, but they may have paid up to another 2 ADA in fees.
[CheckFunds] Wallet for role "Oracle" contains valueFromList [(AdaAssetId,11882738),(AssetId "516951ad13a08bd27c472bcaa9936388a55d0f3917f0b945fd648f05" "Oracle",1)].
[Comment] Now the party redeems from the payout script their 36 ADA, margin plus profit.
[CallRedeem] Endpoint "redeem" called on 49c8eb75-bb55-4ac3-b8e1-67f9763aa201 for role "Party".
[runContract] Instance 49c8eb75-bb55-4ac3-b8e1-67f9763aa201 received NewActiveEndpoints [].
[runContract] Instance 49c8eb75-bb55-4ac3-b8e1-67f9763aa201 received NewObservableState (Object (fromList [("contents",Array [String "e972f920-a3f0-4b9f-947c-493eb2098499",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance 49c8eb75-bb55-4ac3-b8e1-67f9763aa201 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The party should now have 98 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Party" contains valueFromList [(AdaAssetId,96025986),(AssetId "516951ad13a08bd27c472bcaa9936388a55d0f3917f0b945fd648f05" "Party",1)].
[Comment] Now the counterparty redeems their remaining 14 ADA margin from the payout script.
[CallRedeem] Endpoint "redeem" called on f50bc2b4-db4f-4300-af0f-119e4cda47e4 for role "Counterparty".
[runContract] Instance f50bc2b4-db4f-4300-af0f-119e4cda47e4 received NewActiveEndpoints [].
[runContract] Instance f50bc2b4-db4f-4300-af0f-119e4cda47e4 received NewObservableState (Object (fromList [("contents",Array [String "b11f112e-b7ab-4726-b1c1-8f13714c9d3b",Object (fromList [("tag",String "RedeemResponse")])]),("tag",String "EndpointSuccess")])).
[runContract] Instance f50bc2b4-db4f-4300-af0f-119e4cda47e4 received NewActiveEndpoints [ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "close"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "redeem"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "auto"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs-nonmerkleized"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "apply-inputs"}, aeMetadata = Nothing},ActiveEndpoint {aeDescription = EndpointDescription {getEndpointDescription = "create"}, aeMetadata = Nothing}].
[AwaitRedeem] Redemption confirmed.
[Comment] The counterparty should now have 46 ADA, but they may have paid up to 1 ADA more in fees.
[CheckFunds] Wallet for role "Counterparty" contains valueFromList [(AdaAssetId,44069305),(AssetId "516951ad13a08bd27c472bcaa9936388a55d0f3917f0b945fd648f05" "Counterparty",1)].
[Comment] Stop the Marlowe application.
[runContract] Instance 49c8eb75-bb55-4ac3-b8e1-67f9763aa201 received ContractFinished Nothing.
[Stop] Instance 49c8eb75-bb55-4ac3-b8e1-67f9763aa201 stopped.
[Stop] Instance f50bc2b4-db4f-4300-af0f-119e4cda47e4 stopped.
[runContract] Instance f50bc2b4-db4f-4300-af0f-119e4cda47e4 received ContractFinished Nothing.
[Stop] Instance eabe1033-b316-429c-b782-9717a0846636 stopped.
***** SUCCEEDED *****
[runContract] Instance eabe1033-b316-429c-b782-9717a0846636 received ContractFinished Nothing.
